<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Target page for TU after successful SAM login</title>
</head>

<body onload="onLoad(location.search);">

    <script type="text/javascript">

        function onLoad(query) {

            if (query == '') return;

            var pairs = query.slice(1).split("&");

            var pair, name, value;
            for (var i = 0; i < pairs.length; i++) {

                pair = pairs[i].split("=");

                name = unescape(pair[0]).replace("+", " ");
                value = unescape(pair[1]).replace("+", " ");

                this["__" + name] = value;
            }

            window.location.replace(updateUrl(this.__state, "sam3.mock.code", this.__code));
        }

        function updateUrl(url, key, value) {

            if (value !== undefined) {

                value = encodeURI(value);
            }

            var hashIndex = url.indexOf("#") | 0;

            if (hashIndex === -1) hashIndex = url.length | 0;

            var urlParts = url.substring(0, hashIndex).split('?');
            var baseUrl = urlParts[0];
            var parameters = "";
            var outPara = {};

            if (urlParts.length > 1) {

                parameters = urlParts[1];
            }

            if (parameters !== "") {

                parameters = parameters.split('&');

                for (k in parameters) {

                    var keyVal = parameters[k];

                    keyVal = keyVal.split('=');

                    var ekey = keyVal[0];
                    var evalue = "";

                    if (keyVal.length > 1) {

                        evalue = keyVal[1];
                    }

                    outPara[ekey] = evalue;
                }
            }

            if (value !== undefined) {

                outPara[key] = value;
            } else {

                delete outPara[key];
            }

            parameters = [];

            for (var k in outPara) {

                parameters.push(k + '=' + outPara[k]);
            }

            var finalUrl = baseUrl;

            if (parameters.length > 0) {

                finalUrl += '?' + parameters.join('&');
            }

            return finalUrl + url.substring(hashIndex);
        }

    </script>

</body>

</html>