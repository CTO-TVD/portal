/*! For license information please see admanagement-sdk-es5-3.5.2.min.js.LICENSE.txt */
var YospaceAdManagement;(()=>{var t={742:(t,e)=>{"use strict";e.byteLength=function(t){var e=u(t),r=e[0],n=e[1];return 3*(r+n)/4-n},e.toByteArray=function(t){var e,r,a=u(t),o=a[0],s=a[1],c=new i(function(t,e,r){return 3*(e+r)/4-r}(0,o,s)),l=0,f=s>0?o-4:o;for(r=0;r<f;r+=4)e=n[t.charCodeAt(r)]<<18|n[t.charCodeAt(r+1)]<<12|n[t.charCodeAt(r+2)]<<6|n[t.charCodeAt(r+3)],c[l++]=e>>16&255,c[l++]=e>>8&255,c[l++]=255&e;return 2===s&&(e=n[t.charCodeAt(r)]<<2|n[t.charCodeAt(r+1)]>>4,c[l++]=255&e),1===s&&(e=n[t.charCodeAt(r)]<<10|n[t.charCodeAt(r+1)]<<4|n[t.charCodeAt(r+2)]>>2,c[l++]=e>>8&255,c[l++]=255&e),c},e.fromByteArray=function(t){for(var e,n=t.length,i=n%3,a=[],o=16383,s=0,u=n-i;s<u;s+=o)a.push(c(t,s,s+o>u?u:s+o));return 1===i?(e=t[n-1],a.push(r[e>>2]+r[e<<4&63]+"==")):2===i&&(e=(t[n-2]<<8)+t[n-1],a.push(r[e>>10]+r[e>>4&63]+r[e<<2&63]+"=")),a.join("")};for(var r=[],n=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,s=a.length;o<s;++o)r[o]=a[o],n[a.charCodeAt(o)]=o;function u(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function c(t,e,n){for(var i,a,o=[],s=e;s<n;s+=3)i=(t[s]<<16&16711680)+(t[s+1]<<8&65280)+(255&t[s+2]),o.push(r[(a=i)>>18&63]+r[a>>12&63]+r[a>>6&63]+r[63&a]);return o.join("")}n["-".charCodeAt(0)]=62,n["_".charCodeAt(0)]=63},764:(t,e,r)=>{"use strict";var n=r(742),i=r(645),a=r(826);function o(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(t,e){if(o()<e)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(t=new Uint8Array(e)).__proto__=u.prototype:(null===t&&(t=new u(e)),t.length=e),t}function u(t,e,r){if(!(u.TYPED_ARRAY_SUPPORT||this instanceof u))return new u(t,e,r);if("number"==typeof t){if("string"==typeof e)throw new Error("If encoding is specified then the first argument must be a string");return f(this,t)}return c(this,t,e,r)}function c(t,e,r,n){if("number"==typeof e)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer?function(t,e,r,n){if(e.byteLength,r<0||e.byteLength<r)throw new RangeError("'offset' is out of bounds");if(e.byteLength<r+(n||0))throw new RangeError("'length' is out of bounds");return e=void 0===r&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,r):new Uint8Array(e,r,n),u.TYPED_ARRAY_SUPPORT?(t=e).__proto__=u.prototype:t=h(t,e),t}(t,e,r,n):"string"==typeof e?function(t,e,r){if("string"==typeof r&&""!==r||(r="utf8"),!u.isEncoding(r))throw new TypeError('"encoding" must be a valid string encoding');var n=0|p(e,r),i=(t=s(t,n)).write(e,r);return i!==n&&(t=t.slice(0,i)),t}(t,e,r):function(t,e){if(u.isBuffer(e)){var r=0|d(e.length);return 0===(t=s(t,r)).length||e.copy(t,0,0,r),t}if(e){if("undefined"!=typeof ArrayBuffer&&e.buffer instanceof ArrayBuffer||"length"in e)return"number"!=typeof e.length||(n=e.length)!=n?s(t,0):h(t,e);if("Buffer"===e.type&&a(e.data))return h(t,e.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(t,e)}function l(t){if("number"!=typeof t)throw new TypeError('"size" argument must be a number');if(t<0)throw new RangeError('"size" argument must not be negative')}function f(t,e){if(l(e),t=s(t,e<0?0:0|d(e)),!u.TYPED_ARRAY_SUPPORT)for(var r=0;r<e;++r)t[r]=0;return t}function h(t,e){var r=e.length<0?0:0|d(e.length);t=s(t,r);for(var n=0;n<r;n+=1)t[n]=255&e[n];return t}function d(t){if(t>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|t}function p(t,e){if(u.isBuffer(t))return t.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(t)||t instanceof ArrayBuffer))return t.byteLength;"string"!=typeof t&&(t=""+t);var r=t.length;if(0===r)return 0;for(var n=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":case void 0:return F(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return V(t).length;default:if(n)return F(t).length;e=(""+e).toLowerCase(),n=!0}}function y(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return D(this,e,r);case"utf8":case"utf-8":return P(this,e,r);case"ascii":return O(this,e,r);case"latin1":case"binary":return C(this,e,r);case"base64":return S(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function v(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function g(t,e,r,n,i){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),r=+r,isNaN(r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof e&&(e=u.from(e,n)),u.isBuffer(e))return 0===e.length?-1:b(t,e,r,n,i);if("number"==typeof e)return e&=255,u.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):b(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function b(t,e,r,n,i){var a,o=1,s=t.length,u=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;o=2,s/=2,u/=2,r/=2}function c(t,e){return 1===o?t[e]:t.readUInt16BE(e*o)}if(i){var l=-1;for(a=r;a<s;a++)if(c(t,a)===c(e,-1===l?0:a-l)){if(-1===l&&(l=a),a-l+1===u)return l*o}else-1!==l&&(a-=a-l),l=-1}else for(r+u>s&&(r=s-u),a=r;a>=0;a--){for(var f=!0,h=0;h<u;h++)if(c(t,a+h)!==c(e,h)){f=!1;break}if(f)return a}return-1}function m(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;var a=e.length;if(a%2!=0)throw new TypeError("Invalid hex string");n>a/2&&(n=a/2);for(var o=0;o<n;++o){var s=parseInt(e.substr(2*o,2),16);if(isNaN(s))return o;t[r+o]=s}return o}function k(t,e,r,n){return H(F(e,t.length-r),t,r,n)}function T(t,e,r,n){return H(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function A(t,e,r,n){return T(t,e,r,n)}function w(t,e,r,n){return H(V(e),t,r,n)}function E(t,e,r,n){return H(function(t,e){for(var r,n,i,a=[],o=0;o<t.length&&!((e-=2)<0);++o)n=(r=t.charCodeAt(o))>>8,i=r%256,a.push(i),a.push(n);return a}(e,t.length-r),t,r,n)}function S(t,e,r){return 0===e&&r===t.length?n.fromByteArray(t):n.fromByteArray(t.slice(e,r))}function P(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var a,o,s,u,c=t[i],l=null,f=c>239?4:c>223?3:c>191?2:1;if(i+f<=r)switch(f){case 1:c<128&&(l=c);break;case 2:128==(192&(a=t[i+1]))&&(u=(31&c)<<6|63&a)>127&&(l=u);break;case 3:a=t[i+1],o=t[i+2],128==(192&a)&&128==(192&o)&&(u=(15&c)<<12|(63&a)<<6|63&o)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:a=t[i+1],o=t[i+2],s=t[i+3],128==(192&a)&&128==(192&o)&&128==(192&s)&&(u=(15&c)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&u<1114112&&(l=u)}null===l?(l=65533,f=1):l>65535&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),i+=f}return function(t){var e=t.length;if(e<=I)return String.fromCharCode.apply(String,t);for(var r="",n=0;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=I));return r}(n)}e.Buffer=u,e.SlowBuffer=function(t){return+t!=t&&(t=0),u.alloc(+t)},e.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==r.g.TYPED_ARRAY_SUPPORT?r.g.TYPED_ARRAY_SUPPORT:function(){try{var t=new Uint8Array(1);return t.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===t.foo()&&"function"==typeof t.subarray&&0===t.subarray(1,1).byteLength}catch(t){return!1}}(),e.kMaxLength=o(),u.poolSize=8192,u._augment=function(t){return t.__proto__=u.prototype,t},u.from=function(t,e,r){return c(null,t,e,r)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(t,e,r){return function(t,e,r,n){return l(e),e<=0?s(t,e):void 0!==r?"string"==typeof n?s(t,e).fill(r,n):s(t,e).fill(r):s(t,e)}(null,t,e,r)},u.allocUnsafe=function(t){return f(null,t)},u.allocUnsafeSlow=function(t){return f(null,t)},u.isBuffer=function(t){return!(null==t||!t._isBuffer)},u.compare=function(t,e){if(!u.isBuffer(t)||!u.isBuffer(e))throw new TypeError("Arguments must be Buffers");if(t===e)return 0;for(var r=t.length,n=e.length,i=0,a=Math.min(r,n);i<a;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},u.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(t,e){if(!a(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return u.alloc(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var n=u.allocUnsafe(e),i=0;for(r=0;r<t.length;++r){var o=t[r];if(!u.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(n,i),i+=o.length}return n},u.byteLength=p,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)v(this,e,e+1);return this},u.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)v(this,e,e+3),v(this,e+1,e+2);return this},u.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)v(this,e,e+7),v(this,e+1,e+6),v(this,e+2,e+5),v(this,e+3,e+4);return this},u.prototype.toString=function(){var t=0|this.length;return 0===t?"":0===arguments.length?P(this,0,t):y.apply(this,arguments)},u.prototype.equals=function(t){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===u.compare(this,t)},u.prototype.inspect=function(){var t="",r=e.INSPECT_MAX_BYTES;return this.length>0&&(t=this.toString("hex",0,r).match(/.{2}/g).join(" "),this.length>r&&(t+=" ... ")),"<Buffer "+t+">"},u.prototype.compare=function(t,e,r,n,i){if(!u.isBuffer(t))throw new TypeError("Argument must be a Buffer");if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&e>=r)return 0;if(n>=i)return-1;if(e>=r)return 1;if(this===t)return 0;for(var a=(i>>>=0)-(n>>>=0),o=(r>>>=0)-(e>>>=0),s=Math.min(a,o),c=this.slice(n,i),l=t.slice(e,r),f=0;f<s;++f)if(c[f]!==l[f]){a=c[f],o=l[f];break}return a<o?-1:o<a?1:0},u.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},u.prototype.indexOf=function(t,e,r){return g(this,t,e,r,!0)},u.prototype.lastIndexOf=function(t,e,r){return g(this,t,e,r,!1)},u.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e|=0,isFinite(r)?(r|=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-e;if((void 0===r||r>i)&&(r=i),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var a=!1;;)switch(n){case"hex":return m(this,t,e,r);case"utf8":case"utf-8":return k(this,t,e,r);case"ascii":return T(this,t,e,r);case"latin1":case"binary":return A(this,t,e,r);case"base64":return w(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return E(this,t,e,r);default:if(a)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),a=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var I=4096;function O(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function C(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function D(t,e,r){var n,i=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>i)&&(r=i);for(var a="",o=e;o<r;++o)a+=(n=t[o])<16?"0"+n.toString(16):n.toString(16);return a}function R(t,e,r){for(var n=t.slice(e,r),i="",a=0;a<n.length;a+=2)i+=String.fromCharCode(n[a]+256*n[a+1]);return i}function N(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function L(t,e,r,n,i,a){if(!u.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<a)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function _(t,e,r,n){e<0&&(e=65535+e+1);for(var i=0,a=Math.min(t.length-r,2);i<a;++i)t[r+i]=(e&255<<8*(n?i:1-i))>>>8*(n?i:1-i)}function B(t,e,r,n){e<0&&(e=4294967295+e+1);for(var i=0,a=Math.min(t.length-r,4);i<a;++i)t[r+i]=e>>>8*(n?i:3-i)&255}function j(t,e,r,n,i,a){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function U(t,e,r,n,a){return a||j(t,0,r,4),i.write(t,e,r,n,23,4),r+4}function M(t,e,r,n,a){return a||j(t,0,r,8),i.write(t,e,r,n,52,8),r+8}u.prototype.slice=function(t,e){var r,n=this.length;if((t=~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),(e=void 0===e?n:~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),e<t&&(e=t),u.TYPED_ARRAY_SUPPORT)(r=this.subarray(t,e)).__proto__=u.prototype;else{var i=e-t;r=new u(i,void 0);for(var a=0;a<i;++a)r[a]=this[a+t]}return r},u.prototype.readUIntLE=function(t,e,r){t|=0,e|=0,r||N(t,e,this.length);for(var n=this[t],i=1,a=0;++a<e&&(i*=256);)n+=this[t+a]*i;return n},u.prototype.readUIntBE=function(t,e,r){t|=0,e|=0,r||N(t,e,this.length);for(var n=this[t+--e],i=1;e>0&&(i*=256);)n+=this[t+--e]*i;return n},u.prototype.readUInt8=function(t,e){return e||N(t,1,this.length),this[t]},u.prototype.readUInt16LE=function(t,e){return e||N(t,2,this.length),this[t]|this[t+1]<<8},u.prototype.readUInt16BE=function(t,e){return e||N(t,2,this.length),this[t]<<8|this[t+1]},u.prototype.readUInt32LE=function(t,e){return e||N(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},u.prototype.readUInt32BE=function(t,e){return e||N(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},u.prototype.readIntLE=function(t,e,r){t|=0,e|=0,r||N(t,e,this.length);for(var n=this[t],i=1,a=0;++a<e&&(i*=256);)n+=this[t+a]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*e)),n},u.prototype.readIntBE=function(t,e,r){t|=0,e|=0,r||N(t,e,this.length);for(var n=e,i=1,a=this[t+--n];n>0&&(i*=256);)a+=this[t+--n]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*e)),a},u.prototype.readInt8=function(t,e){return e||N(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},u.prototype.readInt16LE=function(t,e){e||N(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt16BE=function(t,e){e||N(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},u.prototype.readInt32LE=function(t,e){return e||N(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},u.prototype.readInt32BE=function(t,e){return e||N(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},u.prototype.readFloatLE=function(t,e){return e||N(t,4,this.length),i.read(this,t,!0,23,4)},u.prototype.readFloatBE=function(t,e){return e||N(t,4,this.length),i.read(this,t,!1,23,4)},u.prototype.readDoubleLE=function(t,e){return e||N(t,8,this.length),i.read(this,t,!0,52,8)},u.prototype.readDoubleBE=function(t,e){return e||N(t,8,this.length),i.read(this,t,!1,52,8)},u.prototype.writeUIntLE=function(t,e,r,n){t=+t,e|=0,r|=0,n||L(this,t,e,r,Math.pow(2,8*r)-1,0);var i=1,a=0;for(this[e]=255&t;++a<r&&(i*=256);)this[e+a]=t/i&255;return e+r},u.prototype.writeUIntBE=function(t,e,r,n){t=+t,e|=0,r|=0,n||L(this,t,e,r,Math.pow(2,8*r)-1,0);var i=r-1,a=1;for(this[e+i]=255&t;--i>=0&&(a*=256);)this[e+i]=t/a&255;return e+r},u.prototype.writeUInt8=function(t,e,r){return t=+t,e|=0,r||L(this,t,e,1,255,0),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),this[e]=255&t,e+1},u.prototype.writeUInt16LE=function(t,e,r){return t=+t,e|=0,r||L(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):_(this,t,e,!0),e+2},u.prototype.writeUInt16BE=function(t,e,r){return t=+t,e|=0,r||L(this,t,e,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):_(this,t,e,!1),e+2},u.prototype.writeUInt32LE=function(t,e,r){return t=+t,e|=0,r||L(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t):B(this,t,e,!0),e+4},u.prototype.writeUInt32BE=function(t,e,r){return t=+t,e|=0,r||L(this,t,e,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):B(this,t,e,!1),e+4},u.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);L(this,t,e,r,i-1,-i)}var a=0,o=1,s=0;for(this[e]=255&t;++a<r&&(o*=256);)t<0&&0===s&&0!==this[e+a-1]&&(s=1),this[e+a]=(t/o>>0)-s&255;return e+r},u.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e|=0,!n){var i=Math.pow(2,8*r-1);L(this,t,e,r,i-1,-i)}var a=r-1,o=1,s=0;for(this[e+a]=255&t;--a>=0&&(o*=256);)t<0&&0===s&&0!==this[e+a+1]&&(s=1),this[e+a]=(t/o>>0)-s&255;return e+r},u.prototype.writeInt8=function(t,e,r){return t=+t,e|=0,r||L(this,t,e,1,127,-128),u.TYPED_ARRAY_SUPPORT||(t=Math.floor(t)),t<0&&(t=255+t+1),this[e]=255&t,e+1},u.prototype.writeInt16LE=function(t,e,r){return t=+t,e|=0,r||L(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8):_(this,t,e,!0),e+2},u.prototype.writeInt16BE=function(t,e,r){return t=+t,e|=0,r||L(this,t,e,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>8,this[e+1]=255&t):_(this,t,e,!1),e+2},u.prototype.writeInt32LE=function(t,e,r){return t=+t,e|=0,r||L(this,t,e,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24):B(this,t,e,!0),e+4},u.prototype.writeInt32BE=function(t,e,r){return t=+t,e|=0,r||L(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),u.TYPED_ARRAY_SUPPORT?(this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t):B(this,t,e,!1),e+4},u.prototype.writeFloatLE=function(t,e,r){return U(this,t,e,!0,r)},u.prototype.writeFloatBE=function(t,e,r){return U(this,t,e,!1,r)},u.prototype.writeDoubleLE=function(t,e,r){return M(this,t,e,!0,r)},u.prototype.writeDoubleBE=function(t,e,r){return M(this,t,e,!1,r)},u.prototype.copy=function(t,e,r,n){if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var i,a=n-r;if(this===t&&r<e&&e<n)for(i=a-1;i>=0;--i)t[i+e]=this[i+r];else if(a<1e3||!u.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)t[i+e]=this[i+r];else Uint8Array.prototype.set.call(t,this.subarray(r,r+a),e);return a},u.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),1===t.length){var i=t.charCodeAt(0);i<256&&(t=i)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!u.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof t&&(t&=255);if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var a;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(a=e;a<r;++a)this[a]=t;else{var o=u.isBuffer(t)?t:F(new u(t,n).toString()),s=o.length;for(a=0;a<r-e;++a)this[a+e]=o[a%s]}return this};var x=/[^+\/0-9A-Za-z-_]/g;function F(t,e){var r;e=e||1/0;for(var n=t.length,i=null,a=[],o=0;o<n;++o){if((r=t.charCodeAt(o))>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&a.push(239,191,189);continue}if(o+1===n){(e-=3)>-1&&a.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&a.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(e-=3)>-1&&a.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;a.push(r)}else if(r<2048){if((e-=2)<0)break;a.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;a.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;a.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return a}function V(t){return n.toByteArray(function(t){if((t=function(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}(t).replace(x,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function H(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}},645:(t,e)=>{e.read=function(t,e,r,n,i){var a,o,s=8*i-n-1,u=(1<<s)-1,c=u>>1,l=-7,f=r?i-1:0,h=r?-1:1,d=t[e+f];for(f+=h,a=d&(1<<-l)-1,d>>=-l,l+=s;l>0;a=256*a+t[e+f],f+=h,l-=8);for(o=a&(1<<-l)-1,a>>=-l,l+=n;l>0;o=256*o+t[e+f],f+=h,l-=8);if(0===a)a=1-c;else{if(a===u)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,n),a-=c}return(d?-1:1)*o*Math.pow(2,a-n)},e.write=function(t,e,r,n,i,a){var o,s,u,c=8*a-i-1,l=(1<<c)-1,f=l>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=n?0:a-1,p=n?1:-1,y=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,o=l):(o=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-o))<1&&(o--,u*=2),(e+=o+f>=1?h/u:h*Math.pow(2,1-f))*u>=2&&(o++,u/=2),o+f>=l?(s=0,o=l):o+f>=1?(s=(e*u-1)*Math.pow(2,i),o+=f):(s=e*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;t[r+d]=255&s,d+=p,s/=256,i-=8);for(o=o<<i|s,c+=i;c>0;t[r+d]=255&o,d+=p,o/=256,c-=8);t[r+d-p]|=128*y}},826:t=>{var e={}.toString;t.exports=Array.isArray||function(t){return"[object Array]"==e.call(t)}},155:t=>{var e,r,n=t.exports={};function i(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(t){if(e===setTimeout)return setTimeout(t,0);if((e===i||!e)&&setTimeout)return e=setTimeout,setTimeout(t,0);try{return e(t,0)}catch(r){try{return e.call(null,t,0)}catch(r){return e.call(this,t,0)}}}!function(){try{e="function"==typeof setTimeout?setTimeout:i}catch(t){e=i}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(t){r=a}}();var s,u=[],c=!1,l=-1;function f(){c&&s&&(c=!1,s.length?u=s.concat(u):l=-1,u.length&&h())}function h(){if(!c){var t=o(f);c=!0;for(var e=u.length;e;){for(s=u,u=[];++l<e;)s&&s[l].run();l=-1,e=u.length}s=null,c=!1,function(t){if(r===clearTimeout)return clearTimeout(t);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(t);try{r(t)}catch(e){try{return r.call(null,t)}catch(e){return r.call(this,t)}}}(t)}}function d(t,e){this.fun=t,this.array=e}function p(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)e[r-1]=arguments[r];u.push(new d(t,e)),1!==u.length||c||o(h)},d.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},509:(t,e,r)=>{var n=r(764),i=n.Buffer;function a(t,e){for(var r in t)e[r]=t[r]}function o(t,e,r){return i(t,e,r)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?t.exports=n:(a(n,e),e.Buffer=o),a(i,o),o.from=function(t,e,r){if("number"==typeof t)throw new TypeError("Argument must not be a number");return i(t,e,r)},o.alloc=function(t,e,r){if("number"!=typeof t)throw new TypeError("Argument must be a number");var n=i(t);return void 0!==e?"string"==typeof r?n.fill(e,r):n.fill(e):n.fill(0),n},o.allocUnsafe=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return i(t)},o.allocUnsafeSlow=function(t){if("number"!=typeof t)throw new TypeError("Argument must be a number");return n.SlowBuffer(t)}},99:(t,e,r)=>{!function(t){t.parser=function(t,e){return new i(t,e)},t.SAXParser=i,t.SAXStream=o,t.createStream=function(t,e){return new o(t,e)},t.MAX_BUFFER_LENGTH=65536;var e,n=["comment","sgmlDecl","textNode","tagName","doctype","procInstName","procInstBody","entity","attribName","attribValue","cdata","script"];function i(e,r){if(!(this instanceof i))return new i(e,r);var a=this;!function(t){for(var e=0,r=n.length;e<r;e++)t[n[e]]=""}(a),a.q=a.c="",a.bufferCheckPosition=t.MAX_BUFFER_LENGTH,a.opt=r||{},a.opt.lowercase=a.opt.lowercase||a.opt.lowercasetags,a.looseCase=a.opt.lowercase?"toLowerCase":"toUpperCase",a.tags=[],a.closed=a.closedRoot=a.sawRoot=!1,a.tag=a.error=null,a.strict=!!e,a.noscript=!(!e&&!a.opt.noscript),a.state=A.BEGIN,a.strictEntities=a.opt.strictEntities,a.ENTITIES=a.strictEntities?Object.create(t.XML_ENTITIES):Object.create(t.ENTITIES),a.attribList=[],a.opt.xmlns&&(a.ns=Object.create(c)),a.trackPosition=!1!==a.opt.position,a.trackPosition&&(a.position=a.line=a.column=0),E(a,"onready")}t.EVENTS=["text","processinginstruction","sgmldeclaration","doctype","comment","opentagstart","attribute","opentag","closetag","opencdata","cdata","closecdata","error","end","ready","script","opennamespace","closenamespace"],Object.create||(Object.create=function(t){function e(){}return e.prototype=t,new e}),Object.keys||(Object.keys=function(t){var e=[];for(var r in t)t.hasOwnProperty(r)&&e.push(r);return e}),i.prototype={end:function(){C(this)},write:function(e){var r=this;if(this.error)throw this.error;if(r.closed)return O(r,"Cannot write after close. Assign an onready handler.");if(null===e)return C(r);"object"==typeof e&&(e=e.toString());for(var i=0,a="";a=M(e,i++),r.c=a,a;)switch(r.trackPosition&&(r.position++,"\n"===a?(r.line++,r.column=0):r.column++),r.state){case A.BEGIN:if(r.state=A.BEGIN_WHITESPACE,"\ufeff"===a)continue;U(r,a);continue;case A.BEGIN_WHITESPACE:U(r,a);continue;case A.TEXT:if(r.sawRoot&&!r.closedRoot){for(var o=i-1;a&&"<"!==a&&"&"!==a;)(a=M(e,i++))&&r.trackPosition&&(r.position++,"\n"===a?(r.line++,r.column=0):r.column++);r.textNode+=e.substring(o,i-1)}"<"!==a||r.sawRoot&&r.closedRoot&&!r.strict?(p(a)||r.sawRoot&&!r.closedRoot||D(r,"Text data outside of root node."),"&"===a?r.state=A.TEXT_ENTITY:r.textNode+=a):(r.state=A.OPEN_WAKA,r.startTagPosition=r.position);continue;case A.SCRIPT:"<"===a?r.state=A.SCRIPT_ENDING:r.script+=a;continue;case A.SCRIPT_ENDING:"/"===a?r.state=A.CLOSE_TAG:(r.script+="<"+a,r.state=A.SCRIPT);continue;case A.OPEN_WAKA:if("!"===a)r.state=A.SGML_DECL,r.sgmlDecl="";else if(p(a));else if(g(l,a))r.state=A.OPEN_TAG,r.tagName=a;else if("/"===a)r.state=A.CLOSE_TAG,r.tagName="";else if("?"===a)r.state=A.PROC_INST,r.procInstName=r.procInstBody="";else{if(D(r,"Unencoded <"),r.startTagPosition+1<r.position){var s=r.position-r.startTagPosition;a=new Array(s).join(" ")+a}r.textNode+="<"+a,r.state=A.TEXT}continue;case A.SGML_DECL:"[CDATA["===(r.sgmlDecl+a).toUpperCase()?(S(r,"onopencdata"),r.state=A.CDATA,r.sgmlDecl="",r.cdata=""):r.sgmlDecl+a==="--"?(r.state=A.COMMENT,r.comment="",r.sgmlDecl=""):"DOCTYPE"===(r.sgmlDecl+a).toUpperCase()?(r.state=A.DOCTYPE,(r.doctype||r.sawRoot)&&D(r,"Inappropriately located doctype declaration"),r.doctype="",r.sgmlDecl=""):">"===a?(S(r,"onsgmldeclaration",r.sgmlDecl),r.sgmlDecl="",r.state=A.TEXT):y(a)?(r.state=A.SGML_DECL_QUOTED,r.sgmlDecl+=a):r.sgmlDecl+=a;continue;case A.SGML_DECL_QUOTED:a===r.q&&(r.state=A.SGML_DECL,r.q=""),r.sgmlDecl+=a;continue;case A.DOCTYPE:">"===a?(r.state=A.TEXT,S(r,"ondoctype",r.doctype),r.doctype=!0):(r.doctype+=a,"["===a?r.state=A.DOCTYPE_DTD:y(a)&&(r.state=A.DOCTYPE_QUOTED,r.q=a));continue;case A.DOCTYPE_QUOTED:r.doctype+=a,a===r.q&&(r.q="",r.state=A.DOCTYPE);continue;case A.DOCTYPE_DTD:r.doctype+=a,"]"===a?r.state=A.DOCTYPE:y(a)&&(r.state=A.DOCTYPE_DTD_QUOTED,r.q=a);continue;case A.DOCTYPE_DTD_QUOTED:r.doctype+=a,a===r.q&&(r.state=A.DOCTYPE_DTD,r.q="");continue;case A.COMMENT:"-"===a?r.state=A.COMMENT_ENDING:r.comment+=a;continue;case A.COMMENT_ENDING:"-"===a?(r.state=A.COMMENT_ENDED,r.comment=I(r.opt,r.comment),r.comment&&S(r,"oncomment",r.comment),r.comment=""):(r.comment+="-"+a,r.state=A.COMMENT);continue;case A.COMMENT_ENDED:">"!==a?(D(r,"Malformed comment"),r.comment+="--"+a,r.state=A.COMMENT):r.state=A.TEXT;continue;case A.CDATA:"]"===a?r.state=A.CDATA_ENDING:r.cdata+=a;continue;case A.CDATA_ENDING:"]"===a?r.state=A.CDATA_ENDING_2:(r.cdata+="]"+a,r.state=A.CDATA);continue;case A.CDATA_ENDING_2:">"===a?(r.cdata&&S(r,"oncdata",r.cdata),S(r,"onclosecdata"),r.cdata="",r.state=A.TEXT):"]"===a?r.cdata+="]":(r.cdata+="]]"+a,r.state=A.CDATA);continue;case A.PROC_INST:"?"===a?r.state=A.PROC_INST_ENDING:p(a)?r.state=A.PROC_INST_BODY:r.procInstName+=a;continue;case A.PROC_INST_BODY:if(!r.procInstBody&&p(a))continue;"?"===a?r.state=A.PROC_INST_ENDING:r.procInstBody+=a;continue;case A.PROC_INST_ENDING:">"===a?(S(r,"onprocessinginstruction",{name:r.procInstName,body:r.procInstBody}),r.procInstName=r.procInstBody="",r.state=A.TEXT):(r.procInstBody+="?"+a,r.state=A.PROC_INST_BODY);continue;case A.OPEN_TAG:g(f,a)?r.tagName+=a:(R(r),">"===a?_(r):"/"===a?r.state=A.OPEN_TAG_SLASH:(p(a)||D(r,"Invalid character in tag name"),r.state=A.ATTRIB));continue;case A.OPEN_TAG_SLASH:">"===a?(_(r,!0),B(r)):(D(r,"Forward-slash in opening tag not followed by >"),r.state=A.ATTRIB);continue;case A.ATTRIB:if(p(a))continue;">"===a?_(r):"/"===a?r.state=A.OPEN_TAG_SLASH:g(l,a)?(r.attribName=a,r.attribValue="",r.state=A.ATTRIB_NAME):D(r,"Invalid attribute name");continue;case A.ATTRIB_NAME:"="===a?r.state=A.ATTRIB_VALUE:">"===a?(D(r,"Attribute without value"),r.attribValue=r.attribName,L(r),_(r)):p(a)?r.state=A.ATTRIB_NAME_SAW_WHITE:g(f,a)?r.attribName+=a:D(r,"Invalid attribute name");continue;case A.ATTRIB_NAME_SAW_WHITE:if("="===a)r.state=A.ATTRIB_VALUE;else{if(p(a))continue;D(r,"Attribute without value"),r.tag.attributes[r.attribName]="",r.attribValue="",S(r,"onattribute",{name:r.attribName,value:""}),r.attribName="",">"===a?_(r):g(l,a)?(r.attribName=a,r.state=A.ATTRIB_NAME):(D(r,"Invalid attribute name"),r.state=A.ATTRIB)}continue;case A.ATTRIB_VALUE:if(p(a))continue;y(a)?(r.q=a,r.state=A.ATTRIB_VALUE_QUOTED):(D(r,"Unquoted attribute value"),r.state=A.ATTRIB_VALUE_UNQUOTED,r.attribValue=a);continue;case A.ATTRIB_VALUE_QUOTED:if(a!==r.q){"&"===a?r.state=A.ATTRIB_VALUE_ENTITY_Q:r.attribValue+=a;continue}L(r),r.q="",r.state=A.ATTRIB_VALUE_CLOSED;continue;case A.ATTRIB_VALUE_CLOSED:p(a)?r.state=A.ATTRIB:">"===a?_(r):"/"===a?r.state=A.OPEN_TAG_SLASH:g(l,a)?(D(r,"No whitespace between attributes"),r.attribName=a,r.attribValue="",r.state=A.ATTRIB_NAME):D(r,"Invalid attribute name");continue;case A.ATTRIB_VALUE_UNQUOTED:if(!v(a)){"&"===a?r.state=A.ATTRIB_VALUE_ENTITY_U:r.attribValue+=a;continue}L(r),">"===a?_(r):r.state=A.ATTRIB;continue;case A.CLOSE_TAG:if(r.tagName)">"===a?B(r):g(f,a)?r.tagName+=a:r.script?(r.script+="</"+r.tagName,r.tagName="",r.state=A.SCRIPT):(p(a)||D(r,"Invalid tagname in closing tag"),r.state=A.CLOSE_TAG_SAW_WHITE);else{if(p(a))continue;b(l,a)?r.script?(r.script+="</"+a,r.state=A.SCRIPT):D(r,"Invalid tagname in closing tag."):r.tagName=a}continue;case A.CLOSE_TAG_SAW_WHITE:if(p(a))continue;">"===a?B(r):D(r,"Invalid characters in closing tag");continue;case A.TEXT_ENTITY:case A.ATTRIB_VALUE_ENTITY_Q:case A.ATTRIB_VALUE_ENTITY_U:var u,c;switch(r.state){case A.TEXT_ENTITY:u=A.TEXT,c="textNode";break;case A.ATTRIB_VALUE_ENTITY_Q:u=A.ATTRIB_VALUE_QUOTED,c="attribValue";break;case A.ATTRIB_VALUE_ENTITY_U:u=A.ATTRIB_VALUE_UNQUOTED,c="attribValue"}";"===a?(r[c]+=j(r),r.entity="",r.state=u):g(r.entity.length?d:h,a)?r.entity+=a:(D(r,"Invalid character in entity name"),r[c]+="&"+r.entity+a,r.entity="",r.state=u);continue;default:throw new Error(r,"Unknown state: "+r.state)}return r.position>=r.bufferCheckPosition&&function(e){for(var r=Math.max(t.MAX_BUFFER_LENGTH,10),i=0,a=0,o=n.length;a<o;a++){var s=e[n[a]].length;if(s>r)switch(n[a]){case"textNode":P(e);break;case"cdata":S(e,"oncdata",e.cdata),e.cdata="";break;case"script":S(e,"onscript",e.script),e.script="";break;default:O(e,"Max buffer length exceeded: "+n[a])}i=Math.max(i,s)}var u=t.MAX_BUFFER_LENGTH-i;e.bufferCheckPosition=u+e.position}(r),r},resume:function(){return this.error=null,this},close:function(){return this.write(null)},flush:function(){var t;P(t=this),""!==t.cdata&&(S(t,"oncdata",t.cdata),t.cdata=""),""!==t.script&&(S(t,"onscript",t.script),t.script="")}};try{e=Object(function(){var t=new Error("Cannot find module 'stream'");throw t.code="MODULE_NOT_FOUND",t}())}catch(t){e=function(){}}var a=t.EVENTS.filter((function(t){return"error"!==t&&"end"!==t}));function o(t,r){if(!(this instanceof o))return new o(t,r);e.apply(this),this._parser=new i(t,r),this.writable=!0,this.readable=!0;var n=this;this._parser.onend=function(){n.emit("end")},this._parser.onerror=function(t){n.emit("error",t),n._parser.error=null},this._decoder=null,a.forEach((function(t){Object.defineProperty(n,"on"+t,{get:function(){return n._parser["on"+t]},set:function(e){if(!e)return n.removeAllListeners(t),n._parser["on"+t]=e,e;n.on(t,e)},enumerable:!0,configurable:!1})}))}o.prototype=Object.create(e.prototype,{constructor:{value:o}}),o.prototype.write=function(t){if("function"==typeof Buffer&&"function"==typeof Buffer.isBuffer&&Buffer.isBuffer(t)){if(!this._decoder){var e=r(553).s;this._decoder=new e("utf8")}t=this._decoder.write(t)}return this._parser.write(t.toString()),this.emit("data",t),!0},o.prototype.end=function(t){return t&&t.length&&this.write(t),this._parser.end(),!0},o.prototype.on=function(t,r){var n=this;return n._parser["on"+t]||-1===a.indexOf(t)||(n._parser["on"+t]=function(){var e=1===arguments.length?[arguments[0]]:Array.apply(null,arguments);e.splice(0,0,t),n.emit.apply(n,e)}),e.prototype.on.call(n,t,r)};var s="http://www.w3.org/XML/1998/namespace",u="http://www.w3.org/2000/xmlns/",c={xml:s,xmlns:u},l=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,f=/[:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/,h=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,d=/[#:_A-Za-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\u00B7\u0300-\u036F\u203F-\u2040.\d-]/;function p(t){return" "===t||"\n"===t||"\r"===t||"\t"===t}function y(t){return'"'===t||"'"===t}function v(t){return">"===t||p(t)}function g(t,e){return t.test(e)}function b(t,e){return!g(t,e)}var m,k,T,A=0;for(var w in t.STATE={BEGIN:A++,BEGIN_WHITESPACE:A++,TEXT:A++,TEXT_ENTITY:A++,OPEN_WAKA:A++,SGML_DECL:A++,SGML_DECL_QUOTED:A++,DOCTYPE:A++,DOCTYPE_QUOTED:A++,DOCTYPE_DTD:A++,DOCTYPE_DTD_QUOTED:A++,COMMENT_STARTING:A++,COMMENT:A++,COMMENT_ENDING:A++,COMMENT_ENDED:A++,CDATA:A++,CDATA_ENDING:A++,CDATA_ENDING_2:A++,PROC_INST:A++,PROC_INST_BODY:A++,PROC_INST_ENDING:A++,OPEN_TAG:A++,OPEN_TAG_SLASH:A++,ATTRIB:A++,ATTRIB_NAME:A++,ATTRIB_NAME_SAW_WHITE:A++,ATTRIB_VALUE:A++,ATTRIB_VALUE_QUOTED:A++,ATTRIB_VALUE_CLOSED:A++,ATTRIB_VALUE_UNQUOTED:A++,ATTRIB_VALUE_ENTITY_Q:A++,ATTRIB_VALUE_ENTITY_U:A++,CLOSE_TAG:A++,CLOSE_TAG_SAW_WHITE:A++,SCRIPT:A++,SCRIPT_ENDING:A++},t.XML_ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'"},t.ENTITIES={amp:"&",gt:">",lt:"<",quot:'"',apos:"'",AElig:198,Aacute:193,Acirc:194,Agrave:192,Aring:197,Atilde:195,Auml:196,Ccedil:199,ETH:208,Eacute:201,Ecirc:202,Egrave:200,Euml:203,Iacute:205,Icirc:206,Igrave:204,Iuml:207,Ntilde:209,Oacute:211,Ocirc:212,Ograve:210,Oslash:216,Otilde:213,Ouml:214,THORN:222,Uacute:218,Ucirc:219,Ugrave:217,Uuml:220,Yacute:221,aacute:225,acirc:226,aelig:230,agrave:224,aring:229,atilde:227,auml:228,ccedil:231,eacute:233,ecirc:234,egrave:232,eth:240,euml:235,iacute:237,icirc:238,igrave:236,iuml:239,ntilde:241,oacute:243,ocirc:244,ograve:242,oslash:248,otilde:245,ouml:246,szlig:223,thorn:254,uacute:250,ucirc:251,ugrave:249,uuml:252,yacute:253,yuml:255,copy:169,reg:174,nbsp:160,iexcl:161,cent:162,pound:163,curren:164,yen:165,brvbar:166,sect:167,uml:168,ordf:170,laquo:171,not:172,shy:173,macr:175,deg:176,plusmn:177,sup1:185,sup2:178,sup3:179,acute:180,micro:181,para:182,middot:183,cedil:184,ordm:186,raquo:187,frac14:188,frac12:189,frac34:190,iquest:191,times:215,divide:247,OElig:338,oelig:339,Scaron:352,scaron:353,Yuml:376,fnof:402,circ:710,tilde:732,Alpha:913,Beta:914,Gamma:915,Delta:916,Epsilon:917,Zeta:918,Eta:919,Theta:920,Iota:921,Kappa:922,Lambda:923,Mu:924,Nu:925,Xi:926,Omicron:927,Pi:928,Rho:929,Sigma:931,Tau:932,Upsilon:933,Phi:934,Chi:935,Psi:936,Omega:937,alpha:945,beta:946,gamma:947,delta:948,epsilon:949,zeta:950,eta:951,theta:952,iota:953,kappa:954,lambda:955,mu:956,nu:957,xi:958,omicron:959,pi:960,rho:961,sigmaf:962,sigma:963,tau:964,upsilon:965,phi:966,chi:967,psi:968,omega:969,thetasym:977,upsih:978,piv:982,ensp:8194,emsp:8195,thinsp:8201,zwnj:8204,zwj:8205,lrm:8206,rlm:8207,ndash:8211,mdash:8212,lsquo:8216,rsquo:8217,sbquo:8218,ldquo:8220,rdquo:8221,bdquo:8222,dagger:8224,Dagger:8225,bull:8226,hellip:8230,permil:8240,prime:8242,Prime:8243,lsaquo:8249,rsaquo:8250,oline:8254,frasl:8260,euro:8364,image:8465,weierp:8472,real:8476,trade:8482,alefsym:8501,larr:8592,uarr:8593,rarr:8594,darr:8595,harr:8596,crarr:8629,lArr:8656,uArr:8657,rArr:8658,dArr:8659,hArr:8660,forall:8704,part:8706,exist:8707,empty:8709,nabla:8711,isin:8712,notin:8713,ni:8715,prod:8719,sum:8721,minus:8722,lowast:8727,radic:8730,prop:8733,infin:8734,ang:8736,and:8743,or:8744,cap:8745,cup:8746,int:8747,there4:8756,sim:8764,cong:8773,asymp:8776,ne:8800,equiv:8801,le:8804,ge:8805,sub:8834,sup:8835,nsub:8836,sube:8838,supe:8839,oplus:8853,otimes:8855,perp:8869,sdot:8901,lceil:8968,rceil:8969,lfloor:8970,rfloor:8971,lang:9001,rang:9002,loz:9674,spades:9824,clubs:9827,hearts:9829,diams:9830},Object.keys(t.ENTITIES).forEach((function(e){var r=t.ENTITIES[e],n="number"==typeof r?String.fromCharCode(r):r;t.ENTITIES[e]=n})),t.STATE)t.STATE[t.STATE[w]]=w;function E(t,e,r){t[e]&&t[e](r)}function S(t,e,r){t.textNode&&P(t),E(t,e,r)}function P(t){t.textNode=I(t.opt,t.textNode),t.textNode&&E(t,"ontext",t.textNode),t.textNode=""}function I(t,e){return t.trim&&(e=e.trim()),t.normalize&&(e=e.replace(/\s+/g," ")),e}function O(t,e){return P(t),t.trackPosition&&(e+="\nLine: "+t.line+"\nColumn: "+t.column+"\nChar: "+t.c),e=new Error(e),t.error=e,E(t,"onerror",e),t}function C(t){return t.sawRoot&&!t.closedRoot&&D(t,"Unclosed root tag"),t.state!==A.BEGIN&&t.state!==A.BEGIN_WHITESPACE&&t.state!==A.TEXT&&O(t,"Unexpected end"),P(t),t.c="",t.closed=!0,E(t,"onend"),i.call(t,t.strict,t.opt),t}function D(t,e){if("object"!=typeof t||!(t instanceof i))throw new Error("bad call to strictFail");t.strict&&O(t,e)}function R(t){t.strict||(t.tagName=t.tagName[t.looseCase]());var e=t.tags[t.tags.length-1]||t,r=t.tag={name:t.tagName,attributes:{}};t.opt.xmlns&&(r.ns=e.ns),t.attribList.length=0,S(t,"onopentagstart",r)}function N(t,e){var r=t.indexOf(":")<0?["",t]:t.split(":"),n=r[0],i=r[1];return e&&"xmlns"===t&&(n="xmlns",i=""),{prefix:n,local:i}}function L(t){if(t.strict||(t.attribName=t.attribName[t.looseCase]()),-1!==t.attribList.indexOf(t.attribName)||t.tag.attributes.hasOwnProperty(t.attribName))t.attribName=t.attribValue="";else{if(t.opt.xmlns){var e=N(t.attribName,!0),r=e.prefix,n=e.local;if("xmlns"===r)if("xml"===n&&t.attribValue!==s)D(t,"xml: prefix must be bound to "+s+"\nActual: "+t.attribValue);else if("xmlns"===n&&t.attribValue!==u)D(t,"xmlns: prefix must be bound to "+u+"\nActual: "+t.attribValue);else{var i=t.tag,a=t.tags[t.tags.length-1]||t;i.ns===a.ns&&(i.ns=Object.create(a.ns)),i.ns[n]=t.attribValue}t.attribList.push([t.attribName,t.attribValue])}else t.tag.attributes[t.attribName]=t.attribValue,S(t,"onattribute",{name:t.attribName,value:t.attribValue});t.attribName=t.attribValue=""}}function _(t,e){if(t.opt.xmlns){var r=t.tag,n=N(t.tagName);r.prefix=n.prefix,r.local=n.local,r.uri=r.ns[n.prefix]||"",r.prefix&&!r.uri&&(D(t,"Unbound namespace prefix: "+JSON.stringify(t.tagName)),r.uri=n.prefix);var i=t.tags[t.tags.length-1]||t;r.ns&&i.ns!==r.ns&&Object.keys(r.ns).forEach((function(e){S(t,"onopennamespace",{prefix:e,uri:r.ns[e]})}));for(var a=0,o=t.attribList.length;a<o;a++){var s=t.attribList[a],u=s[0],c=s[1],l=N(u,!0),f=l.prefix,h=l.local,d=""===f?"":r.ns[f]||"",p={name:u,value:c,prefix:f,local:h,uri:d};f&&"xmlns"!==f&&!d&&(D(t,"Unbound namespace prefix: "+JSON.stringify(f)),p.uri=f),t.tag.attributes[u]=p,S(t,"onattribute",p)}t.attribList.length=0}t.tag.isSelfClosing=!!e,t.sawRoot=!0,t.tags.push(t.tag),S(t,"onopentag",t.tag),e||(t.noscript||"script"!==t.tagName.toLowerCase()?t.state=A.TEXT:t.state=A.SCRIPT,t.tag=null,t.tagName=""),t.attribName=t.attribValue="",t.attribList.length=0}function B(t){if(!t.tagName)return D(t,"Weird empty close tag."),t.textNode+="</>",void(t.state=A.TEXT);if(t.script){if("script"!==t.tagName)return t.script+="</"+t.tagName+">",t.tagName="",void(t.state=A.SCRIPT);S(t,"onscript",t.script),t.script=""}var e=t.tags.length,r=t.tagName;t.strict||(r=r[t.looseCase]());for(var n=r;e--&&t.tags[e].name!==n;)D(t,"Unexpected close tag");if(e<0)return D(t,"Unmatched closing tag: "+t.tagName),t.textNode+="</"+t.tagName+">",void(t.state=A.TEXT);t.tagName=r;for(var i=t.tags.length;i-- >e;){var a=t.tag=t.tags.pop();t.tagName=t.tag.name,S(t,"onclosetag",t.tagName);var o={};for(var s in a.ns)o[s]=a.ns[s];var u=t.tags[t.tags.length-1]||t;t.opt.xmlns&&a.ns!==u.ns&&Object.keys(a.ns).forEach((function(e){var r=a.ns[e];S(t,"onclosenamespace",{prefix:e,uri:r})}))}0===e&&(t.closedRoot=!0),t.tagName=t.attribValue=t.attribName="",t.attribList.length=0,t.state=A.TEXT}function j(t){var e,r=t.entity,n=r.toLowerCase(),i="";return t.ENTITIES[r]?t.ENTITIES[r]:t.ENTITIES[n]?t.ENTITIES[n]:("#"===(r=n).charAt(0)&&("x"===r.charAt(1)?(r=r.slice(2),i=(e=parseInt(r,16)).toString(16)):(r=r.slice(1),i=(e=parseInt(r,10)).toString(10))),r=r.replace(/^0+/,""),isNaN(e)||i.toLowerCase()!==r?(D(t,"Invalid character entity"),"&"+t.entity+";"):String.fromCodePoint(e))}function U(t,e){"<"===e?(t.state=A.OPEN_WAKA,t.startTagPosition=t.position):p(e)||(D(t,"Non-whitespace before first tag."),t.textNode=e,t.state=A.TEXT)}function M(t,e){var r="";return e<t.length&&(r=t.charAt(e)),r}A=t.STATE,String.fromCodePoint||(m=String.fromCharCode,k=Math.floor,T=function(){var t,e,r=16384,n=[],i=-1,a=arguments.length;if(!a)return"";for(var o="";++i<a;){var s=Number(arguments[i]);if(!isFinite(s)||s<0||s>1114111||k(s)!==s)throw RangeError("Invalid code point: "+s);s<=65535?n.push(s):(t=55296+((s-=65536)>>10),e=s%1024+56320,n.push(t,e)),(i+1===a||n.length>r)&&(o+=m.apply(null,n),n.length=0)}return o},Object.defineProperty?Object.defineProperty(String,"fromCodePoint",{value:T,configurable:!0,writable:!0}):String.fromCodePoint=T)}(e)},553:(t,e,r)=>{"use strict";var n=r(509).Buffer,i=n.isEncoding||function(t){switch((t=""+t)&&t.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function a(t){var e;switch(this.encoding=function(t){var e=function(t){if(!t)return"utf8";for(var e;;)switch(t){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return t;default:if(e)return;t=(""+t).toLowerCase(),e=!0}}(t);if("string"!=typeof e&&(n.isEncoding===i||!i(t)))throw new Error("Unknown encoding: "+t);return e||t}(t),this.encoding){case"utf16le":this.text=u,this.end=c,e=4;break;case"utf8":this.fillLast=s,e=4;break;case"base64":this.text=l,this.end=f,e=3;break;default:return this.write=h,void(this.end=d)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(e)}function o(t){return t<=127?0:t>>5==6?2:t>>4==14?3:t>>3==30?4:t>>6==2?-1:-2}function s(t){var e=this.lastTotal-this.lastNeed,r=function(t,e,r){if(128!=(192&e[0]))return t.lastNeed=0,"�";if(t.lastNeed>1&&e.length>1){if(128!=(192&e[1]))return t.lastNeed=1,"�";if(t.lastNeed>2&&e.length>2&&128!=(192&e[2]))return t.lastNeed=2,"�"}}(this,t);return void 0!==r?r:this.lastNeed<=t.length?(t.copy(this.lastChar,e,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(t.copy(this.lastChar,e,0,t.length),void(this.lastNeed-=t.length))}function u(t,e){if((t.length-e)%2==0){var r=t.toString("utf16le",e);if(r){var n=r.charCodeAt(r.length-1);if(n>=55296&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=t[t.length-1],t.toString("utf16le",e,t.length-1)}function c(t){var e=t&&t.length?this.write(t):"";if(this.lastNeed){var r=this.lastTotal-this.lastNeed;return e+this.lastChar.toString("utf16le",0,r)}return e}function l(t,e){var r=(t.length-e)%3;return 0===r?t.toString("base64",e):(this.lastNeed=3-r,this.lastTotal=3,1===r?this.lastChar[0]=t[t.length-1]:(this.lastChar[0]=t[t.length-2],this.lastChar[1]=t[t.length-1]),t.toString("base64",e,t.length-r))}function f(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+this.lastChar.toString("base64",0,3-this.lastNeed):e}function h(t){return t.toString(this.encoding)}function d(t){return t&&t.length?this.write(t):""}e.s=a,a.prototype.write=function(t){if(0===t.length)return"";var e,r;if(this.lastNeed){if(void 0===(e=this.fillLast(t)))return"";r=this.lastNeed,this.lastNeed=0}else r=0;return r<t.length?e?e+this.text(t,r):this.text(t,r):e||""},a.prototype.end=function(t){var e=t&&t.length?this.write(t):"";return this.lastNeed?e+"�":e},a.prototype.text=function(t,e){var r=function(t,e,r){var n=e.length-1;if(n<r)return 0;var i=o(e[n]);return i>=0?(i>0&&(t.lastNeed=i-1),i):--n<r||-2===i?0:(i=o(e[n]))>=0?(i>0&&(t.lastNeed=i-2),i):--n<r||-2===i?0:(i=o(e[n]))>=0?(i>0&&(2===i?i=0:t.lastNeed=i-3),i):0}(this,t,e);if(!this.lastNeed)return t.toString("utf8",e);this.lastTotal=r;var n=t.length-(r-this.lastNeed);return t.copy(this.lastChar,0,n),t.toString("utf8",e,n)},a.prototype.fillLast=function(t){if(this.lastNeed<=t.length)return t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);t.copy(this.lastChar,this.lastTotal-this.lastNeed,0,t.length),this.lastNeed-=t.length}},147:t=>{"use strict";t.exports=JSON.parse('{"name":"@yospace/admanagement-sdk","version":"3.5.2","description":"Yospace AdManagement SDK","homepage":"https://yospace.com","main":"lib/index.js","types":"types/index.d.ts","private":false,"dependencies":{"sax":"1.2.4"},"devDependencies":{"@babel/core":"^7.18.10","@babel/plugin-transform-modules-commonjs":"^7.18.6","@babel/preset-env":"^7.18.10","babel-jest":"^28.1.3","babel-loader":"^8.2.5","babel-plugin-transform-es2015-modules-simple-commonjs":"^0.3.0","better-docs":"^2.7.2","docdash":"1.2.0","documentation":"^13.2.5","jest":"^28.1.3","jest-junit":"^14.0.0","jest-sonar-reporter":"^2.0.0","jsdoc":"^3.6.11","jsdoc-fresh":"^2.0.0","jsdoc-mermaid":"^1.0.0","jshint":"^2.13.5","msw":"^0.44.2","node-fetch":"^3.2.10","nodemon":"^2.0.19","npm-check-updates":"^16.0.5","nwb":"^0.25.2","process":"0.11.10","stream-browserify":"3.0.0","typescript":"^4.7.4","webpack":"^5.74.0","webpack-cli":"^4.10.0","ws":"^8.8.1"},"scripts":{"build":"webpack","build-es5":"webpack --config webpack.config-es5.js","build:npm":"nwb build --no-demo","doc":"documentation build src/** -f html -o Documentation/html --theme src-docs/apidoctemplate","lint":"jshint --config .jshintrc ./src/ || true","test":"jest --runInBand --coverage --forceExit --bail","testUnit":"jest --runInBand --coverage --forceExit -t UNIT","testIntegration":"jest --runInBand --coverage --forceExit --bail -t INTEGRATION","tsdefs":"npx -p typescript tsc src/index.js --stripInternal --declaration --allowJs --emitDeclarationOnly --outDir types","tsdefsHosting":"npx -p typescript tsc src/index.js --stripInternal --declaration --allowJs --emitDeclarationOnly --outDir types-${npm_package_version}"},"author":{"name":"Yospace Technologies Ltd","email":"sdk-team@yospace.com"},"license":"SEE LICENSE IN LICENCE","files":["lib/","docs/","types/"]}')}},e={};function r(n){var i=e[n];if(void 0!==i)return i.exports;var a=e[n]={exports:{}};return t[n](a,a.exports,r),a.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var n in e)r.o(e,n)&&!r.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var n={};(()=>{"use strict";function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}r.r(n),r.d(n,{AdBreak:()=>Gn,AdVerification:()=>qr,Advert:()=>jn,AdvertEventHandler:()=>Pr,AdvertWrapper:()=>Jn,AnalyticBroker:()=>Nt,AnalyticEventObserver:()=>_t,BreakType:()=>qn,CAT_AD_BREAK_EVENTS:()=>v,CAT_TIMELINE_EVENTS:()=>g,CONNECTION_ERROR:()=>_e,CONNECTION_TIMEOUT:()=>Be,CompanionAds:()=>rr,Creative:()=>Xt,CreativeEventHandler:()=>Vt,DEBUG_ALL:()=>O,DEBUG_HTTP_REQUESTS:()=>S,DEBUG_LIFECYCLE:()=>T,DEBUG_PARSING:()=>P,DEBUG_PLAYBACK:()=>k,DEBUG_POLLING:()=>A,DEBUG_REPORTS:()=>w,DEBUG_STATE_MACHINE:()=>E,DEBUG_VALIDATION:()=>I,IconClickFallbackImage:()=>$r,IndustryIcon:()=>sn,InteractiveCreative:()=>Pn,LinearCreative:()=>ye,MALFORMED_URL:()=>je,NonLinearCreative:()=>bn,PlaybackEventHandler:()=>St,PlaybackMode:()=>De,PlaybackPolicy:()=>ft,PlaybackPolicyHandler:()=>ge,PlayerEvent:()=>wt,Resource:()=>Je,ResourceType:()=>$e,Session:()=>xe,SessionDVRLive:()=>ja,SessionErrorCode:()=>Le,SessionLive:()=>Xa,SessionProperties:()=>Fe,SessionResult:()=>Ne,SessionState:()=>Re,SessionVOD:()=>io,TimedMetadata:()=>yt,UNKNOWN_FORMAT:()=>Ue,VASTProperty:()=>Ci,VerificationEventHandler:()=>Br,ViewSize:()=>Et,ViewableEvent:()=>Sr,YoLog:()=>C});var e=function(){function e(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e)}var r,n;return r=e,n=[{key:"debug",value:function(t){console.log(t)}},{key:"error",value:function(t){console.error(t)}},{key:"info",value:function(t){console.info(t)}},{key:"warn",value:function(t){console.warn(t)}}],null&&t(r.prototype,null),n&&t(r,n),Object.defineProperty(r,"prototype",{writable:!1}),e}(),i=r(155),a=i.env.HTTP_AGENT?i.env.HTTP_AGENT:"Yospace SDK/3.0",o=["mute","unmute","pause","resume","rewind","playerExpand","playerCollapse","closeLinear","skip"],s=["creativeView"],u=["interactiveStart"],c=["loaded","start","firstQuartile","midpoint","thirdQuartile","complete","progress","mute","unmute","pause","resume","rewind","playerExpand","playerCollapse","closeLinear","skip","otherAdInteraction"],l=["creativeView","mute","unmute","pause","resume","rewind","skip","playerExpand","playerCollapse","adExpand","adCollapse","minimize","overlayViewDuration","acceptInvitation","close","otherAdInteraction"],f=["creativeView","close","interactiveStart"],h=["verificationNotExecuted"],d=["loaded","start","firstQuartile","midpoint","thirdQuartile","complete","progress"],p=["breakStart","breakEnd"],y=Object.freeze({ADVERT_START_TIMESLOT:5,DEFAULT_POLLING_DELAY:11e3,EVENT_CUEPOINT_TOL:10,EXPECTED_POLL_COMPLETE_TIME:250,INTERSEGMENT_TIMEOUT:2700,REQUEST_TIMEOUT:5e3,MAX_CADENCE:250,MIN_INTRASEGMENT_TIMEOUT:2500,MIN_SEGMENT_LENGTH:2e3,USER_AGENT:a}),v=1,g=2,b=Object.freeze({IDENTIFIER:"SESSIONIDENTIFIER",LOCATION:"LOCATION",HOSTNODE:"HOST",PORT:"PORT",ANALYTICURL:"ANALYTICURL",PAUSEURL:"PAUSEURL",SCHEME:"SCHEME",QS:"QUERYSTRING",AVAILABILITYSTART:"AVAILABILITYSTARTTIME"});function m(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var k=1,T=2,A=4,w=8,E=16,S=32,P=64,I=128,O=Number.MAX_SAFE_INTEGER,C=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,r=[{key:"setLogger",value:function(e){t.logger=e}},{key:"setDebugFlags",value:function(e){t.debugflags=e}},{key:"getDebugFlags",value:function(){return t.debugflags}},{key:"d",value:function(e,r){t.debugflags&e&&t.logger.debug("YoAdManagement: "+r)}},{key:"e",value:function(e){t.logger.error("YoAdManagement: "+e)}},{key:"i",value:function(e,r){t.debugflags&e&&t.logger.info("YoAdManagement: "+r)}},{key:"w",value:function(e){t.logger.warn("YoAdManagement: "+e)}},{key:"trace",value:function(e){t.d(I,"["+Date.now()+"][YoSDK:"+e+"]")}}],null&&m(e.prototype,null),r&&m(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function D(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}C.debugflags=0,C.logger=e;var R=function(){function t(){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(this instanceof t?this.constructor:void 0)===t)throw new TypeError("Cannot construct abstract class XmlValidation directly")}var e,r;return e=t,(r=[{key:"isValid",value:function(){return!0}}])&&D(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function N(t){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},N(t)}function L(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function B(t,e){return B=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},B(t,e)}function j(t,e){if(e&&("object"===N(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function U(t){return U=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},U(t)}var M=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&B(t,e)}(o,t);var e,r,n,i,a=(n=o,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=U(n);if(i){var r=U(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return j(this,t)});function o(){return L(this,o),a.apply(this,arguments)}return e=o,(r=[{key:"onNonLinearTrackingEvent",value:function(t){throw new Error("Function must be overridden")}}])&&_(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(R);function x(t,e){return null===t?null===e:void 0===t?void 0===e:!(!F(t)||!F(e))&&t.toUpperCase()===e.toUpperCase()}function F(t){return"string"==typeof t||t instanceof String}function V(t){return t?"    "+t.toString().replace("\n","\n    "):"null"}function H(t){return!t||""===t}function Y(t,e,r){var n=t;if(0===e||">"===e){n+="\n";for(var i=0;i<4*r;++i)n+=" "}return n}function q(t,e){if(!t||0===t.length||-1===t.indexOf("T"))return e;var r=t.substring(t.indexOf("T"),t.length-1);-1===r.indexOf("+")&&-1===r.indexOf("-")&&Number.isInteger(Number.parseInt(t.charAt(t.length-1)))&&(t+="Z");var n=Date.parse(t);return Number.isNaN(n)?e:n}function W(t,e){var r=void 0!==e?e:0;if(!("string"==typeof t&&t.length>0))return r;var n=t.split(":");if(3!==n.length)return r;var i=parseInt(n[0]),a=parseInt(n[1]);if(Number.isNaN(i)||Number.isNaN(a))return r;var o=0,s=0,u=n[2].split(".");return 2!==u.length?o=parseInt(n[2]):(o=parseInt(u[0]),s=parseInt(u[1])),Number.isNaN(o)||Number.isNaN(s)||i>23||a>59||o>59?r:36e5*i+6e4*a+1e3*o+s}function G(t){var e=Math.floor(t/1e3%60),r=Math.floor(t/6e4%60),n=Math.floor(t/36e5%24);return t=Math.round(t%1e3),"".concat(n<10?0:"").concat(n,":").concat(r<10?0:"").concat(r,":").concat(e<10?0:"").concat(e,".").concat(t<10?"00":t<100?"0":"").concat(t)}function z(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function X(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var K=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.trackingEvent=e,this.trackingUrls=JSON.parse(JSON.stringify(r||[]))}var e,r,n;return e=t,n=[{key:"categoryForEvent",value:function(e){return t.isValidAdBreakEvent(e)?v:t.isTimelineEvent(e)?g:0}},{key:"isValidPlayerOperationEvent",value:function(t){return-1!==o.indexOf(t)}},{key:"isValidCompanionEvent",value:function(t){return-1!==s.indexOf(t)}},{key:"isValidInteractiveEvent",value:function(t){return-1!==u.indexOf(t)}},{key:"isValidLinearEvent",value:function(t){return-1!==c.indexOf(t)}},{key:"isValidNonLinearEvent",value:function(t){return-1!==l.indexOf(t)}},{key:"isValidVerificationEvent",value:function(t){return-1!==h.indexOf(t)}},{key:"isTimelineEvent",value:function(t){return-1!==d.indexOf(t)}},{key:"isValidAdBreakEvent",value:function(t){return-1!==p.indexOf(t)}},{key:"isValidVisibleEvent",value:function(t){return-1!==f.indexOf(t)}}],(r=[{key:"addTrackingUrl",value:function(t){t?this.trackingUrls.push(t):C.e("addTrackingUrl: url was null")}},{key:"getEventType",value:function(){return this.trackingEvent}},{key:"getTrackingUrls",value:function(){return Object.assign([],this.trackingUrls)}},{key:"removeTrackingUrls",value:function(){this.trackingUrls=[]}},{key:"toString",value:function(){var t="";t+="Event:",t+=this.trackingEvent;var e,r=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return z(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?z(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(this.trackingUrls);try{for(r.s();!(e=r.n()).done;){var n=e.value;t+="\n - Url:",t+=n}}catch(t){r.e(t)}finally{r.f()}return t}}])&&X(e.prototype,r),n&&X(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Q(t,e){t&&(e=e.bind(t));var r=null;try{for(var n=arguments.length,i=new Array(n>2?n-2:0),a=2;a<n;a++)i[a-2]=arguments[a];r=e.apply(void 0,i)}catch(t){var o=e.toString(),s=/function ([^\(]*)/,u=s.exec(o);u&&u.length>0?C.e("Exception thrown from callback function "+u[1]+": "+t):C.e("Exception thrown from callback function.")}return r}function $(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=J(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function J(t,e){if(t){if("string"==typeof t)return Z(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Z(t,e):void 0}}function Z(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function tt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function et(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function rt(t,e,r){return e&&et(t.prototype,e),r&&et(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}var nt=function(){function t(e){tt(this,t),this.properties=e,this.suppress=!1,this.observers=[]}return rt(t,[{key:"addAnalyticObserver",value:function(t){t?this.observers.push(t):C.e("addAnalyticObserver: listener was null")}},{key:"applyEncryptedTracking",value:function(t){return this.properties.getApplyEncryptedTracking()&&(t=t.replace("http:","https:")),t}},{key:"fire",value:function(t,e){var r,n,i={method:"GET"};this.properties.getAllowCorsForAnalytics()?H(this.properties.getUserAgent())||(i.headers=(r=this.properties.getUserAgent(),(n=new Headers).append("User-Agent",r),n)):i.mode="no-cors";var a,o=$(t.getTrackingUrls());try{for(o.s();!(a=o.n()).done;){var s=a.value;this.performMacroSubstitutionForUrl(s,e),this.applyEncryptedTracking(s),C.d(w,"Firing report url: "+s),We.get(s,i,this.properties.getResourceTimeout())}}catch(t){o.e(t)}finally{o.f()}}},{key:"fireBeacon",value:function(t,e){if(t&&t.getTrackingUrls().length>0&&!this.shouldSuppress(t.event))try{this.fire(t,e)}catch(t){throw C.e("Unable to fire tracking URLs for report: "+t),t}}},{key:"fireBeacons",value:function(t,e){var r,n=[],i=$(t);try{for(i.s();!(r=i.n()).done;){var a,o=$(r.value.getTrackingUrls());try{for(o.s();!(a=o.n()).done;){var s=a.value;n.push(s)}}catch(t){o.e(t)}finally{o.f()}}}catch(t){i.e(t)}finally{i.f()}this.fireBeacon(new K("",n),e)}},{key:"performMacroSubstitutionForUrl",value:function(t,e){var r,n,i=(n=Date.now(),new Date(n).toISOString()),a=G(e.getPlayhead()),o=-1===e.getAdvertStart()?"-1":G(e.getAdvertStart());r=encodeURIComponent(e.getAssetUri()),i=encodeURIComponent(i),a=encodeURIComponent(a),o=encodeURIComponent(o);var s=1e7+Math.round(1e8*Math.random());t=t.replace("[ASSETURI]",r).replace("%5BASSETURI%5D",r).replace("[CACHEBUSTING]",s).replace("%5BCACHEBUSTING%5D",s).replace("[TIMESTAMP]",i).replace("%5BTIMESTAMP%5D",i).replace("[CONTENTPLAYHEAD]",a).replace("%5BCONTENTPLAYHEAD%5D",a).replace("[MEDIAPLAYHEAD]",a).replace("%5BMEDIAPLAYHEAD%5D",a).replace("[ADPLAYHEAD]",o).replace("%5BADPLAYHEAD%5D",o);var u,c,l,f=$(e.getMacroSubstitutions());try{for(f.s();!(u=f.n()).done;){var h=(c=u.value,l=2,function(t){if(Array.isArray(t))return t}(c)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(t);!(o=(n=r.next()).done)&&(a.push(n.value),!e||a.length!==e);o=!0);}catch(t){s=!0,i=t}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}(c,l)||J(c,l)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),d=h[0],p=h[1];t=t.replace("[".concat(d,"]"),p).replace("%5B".concat(d,"%5D"),p)}}catch(t){f.e(t)}finally{f.f()}return(t=t.replace(/\[(.*?)]/g,"-1")).replace(/%5B(.*)%5D/g,"-1")}},{key:"raiseAdBreakEarlyReturn",value:function(t,e){var r,n=$(this.observers);try{for(n.s();!(r=n.n()).done;)r.value.onAdvertBreakEarlyReturn(t,e)}catch(t){n.e(t)}finally{n.f()}}},{key:"raiseAdBreakCallback",value:function(t,e,r){if("start"===t){var n,i=$(this.observers);try{for(i.s();!(n=i.n()).done;){var a=n.value;Q(a,a.onAdvertBreakStart,e,r)}}catch(t){i.e(t)}finally{i.f()}}else if("end"===t){var o,s=$(this.observers);try{for(s.s();!(o=s.n()).done;){var u=o.value;Q(u,u.onAdvertBreakEnd,r)}}catch(t){s.e(t)}finally{s.f()}}}},{key:"raiseAdvertCallback",value:function(t,e,r){if("start"===t){var n,i=$(this.observers);try{for(i.s();!(n=i.n()).done;){var a=n.value;Q(a,a.onAdvertStart,e,r)}}catch(t){i.e(t)}finally{i.f()}}else if("end"===t){var o,s=$(this.observers);try{for(s.s();!(o=s.n()).done;){var u=o.value;Q(u,u.onAdvertEnd,r)}}catch(t){s.e(t)}finally{s.f()}}}},{key:"raiseAnalyticUpdateCallback",value:function(t){if(!this.suppress){var e,r=$(this.observers);try{for(r.s();!(e=r.n()).done;){var n=e.value;Q(n,n.onAnalyticUpdate,t)}}catch(t){r.e(t)}finally{r.f()}}}},{key:"raiseSessionErrorCallback",value:function(t,e){var r,n=$(this.observers);try{for(n.s();!(r=n.n()).done;){var i=r.value;Q(i,i.onSessionTimeout,e),Q(i,i.onSessionError,t,e)}}catch(t){n.e(t)}finally{n.f()}}},{key:"raiseTrackingCallback",value:function(t,e){if(!this.shouldSuppress(t)){var r,n=$(this.observers);try{for(n.s();!(r=n.n()).done;){var i=r.value;Q(i,i.onTrackingEvent,t,e)}}catch(t){n.e(t)}finally{n.f()}}}},{key:"removeAnalyticObserver",value:function(t){this.observers.splice(this.observers.indexOf(t))}},{key:"reportsSuppressed",value:function(){return this.suppress}},{key:"shouldSuppress",value:function(t){var e=K.categoryForEvent(t);return 0==(this.properties.getExcludedCategories()&e)&&this.suppress}},{key:"suppressReports",value:function(t){this.suppress!==t&&(this.suppress=t,C.d(w,t?"Suppress reports":"Unsuppress reports"))}}]),t}(),it=function(){function t(e,r,n,i){tt(this,t),this.playhead=e,this.advertStart=r&&r>=0?e-r:-1,this.assetUri=n||"",this.macroSubstitutions=i||new Map}return rt(t,[{key:"getAdvertStart",value:function(){return this.advertStart}},{key:"getAssetUri",value:function(){return this.assetUri}},{key:"getMacroSubstitutions",value:function(){return this.macroSubstitutions}},{key:"getPlayhead",value:function(){return this.playhead}}]),t}();function at(t){return at="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},at(t)}function ot(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function st(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ut(t,e){return ut=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ut(t,e)}function ct(t,e){if(e&&("object"===at(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function lt(t){return lt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},lt(t)}var ft=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ut(t,e)}(o,t);var e,r,n,i,a=(n=o,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=lt(n);if(i){var r=lt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return ct(this,t)});function o(){return ot(this,o),a.apply(this,arguments)}return e=o,(r=[{key:"canStop",value:function(){throw new Error("Function must be overridden")}},{key:"canPause",value:function(){throw new Error("Function must be overridden")}},{key:"canSkip",value:function(){throw new Error("Function must be overridden")}},{key:"willSeekTo",value:function(t){throw new Error("Function must be overridden")}},{key:"canChangeVolume",value:function(t){throw new Error("Function must be overridden")}},{key:"canResize",value:function(t){throw new Error("Function must be overridden")}},{key:"canResizeCreative",value:function(t){throw new Error("Function must be overridden")}},{key:"canClickThrough",value:function(t){throw new Error("Function must be overridden")}}])&&st(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(R);function ht(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function dt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function pt(t,e,r){return e&&dt(t.prototype,e),r&&dt(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}var yt=function(){function t(e,r,n,i,a,o){ht(this,t),this.mediaId=t.decodeString(e),this.offset=a,this.segmentCount=n,this.segmentNumber=r,this.playhead=o,this.timestamp=Date.now(),this.typeWithinSegment=i}return pt(t,[{key:"getMediaId",value:function(){return this.mediaId}},{key:"getOffset",value:function(){return this.offset}},{key:"getPlayhead",value:function(){return this.playhead}},{key:"getSegmentCount",value:function(){return this.segmentCount}},{key:"getSegmentNumber",value:function(){return this.segmentNumber}},{key:"getTimestamp",value:function(){return this.timestamp}},{key:"getTypeWithinSegment",value:function(){return this.typeWithinSegment}},{key:"isDuplicate",value:function(t){return!!t&&this.mediaId===t.mediaId&&this.segmentNumber===t.segmentNumber&&this.segmentCount===t.segmentCount&&this.typeWithinSegment===t.typeWithinSegment&&this.offset===t.offset}},{key:"isFirstInSequence",value:function(){return this.isFirstInSegment()&&1===this.segmentNumber}},{key:"isFirstInSegment",value:function(){return this.typeWithinSegment===vt.START}},{key:"isInSequence",value:function(t){if(!t)return!0;if(this.mediaId!==t.mediaId)return this.isFirstInSequence();var e=this.segmentNumber-t.segmentNumber;return 0===e?this.typeWithinSegment.isInSequence(t.typeWithinSegment)||this.typeWithinSegment.isEqualMidType(t.typeWithinSegment)&&this.offset>t.offset:e>0}},{key:"isLastInSegment",value:function(){return this.typeWithinSegment===vt.END}},{key:"isLastInSequence",value:function(){return this.isLastInSegment()&&this.isLastSegment()}},{key:"isLastSegment",value:function(){return this.segmentNumber===this.segmentCount}},{key:"toString",value:function(){return"Metadata [ @"+this.playhead+" / "+this.mediaId+" / "+this.segmentNumber+":"+this.segmentCount+" / "+this.typeWithinSegment.key+" : "+this.offset+" ]"}}],[{key:"createFromMetadata",value:function(e,r,n,i,a){if(!e)return C.e("Failed to interpret ymid"),null;n=t.decodeString(n);var o=vt.getForKey(n);if(null==o)return C.e("Failed to interpret ytyp"),null;var s=t.decodeString(r).split(":");if(2!==s.length)return C.e("Failed to interpret yseq"),null;var u=parseInt(s[0]),c=parseInt(s[1]);if(isNaN(u)||0===u||isNaN(c)||0===c)return C.e("Failed to interpret yseq"),null;var l=parseFloat(this.decodeString(i)),f=Number.isNaN(l)?0:Math.round(1e3*l);return a<0?(C.w("Invalid playhead provided:"+a),null):new t(e,u,c,o,f,a)}},{key:"decodeString",value:function(t){return t&&t.length>0&&3===t[0]?t.substring(1):t}}]),t}(),vt=function(){function t(e,r){ht(this,t),this.key=e,this.order=r}return pt(t,[{key:"isEqualMidType",value:function(t){return!!t&&1===this.order&&1===t.order}},{key:"isInSequence",value:function(t){return!t||this.order>t.order}}],[{key:"getForKey",value:function(e){if(!t.initialised){var r=t.END,n=t.MID,i=t.START;t.KEY_MAP.set(r.key,r),t.KEY_MAP.set(n.key,n),t.KEY_MAP.set(i.key,i),t.initialised=!0}return t.KEY_MAP.get(e)}}]),t}();function gt(t){return gt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gt(t)}function bt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function mt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function kt(t,e){return kt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},kt(t,e)}function Tt(t,e){if(e&&("object"===gt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function At(t){return At=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},At(t)}vt.END=new vt("E",2),vt.MID=new vt("M",1),vt.START=new vt("S",0),vt.KEY_MAP=new Map,vt.initialised=!1;var wt=Object.freeze({START:0,STOP:1,PAUSE:2,RESUME:3,STALL:4,CONTINUE:5,ADVERT_REWIND:6,ADVERT_SKIP:7,SEEK:8}),Et=Object.freeze({COLLAPSED:0,EXPANDED:1}),St=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&kt(t,e)}(o,t);var e,r,n,i,a=(n=o,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=At(n);if(i){var r=At(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Tt(this,t)});function o(){return bt(this,o),a.apply(this,arguments)}return e=o,(r=[{key:"onPlayerEvent",value:function(t,e){throw new Error("Function must be overridden")}},{key:"onPlayheadUpdate",value:function(t){throw new Error("Function must be overridden")}},{key:"onTimedMetadata",value:function(t){throw new Error("Function must be overridden")}},{key:"onViewSizeChange",value:function(t){throw new Error("Function must be overridden")}},{key:"onVolumeChange",value:function(t){throw new Error("Function must be overridden")}}])&&mt(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(ft);function Pt(t){return Pt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Pt(t)}function It(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ot(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ct(t,e){return Ct=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ct(t,e)}function Dt(t,e){if(e&&("object"===Pt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Rt(t){return Rt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Rt(t)}var Nt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ct(t,e)}(o,t);var e,r,n,i,a=(n=o,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Rt(n);if(i){var r=Rt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Dt(this,t)});function o(){return It(this,o),a.apply(this,arguments)}return e=o,(r=[{key:"fireTrackingReport",value:function(t){throw new Error("Function must be overriden")}},{key:"fireTrackingReportForCreative",value:function(t,e){throw new Error("Function must be overriden")}},{key:"fireTrackingReportForIcon",value:function(t,e){throw new Error("Function must be overriden")}},{key:"raiseTrackingCallbackForCreative",value:function(t,e){throw new Error("Function must be overridden")}},{key:"getSessionProperties",value:function(){throw new Error("Function must be overridden")}},{key:"normaliseAdBreakStart",value:function(t,e){throw new Error("Function must be overridden")}}])&&Ot(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(St);function Lt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var _t=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,(r=[{key:"onAdvertBreakStart",value:function(t,e){throw new Error("Function must be overridden")}},{key:"onAdvertBreakEnd",value:function(t){throw new Error("Function must be overridden")}},{key:"onAdvertBreakEarlyReturn",value:function(t,e){throw new Error("Function must be overridden")}},{key:"onAdvertEnd",value:function(t){throw new Error("Function must be overridden")}},{key:"onAdvertStart",value:function(t,e){throw new Error("Function must be overridden")}},{key:"onAnalyticUpdate",value:function(t){throw new Error("Function must be overridden")}},{key:"onTrackingEvent",value:function(t,e){throw new Error("Function must be overridden")}},{key:"onSessionError",value:function(t,e){throw new Error("Function must be overridden")}},{key:"onSessionTimeout",value:function(t){throw new Error("Function must be overridden")}}])&&Lt(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Bt(t){return Bt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Bt(t)}function jt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ut(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Mt(t,e){return Mt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Mt(t,e)}function xt(t,e){if(e&&("object"===Bt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ft(t){return Ft=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ft(t)}var Vt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Mt(t,e)}(o,t);var e,r,n,i,a=(n=o,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ft(n);if(i){var r=Ft(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return xt(this,t)});function o(){return jt(this,o),a.apply(this,arguments)}return e=o,(r=[{key:"onClickThrough",value:function(){throw new Error("Function must be overridden")}},{key:"onTrackingEvent",value:function(t){throw new Error("Function must be overridden")}},{key:"setVisible",value:function(t){throw new Error("Function must be overridden")}}])&&Ut(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(R);function Ht(t){return Ht="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ht(t)}function Yt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function qt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Wt(t,e){return Wt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Wt(t,e)}function Gt(t,e){if(e&&("object"===Ht(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function zt(t){return zt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},zt(t)}var Xt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Wt(t,e)}(o,t);var e,r,n,i,a=(n=o,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=zt(n);if(i){var r=zt(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Gt(this,t)});function o(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(e=a.call(this)).advertId=t.advertId?t.advertId:"",e.creativeId=t.id?t.id:"",e.universalAdIds=t.universalAdIds,e.sequence=t.sequence,e.adParameters=t.adParameters,e.extensions=t.extensions,e.nonLinear=!1,e}return e=o,(r=[{key:"getAdvertIdentifier",value:function(){return this.advertId}},{key:"getAdParameters",value:function(){return this.adParameters}},{key:"getExtensions",value:function(){return this.extensions}},{key:"getCreativeIdentifier",value:function(){return this.creativeId}},{key:"getSequence",value:function(){return this.sequence}},{key:"getUniversalAdIds",value:function(){return this.universalAdIds}},{key:"isNonLinear",value:function(){return this.nonLinear}},{key:"setNonLinear",value:function(t){this.nonLinear=t}},{key:"setVisible",value:function(t){}},{key:"toString",value:function(){var t="";if(t+="\n - Id:".concat(this.creativeId," AdId:").concat(this.advertId," Sequence:").concat(this.sequence),this.adParameters&&(t+="\n - AdParameters:",t+="\n"+V(this.adParameters)),this.universalAdIds){t+="\n - UniversalAdIds:";var e,r=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return Yt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Yt(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(this.universalAdIds);try{for(r.s();!(e=r.n()).done;)t+="\n"+V(e.value)}catch(t){r.e(t)}finally{r.f()}}return this.extensions&&(t+="\n - CreativeExtensions:",t+="\n"+V(this.extensions)),t}}])&&qt(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(Vt);function Kt(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return Qt(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Qt(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function Qt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function $t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Jt=function(){function t(e,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.clickThroughUrl=e||"",this.clickTrackingUrls=r||[],this.customClicks=n||[]}var e,r;return e=t,(r=[{key:"getClickThroughUrl",value:function(){return this.clickThroughUrl}},{key:"getClickTrackingUrls",value:function(){return this.clickTrackingUrls}},{key:"getCustomClicks",value:function(){return this.customClicks}},{key:"toString",value:function(){var t="";if(H(this.clickThroughUrl)||(t+="\n* Click-through Url: ",t+=this.clickThroughUrl),this.clickTrackingUrls.length>0){var e,r=Kt(this.clickTrackingUrls);try{for(r.s();!(e=r.n()).done;){var n=e.value;t+="\n* Click tracking Url: ",t+=n}}catch(t){r.e(t)}finally{r.f()}}if(this.customClicks.length>0){var i,a=Kt(this.customClicks);try{for(a.s();!(i=a.n()).done;){var o=i.value;t+="\n* Custom click Url: ",t+=o}}catch(t){a.e(t)}finally{a.f()}}return t}}])&&$t(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Zt(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=te(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function te(t,e){if(t){if("string"==typeof t)return ee(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ee(t,e):void 0}}function ee(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function re(t,e){return t.length>0?new K(e,t):null}function ne(t){if(!t)return!1;var e,r=null,n=null,i=Zt(t);try{for(i.s();!(e=i.n()).done;){var a=e.value,o=a.getName(),s=a.getValue();"width"!==o||H(s)?"height"!==o||H(s)||(n=a):r=a}}catch(t){i.e(t)}finally{i.f()}return!(!r||!n)}function ie(t,e){var r,n,i,a=Zt(t);try{for(a.s();!(r=a.n()).done;)(n=r.value,i=2,function(t){if(Array.isArray(t))return t}(n)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(t);!(o=(n=r.next()).done)&&(a.push(n.value),!e||a.length!==e);o=!0);}catch(t){s=!0,i=t}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}(n,i)||te(n,i)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}())[1].prefetch(e)}catch(t){a.e(t)}finally{a.f()}}function ae(t){return ae="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ae(t)}function oe(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=se(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function se(t,e){if(t){if("string"==typeof t)return ue(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ue(t,e):void 0}}function ue(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function ce(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function le(){return le="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=fe(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},le.apply(this,arguments)}function fe(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=pe(t)););return t}function he(t,e){return he=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},he(t,e)}function de(t,e){if(e&&("object"===ae(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function pe(t){return pe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},pe(t)}var ye=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&he(t,e)}(o,t);var e,r,n,i,a=(n=o,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=pe(n);if(i){var r=pe(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return de(this,t)});function o(t,e,r,n){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(i=a.call(this,t)).duration=W(t.duration),i.trackingMap=t.trackingMap?t.trackingMap:new Map,i.videoClicks=e||new Jt("",null,null),i.icons=t.icons,i.assetUri=t.currentAssetUri?t.currentAssetUri:"",i.interactiveCreative=r,i.skipOffset=t.skipOffset,i.broker=n,i}return e=o,(r=[{key:"getAssetUri",value:function(){return this.assetUri}},{key:"getClickThroughUrl",value:function(){return this.videoClicks.getClickThroughUrl()}},{key:"getClickTrackingUrls",value:function(){return this.videoClicks.getClickTrackingUrls()}},{key:"getCustomClickUrls",value:function(){return this.videoClicks.getCustomClicks()}},{key:"getDuration",value:function(){return this.duration}},{key:"getIndustryIcons",value:function(){return Object.assign([],this.icons)}},{key:"getInteractiveCreative",value:function(){return this.interactiveCreative}},{key:"getSkipOffset",value:function(){if(!this.skipOffset||""===this.skipOffset)return-1;if(-1!==this.skipOffset.indexOf("%")){var t=parseFloat(this.skipOffset.substring(0,this.skipOffset.length-1));return t?Math.round(t*this.duration/100):(C.w("Invalid skipoffset string: "+this.skipOffset),-1)}return W(this.skipOffset,-1)}},{key:"getTrackingMap",value:function(){return this.trackingMap}},{key:"getTrackingReport",value:function(t){return this.trackingMap.has(t)?this.trackingMap.get(t):null}},{key:"initialiseInteractiveCreative",value:function(t){this.interactiveCreative&&this.interactiveCreative.initialise(this.getAdParameters(),this.duration,t)}},{key:"isNonLinear",value:function(){return!1}},{key:"isValid",value:function(){return this.duration>0}},{key:"onClickThrough",value:function(){var t=this.videoClicks.getClickTrackingUrls();if(t.length>0){var e=re(t,"ClickTracking");this.broker.fireTrackingReportForCreative(e,this)}this.broker.raiseTrackingCallbackForCreative("ClickTracking",this)}},{key:"onTrackingEvent",value:function(t){if("customClick"===t){var e=this.videoClicks.getCustomClicks();if(e.length){var r=new K(t,e);this.broker.fireTrackingReportForCreative(r,this)}}else{if(K.isValidPlayerOperationEvent(t))return void C.w("Use PlaybackEventHandler functions to signal event "+t);if(K.isTimelineEvent(t))return void C.w("Invalid event: "+t+". Timeline events are signalled by position updates");var n=this.trackingMap.get(t);n&&this.broker.fireTrackingReportForCreative(n,this)}}},{key:"setDuration",value:function(t){this.duration=t}},{key:"toString",value:function(){var t,e,r="";if(this.trackingMap.size>0){r+="\n ** Tracking events - ";var n,i=oe(this.trackingMap);try{for(i.s();!(n=i.n()).done;){var a=(t=n.value,e=2,function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(t);!(o=(n=r.next()).done)&&(a.push(n.value),!e||a.length!==e);o=!0);}catch(t){s=!0,i=t}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}(t,e)||se(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());r+=V("\n "+a[0]+":"+a[1])}}catch(t){i.e(t)}finally{i.f()}}var s="";if(this.icons.length>0){s+="\n  ** Industry Icon(s) - ";var u,c=oe(this.icons);try{for(c.s();!(u=c.n()).done;)s+=u.value}catch(t){c.e(t)}finally{c.f()}}var l="\n--- Linear Creative:\n - assetUri:";return l+=this.assetUri,this.interactiveCreative&&(l+=this.interactiveCreative),l+=le(pe(o.prototype),"toString",this).call(this),H(this.skipOffset)||(l+="\n - SkipOffset:",l+=this.skipOffset),l+=r,(l+=V(this.videoClicks))+s}}])&&ce(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(Xt);function ve(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var ge=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r;return e=t,(r=[{key:"canStop",value:function(t,e){throw new Error("Must be overridden")}},{key:"canPause",value:function(t,e){throw new Error("Must be overridden")}},{key:"canSkip",value:function(t,e,r){throw new Error("Must be overridden")}},{key:"willSeekTo",value:function(t,e,r){throw new Error("Must be overridden")}},{key:"canChangeVolume",value:function(t,e,r){throw new Error("Must be overridden")}},{key:"canResize",value:function(t,e,r){throw new Error("Must be overridden")}},{key:"canResizeCreative",value:function(t,e,r){throw new Error("Must be overridden")}},{key:"canClickThrough",value:function(t,e,r){throw new Error("Must be overridden")}},{key:"setPlaybackMode",value:function(t){throw new Error("Must be overridden")}},{key:"didSkip",value:function(t,e,r){throw new Error("Must be overridden")}},{key:"didSeek",value:function(t,e,r){throw new Error("Must be overridden")}}])&&ve(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function be(t){return be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},be(t)}function me(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(t);!(o=(n=r.next()).done)&&(a.push(n.value),!e||a.length!==e);o=!0);}catch(t){s=!0,i=t}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}(t,e)||Te(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ke(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=Te(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function Te(t,e){if(t){if("string"==typeof t)return Ae(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ae(t,e):void 0}}function Ae(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function we(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Ee(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Se(t,e,r){return e&&Ee(t.prototype,e),r&&Ee(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Pe(t,e){return Pe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Pe(t,e)}function Ie(t,e){if(e&&("object"===be(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Oe(t){return Oe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Oe(t)}var Ce=r(147),De=Object.freeze({LIVE:0,DVRLIVE:1,VOD:2}),Re=Object.freeze({NONE:0,INITIALISED:1,FAILED:2,NO_ANALYTICS:3,SHUTDOWN:4}),Ne=Object.freeze({NOT_INITIALISED:0,INITIALISED:1,FAILED:2,NO_ANALYTICS:3,TIMEOUT:4}),Le=Object.freeze({TIMEOUT:0}),_e=-1,Be=-2,je=-3,Ue=-20,Me=-1,xe=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Pe(t,e)}(i,t);var e,r,n=(e=i,r=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,n=Oe(e);if(r){var i=Oe(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return Ie(this,t)});function i(t){var e;return we(this,i),e=n.call(this),C.logger.debug("Yospace AdManagement SDK for JavaScript v"+Ce.version),e.sessionProperties=t?Object.assign(Object.create(Object.getPrototypeOf(t)),t):new Fe,e.reportsManager=new nt(t),e.linearAdBreaks=[],e.nonLinearAdBreaks=[],e.displayAdBreaks=[],e.playbackBuffering=!1,e.playing=!1,e.currentAdBreak=null,e.currentAdvert=null,e.identifier="",e.playbackUrl=null,e.analyticsUrl=null,e.lastAnalyticUpdate=null,e.playhead=0,e.lastPlayed=0,e.lastTraced=0,e.sessionState=Re.NONE,e.resultCode=0,e.policyHandler=null,e.analyticPoller=null,e}return Se(i,[{key:"addAnalyticObserver",value:function(t){t?this.reportsManager.addAnalyticObserver(t):C.e("addAnalyticObserver: observer was null")}},{key:"analyticsSuppressed",value:function(){return this.reportsManager.reportsSuppressed()}},{key:"canChangeVolume",value:function(t){return!this.policyHandler||Q(this.policyHandler,this.policyHandler.canChangeVolume,t,this.playhead,this.linearAdBreaks)}},{key:"canClickThrough",value:function(t){return!this.policyHandler||Q(this.policyHandler,this.policyHandler.canClickThrough,t,this.playhead,this.linearAdBreaks)}},{key:"canPause",value:function(){return!this.policyHandler||Q(this.policyHandler,this.policyHandler.canPause,this.playhead,this.linearAdBreaks)}},{key:"canResize",value:function(t){return!this.policyHandler||Q(this.policyHandler,this.policyHandler.canResize,t,this.playhead,this.linearAdBreaks)}},{key:"canResizeCreative",value:function(t){return!this.policyHandler||Q(this.policyHandler,this.policyHandler.canResizeCreative,t,this.playhead,this.linearAdBreaks)}},{key:"canSkip",value:function(){return this.policyHandler?Q(this.policyHandler,this.policyHandler.canSkip,this.playhead,this.linearAdBreaks,0):0}},{key:"canStop",value:function(){return!this.policyHandler||Q(this.policyHandler,this.policyHandler.canStop,this.playhead,this.linearAdBreaks)}},{key:"completeWithStatus",value:function(t,e){this.setState(t),this.setResultCode(e),t===Re.INITIALISED&&C.trace("sessionStart")}},{key:"fireImpressionReport",value:function(){var t=this.currentAdvert;if(t&&t.isActive()){var e=t.getImpressions(!0);if(e){var r=new K(e.trackingEvent,e.trackingUrls),n=new it(this.getPlayhead(),t.getStart(),t.getLinearCreative().getAssetUri(),t.getMacroSubstitutions());this.reportsManager.fireBeacon(r,n),e.removeTrackingUrls()}}}},{key:"fireTrackingReport",value:function(t){var e=null,r=null,n=null,i=this.getCurrentAdvert();i&&(e=i.getStart(),i.getLinearCreative()&&(r=i.getLinearCreative().getAssetUri()),n=i.getMacroSubstitutions()),C.trace("trackingEvent "+t.getEventType());var a=new it(this.getPlayhead(),e,r,n);this.reportsManager.fireBeacon(t,a)}},{key:"fireTrackingReportForCreative",value:function(t,e){var r=null,n=this.getAdvertForCreative(e);if(n){n.getLinearCreative()&&(r=n.getLinearCreative().getAssetUri()),C.trace("trackingEvent "+t.getEventType());var i=new it(this.getPlayhead(),n.getStart(),r,n.getMacroSubstitutions());this.reportsManager.fireBeacon(t,i)}}},{key:"fireTrackingReportForIcon",value:function(t,e){var r=null,n=this.currentAdvert;if(n&&n.isActive()&&n.containsIcon(e)){n.getLinearCreative()&&(r=n.getLinearCreative().getAssetUri()),C.trace("trackingEvent "+t.getEventType());var i=new it(this.getPlayhead(),n.getStart(),r,n.getMacroSubstitutions());this.reportsManager.fireBeacon(t,i)}}},{key:"getAdBreaksByType",value:function(t){switch(t){case qn.LINEAR:return Object.assign([],this.linearAdBreaks);case qn.NONLINEAR:return Object.assign([],this.nonLinearAdBreaks);case qn.DISPLAY:return Object.assign([],this.displayAdBreaks);default:return null}}},{key:"getAnalyticsUrl",value:function(){return this.analyticsUrl}},{key:"getAdvertForCreative",value:function(t){var e=this.currentAdvert;if(e&&e.isActive()&&e.getLinearCreative()===t)return e;if(t.isNonLinear()){var r,n=ke(this.nonLinearAdBreaks);try{for(n.s();!(r=n.n()).done;)if(e=r.value.getAdvertForCreative(t))return e}catch(t){n.e(t)}finally{n.f()}var i,a=ke(this.displayAdBreaks);try{for(a.s();!(i=a.n()).done;)if(e=i.value.getAdvertForCreative(t))return e}catch(t){a.e(t)}finally{a.f()}}else if(!(t instanceof ye)){var o,s=ke(this.linearAdBreaks);try{for(s.s();!(o=s.n()).done;)if(e=o.value.getAdvertForCreative(t))return e}catch(t){s.e(t)}finally{s.f()}}return null}},{key:"getCurrentAdBreak",value:function(){return this.currentAdBreak}},{key:"getCurrentAdvert",value:function(){return this.currentAdvert}},{key:"getIdentifier",value:function(){return this.identifier}},{key:"getJsonResponseUrl",value:function(t){try{return JSON.parse(t).url}catch(t){return null}}},{key:"getPlaybackMode",value:function(){throw new Error("This must be overridden")}},{key:"getPlaybackUrl",value:function(){return this.playbackUrl}},{key:"getPlayhead",value:function(){return this.playhead}},{key:"getRequestTimeout",value:function(){return this.requestTimeout}},{key:"getResultCode",value:function(){return this.resultCode}},{key:"getLastAnalyticUpdate",value:function(){return this.lastAnalyticUpdate}},{key:"getLastPlayed",value:function(){return this.lastPlayed}},{key:"getReportsManager",value:function(){return this.reportsManager}},{key:"getSessionProperties",value:function(){return Object.freeze(this.sessionProperties)}},{key:"getSessionResult",value:function(){return this.sessionState}},{key:"getSessionState",value:function(){return this.sessionState}},{key:"getToken",value:function(){return this.sessionProperties.getToken()}},{key:"handleFallbackUrl",value:function(t){var e=this.getJsonResponseUrl(t);return e&&Ve(e)?(this.setPlaybackUrl(e),this.completeWithStatus(Re.NO_ANALYTICS,-21),!0):(this.completeWithStatus(Re.FAILED,-21),!1)}},{key:"isNotPlaying",value:function(){return!this.playing}},{key:"isPlaybackBuffering",value:function(){return this.playbackBuffering}},{key:"normaliseAdBreakStart",value:function(t,e){var r=this.linearAdBreaks.length;if(r){var n=this.linearAdBreaks[r-1],i=Wn(e,t,qn.LINEAR);if(n.getPosition().toLowerCase()===i.toLowerCase()){var a=n.getStart()+n.getDuration(),o=this.analyticPoller?this.analyticPoller.getFrequency():y.DEFAULT_POLLING_DELAY,s=Math.min(this.sessionProperties.getConsecutiveBreakTolerance(),o);if(a>t||t-a<s)return a}}return t}},{key:"onAdvertSkip",value:function(t){this.signalActionTrackingEvent("skip"),this.policyHandler&&Q(this.policyHandler,this.policyHandler.didSkip,this.playhead,t,this.linearAdBreaks),this.playhead=t}},{key:"onPlaybackContinue",value:function(){this.playbackBuffering?(this.playbackBuffering=!1,C.trace("playbackEvent continue")):C.d(k,"Reporting CONTINUE when not buffering")}},{key:"onPlayerEvent",value:function(t,e){switch(C.d(k,"New playback event: "+t+" at: "+e),t){case wt.START:this.onPlaybackStart(e);break;case wt.STOP:this.onPlaybackStop();break;case wt.PAUSE:this.onPlaybackPause();break;case wt.RESUME:this.onPlaybackResume();break;case wt.STALL:this.onPlaybackStall();break;case wt.CONTINUE:this.onPlaybackContinue();break;case wt.ADVERT_REWIND:this.onPlaybackRewind(e);break;case wt.ADVERT_SKIP:this.onAdvertSkip(e);break;case wt.SEEK:this.onPlaybackSeek(e);break;default:C.w("Unknown playback event: "+t)}C.d(k,"Playing: "+this.playing+", Buffering: "+this.playbackBuffering)}},{key:"onPlaybackPause",value:function(){this.playing?(this.playing=!1,this.signalActionTrackingEvent("pause")):C.d(k,"Reporting PAUSE when already paused")}},{key:"onPlaybackResume",value:function(){this.playing?C.d(k,"Reporting RESUME when already paying"):(this.playing=!0,this.signalActionTrackingEvent("resume"))}},{key:"onPlaybackRewind",value:function(t){this.signalActionTrackingEvent("rewind"),this.playhead=t}},{key:"onPlaybackSeek",value:function(t){this.policyHandler&&Q(this.policyHandler,this.policyHandler.didSeek,this.playhead,t,this.linearAdBreaks),C.trace("playbackEvent seek: "+t),this.playhead=t}},{key:"onPlaybackStall",value:function(){this.playing&&!this.playbackBuffering?(this.playbackBuffering=!0,C.trace("playbackEvent stall")):C.d(k,"Reporting STALL when not buffering")}},{key:"onPlaybackStart",value:function(t){this.playing?C.d(k,"Reporting START when already playing"):(this.playing=!0,C.trace("playbackEvent start"))}},{key:"onPlaybackStop",value:function(){if(this.playing){this.playing=!1,this.playbackBuffering=!1,C.trace("playbackEvent stop");var t=this.currentAdvert;if(t){var e=t.getLinearCreative();if(e){var r=e.getTrackingReport("closeLinear");r&&this.fireTrackingReport(r)}}}}},{key:"onPlayheadSeek",value:function(t){this.policyHandler&&Q(this.policyHandler,this.policyHandler.didSeek,this.playhead,t,this.linearAdBreaks),C.trace("playbackEvent seek: "+t),this.playhead=t}},{key:"onPlayheadUpdate",value:function(t){(0===this.lastTraced||t<this.lastTraced||t-this.lastTraced>=5e3)&&(C.trace("sdk playhead "+t),this.lastTraced=t),this.lastPlayed=this.playhead,this.playhead=t}},{key:"onTimedMetadata",value:function(t){}},{key:"onSessionError",value:function(){C.e("Yospace session has expired"),this.setState(Re.SHUTDOWN),this.getReportsManager().raiseSessionErrorCallback(Le.TIMEOUT,this)}},{key:"onViewSizeChange",value:function(t){switch(t){case Et.EXPANDED:this.signalActionTrackingEvent("playerExpand");break;case Et.COLLAPSED:this.signalActionTrackingEvent("playerCollapse");break;default:C.w("Unknown ViewSize: "+t)}}},{key:"onVolumeChange",value:function(t){var e=t?"mute":"unmute";this.signalActionTrackingEvent(e)}},{key:"raiseTrackingCallbackForCreative",value:function(t,e){this.getAdvertForCreative(e)&&(C.trace("trackingEvent "+t),this.getReportsManager().raiseTrackingCallback(t,this))}},{key:"removeAllNonLinearAdBreaks",value:function(){this.nonLinearAdBreaks=[],this.displayAdBreaks=[]}},{key:"removeAnalyticObserver",value:function(t){this.reportsManager.removeAnalyticObserver(t)}},{key:"removeNonLinearAdBreak",value:function(t){for(var e=0;e<this.nonLinearAdBreaks.length;++e)if(this.nonLinearAdBreaks[e]===t)return void this.nonLinearAdBreaks.splice(e,1);for(var r=0;r<this.displayAdBreaks.length;++r)if(this.displayAdBreaks[r]===t)return void this.displayAdBreaks.splice(r,1)}},{key:"removeKeysFromTrackingSchedule",value:function(t){var e,r=ke(t);try{for(r.s();!(e=r.n()).done;){var n=e.value;this.currentAdvert.removeFromTrackingSchedule(n)}}catch(t){r.e(t)}finally{r.f()}}},{key:"setAnalyticsUrl",value:function(t){this.analyticsUrl=t}},{key:"setCurrentAdBreak",value:function(t){this.currentAdBreak=t}},{key:"setCurrentAdvert",value:function(t){this.currentAdvert=t}},{key:"setIdentifier",value:function(t){this.identifier=t}},{key:"setLastAnalyticUpdate",value:function(t){this.lastAnalyticUpdate=t}},{key:"setPlaybackPolicyHandler",value:function(t){this.policyHandler=t,this.policyHandler&&Q(this.policyHandler,this.policyHandler.setPlaybackMode,this.getPlaybackMode())}},{key:"setPlaybackUrl",value:function(t){this.playbackUrl=t}},{key:"setPlayhead",value:function(t){this.playhead=t}},{key:"setReportsManager",value:function(t){this.reportsManager=t}},{key:"setResultCode",value:function(t){this.resultCode=t}},{key:"setState",value:function(t){this.sessionState=t}},{key:"shutdown",value:function(){C.d(T,"Session shutdown"),this.setState(Re.SHUTDOWN),this.onPlaybackStop(),C.trace("sessionEnd")}},{key:"signalActionTrackingEvent",value:function(t){var e=this.currentAdvert;if(e&&e.isActive()&&!e.isFiller()&&!H(t)){C.trace("actionEvent "+t);var r=e.getTrackingReports(t),n=new it(this.getPlayhead(),e.getStart(),e.getLinearCreative().getAssetUri(),e.getMacroSubstitutions());r.length>0&&this.reportsManager.fireBeacons(r,n),"closeLinear"!==t&&this.reportsManager.raiseTrackingCallback(t,this)}}},{key:"signalNonLinearTrackingEvent",value:function(t){var e=this.currentAdvert;if(e&&e.isActive()&&!e.isFiller()&&!H(t)){C.trace("nonlinearTrackingEvent "+t);var r=e.getTrackingReportLinear(t);if(r){var n=new it(this.getPlayhead(),e.getStart(),e.getLinearCreative().getAssetUri(),e.getMacroSubstitutions());this.reportsManager.fireBeacon(r,n)}this.reportsManager.raiseTrackingCallback(t,this)}}},{key:"signalTimelineTrackingEvents",value:function(t){var e=this.currentAdvert;if(e&&e.isActive()&&!e.isFiller()){var r,n=new it(this.getPlayhead(),e.getStart(),e.getLinearCreative().getAssetUri(),e.getMacroSubstitutions()),i=[],a=ke(e.getTrackingSchedule());try{for(a.s();!(r=a.n()).done;){var o=me(r.value,2),s=o[0],u=o[1];if(t+y.EVENT_CUEPOINT_TOL>=s){C.d(w,"Tracking schedule entry retrieved: "+u),i.push(s);var c=e.getTrackingReportLinear(u);c&&this.reportsManager.fireBeacon(c,n);var l=-1!==u.indexOf("progress")?"progress":u;C.trace("timelineEvent "+l),this.reportsManager.raiseTrackingCallback(l,this)}}}catch(t){a.e(t)}finally{a.f()}this.removeKeysFromTrackingSchedule(i)}}},{key:"signalTrackingEvent",value:function(t,e){var r=this.currentAdvert;if(r&&r.isActive()&&!r.isFiller()&&!H(t)){if(C.trace("trackingEvent"+t),e){var n=new it(this.getPlayhead(),r.getStart(),r.getLinearCreative().getAssetUri(),r.getMacroSubstitutions());this.reportsManager.fireBeacon(e,n)}this.reportsManager.raiseTrackingCallback(t,this)}}},{key:"suppressAnalytics",value:function(t){if(this.reportsManager.suppressReports(t),!t&&this.currentAdBreak){var e=this.currentAdBreak.getTrackingReport("breakStart",!0);this.getReportsManager().fireBeacon(e,new it(this.getPlayhead()))}}},{key:"willSeekTo",value:function(t){return this.policyHandler?Q(this.policyHandler,this.policyHandler.willSeekTo,t,this.linearAdBreaks,this.getPlayhead()):t}}]),i}(Nt),Fe=function(){function t(e){we(this,t),this.requestTimeout=e&&e.requestTimeout?e.requestTimeout:y.REQUEST_TIMEOUT,this.resourceTimeout=e&&e.resourceTimeout?e.resourceTimeout:y.REQUEST_TIMEOUT,this.userAgent=e?e.userAgent:"",this.prefetchResources=!!e&&e.prefetchResources,this.fireHistoricalBeacons=!e||e.fireHistoricalBeacons,this.eventCategories=e?e.eventCategories:0,this.allowCorsForAnalytics=!!e&&e.allowCorsForAnalytics,this.setCustomHttpHeaders(e?e.customHttpHeaders:null),this.useHttps=!!e&&e.useHttps,this.consecutiveBreakTolerance=e?e.consecutiveBreakTolerance:0,this.token=e?e.token:Math.floor(1e8*Math.random())}return Se(t,[{key:"excludeFromSuppression",value:function(t){this.eventCategories=t}},{key:"getCustomHttpHeaders",value:function(){return this.customHttpHeaders}},{key:"getExcludedCategories",value:function(){return this.eventCategories}},{key:"getFireHistoricalBeacons",value:function(){return this.fireHistoricalBeacons}},{key:"getPrefetchResources",value:function(){return this.prefetchResources}},{key:"getRequestTimeout",value:function(){return this.requestTimeout}},{key:"getResourceTimeout",value:function(){return this.resourceTimeout}},{key:"getUserAgent",value:function(){return this.userAgent}},{key:"getToken",value:function(){return this.token}},{key:"getAllowCorsForAnalytics",value:function(){return this.allowCorsForAnalytics}},{key:"getApplyEncryptedTracking",value:function(){return this.useHttps}},{key:"getConsecutiveBreakTolerance",value:function(){return this.consecutiveBreakTolerance}},{key:"setAllowCorsForAnalytics",value:function(t){this.allowCorsForAnalytics=t}},{key:"setApplyEncryptedTracking",value:function(t){this.useHttps=t}},{key:"setConsecutiveBreakTolerance",value:function(t){this.consecutiveBreakTolerance=t}},{key:"setCustomHttpHeaders",value:function(t){if(t){var e,r=ke(t);try{for(r.s();!(e=r.n()).done;){var n=me(e.value,1)[0];"USER-AGENT"===n.toUpperCase()&&(C.w("SessionProperties: 'User-Agent' ignored"),t.delete(n))}}catch(t){r.e(t)}finally{r.f()}}else t=null;this.customHttpHeaders=t}},{key:"setFireHistoricalBeacons",value:function(t){this.fireHistoricalBeacons=t}},{key:"setPrefetchResources",value:function(t){this.prefetchResources=t}},{key:"setRequestTimeout",value:function(t){this.requestTimeout=t}},{key:"setResourceTimeout",value:function(t){this.resourceTimeout=t}},{key:"setToken",value:function(t){this.token=t}},{key:"setUserAgent",value:function(t){this.userAgent=t}}]),t}();function Ve(t){if(H(t))return null;var e=null;try{e=new URL(t)}catch(t){return null}if(!e)return null;try{decodeURI(e.pathname)}catch(t){return null}return e}function He(t,e){if(t){if("string"==typeof t)return Ye(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ye(t,e):void 0}}function Ye(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function qe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var We=function(){function t(e,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.url=e,this.opts=r,this.requestTimeout=n||y.REQUEST_TIMEOUT}var e,r,n;return e=t,n=[{key:"get",value:function(e,r,n,i){if(!H(e)){if(i){var a,o=new Headers,s=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=He(t))){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(i);try{for(s.s();!(a=s.n()).done;){var u=(f=a.value,h=2,function(t){if(Array.isArray(t))return t}(f)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(t);!(o=(n=r.next()).done)&&(a.push(n.value),!e||a.length!==e);o=!0);}catch(t){s=!0,i=t}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}(f,h)||He(f,h)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),c=u[0],l=u[1];o.set(c,l)}}catch(t){s.e(t)}finally{s.f()}r.headers=o}return new t(e,r,n).executeGet()}var f,h;C.e("URL is missing")}}],(r=[{key:"executeGet",value:function(){return t=this.url,e=this.opts,r=this.requestTimeout,n=null,i=new Promise((function(t){n=setTimeout(t,r,{timeout:!0,error:"timeout",statusText:"Connection timeout",status:Be})})),Promise.race([fetch(t,e),i]).then((function(e){return e.timeout?C.d(S,"Request for "+t+" timed out"):e.ok||C.d(S,"Request for "+t+" failed. Status: "+e.status+". Message: "+e.statusText),e})).catch((function(e){return C.d(S,"Request for "+t+" failed. Exception: "+e),{error:e,statusText:e.message,status:_e}})).finally((function(){clearTimeout(n)}));var t,e,r,n,i}}])&&qe(e.prototype,r),n&&qe(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Ge(t){return Ge="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ge(t)}function ze(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Xe(t,e){return Xe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Xe(t,e)}function Ke(t,e){if(e&&("object"===Ge(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Qe(t){return Qe=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Qe(t)}var $e={STATIC:0,HTML:1,IFRAME:2,UNKNOWN:3},Je=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Xe(t,e)}(o,t);var e,r,n,i,a=(n=o,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Qe(n);if(i){var r=Qe(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Ke(this,t)});function o(t,e,r,n){var i;switch(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),i=a.call(this),t){case $e.STATIC:i.stringData=e,i.creativeType=r,i.encoded=!1,i.type=t;break;case $e.IFRAME:i.stringData=e,i.creativeType=null,i.type=t,i.encoded=!1;break;case $e.HTML:i.stringData=e,i.creativeType=null,i.type=t,i.encoded=n}return i.byteData=null,i}return e=o,(r=[{key:"getByteData",value:function(){return this.byteData}},{key:"getCreativeType",value:function(){return this.creativeType}},{key:"getResourceType",value:function(){return this.type}},{key:"getStringData",value:function(){return this.stringData}},{key:"isEncoded",value:function(){return this.encoded}},{key:"isValid",value:function(){switch(this.type){case $e.STATIC:if(!this.creativeType||""===this.creativeType)return!1;break;case $e.HTML:if(!this.stringData||""===this.stringData)return!1;break;case $e.IFRAME:try{new URL(this.stringData)}catch(t){return!1}break;default:return!1}return!0}},{key:"prefetch",value:function(t){var e=this;this.byteData||this.type===$e.HTML||this.type===$e.UNKNOWN||We.get(this.stringData,{},t).then((function(t){t.ok?t.text().then((function(t){e.byteData=t})):C.e("Resource prefetch request failed: "+e.stringData+", status: "+t.status+", error:"+t.statusText)}))}},{key:"toString",value:function(){var t="";switch(this.type){case $e.STATIC:t+="\nStatic resource (",t+=this.creativeType,t+="): ",t+=this.stringData;break;case $e.HTML:t+="\nHTML resource (",t+=this.encoded?"encoded): ":"unencoded): ",t+=function(t){if(!t)return"";try{for(var e=0,r="",n=null,i=0,a=0;a<t.length;++a){if("<"===(n=t[a])){var o=t[a+1];"/"===o&&e--,r=Y(r,i,e),"/"!==o&&"!"!==o&&e++}r+=n,i=n}if(0===e)return r}catch(t){}return t}(this.stringData);break;case $e.IFRAME:t+="\niFrame resource: ",t+=this.stringData}return t}}])&&ze(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(R);function Ze(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return tr(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?tr(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function tr(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function er(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var rr=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.required=e,this.companions=r||[]}var e,r;return e=t,(r=[{key:"containsCreative",value:function(t){return-1!==this.companions.indexOf(t)}},{key:"getCompanions",value:function(){return Object.assign([],this.companions)}},{key:"getCompanionsByType",value:function(t){var e,r=[],n=Ze(this.companions);try{for(n.s();!(e=n.n()).done;){var i=e.value;(i.getResource(t)||t===$e.UNKNOWN&&0===i.getResources().size)&&r.push(i)}}catch(t){n.e(t)}finally{n.f()}return r}},{key:"getRequired",value:function(){return this.required}},{key:"prefetchResources",value:function(t){var e,r=Ze(this.companions);try{for(r.s();!(e=r.n()).done;)e.value.prefetchResources(t)}catch(t){r.e(t)}finally{r.f()}}},{key:"toString",value:function(){var t="";if(this.companions.length>0){t="\n--- Companion Ads required:",t+=this.required;var e,r=Ze(this.companions);try{for(r.s();!(e=r.n()).done;)t+=V(e.value)}catch(t){r.e(t)}finally{r.f()}}return t}}])&&er(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function nr(t){return nr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},nr(t)}function ir(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=ar(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function ar(t,e){if(t){if("string"==typeof t)return or(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?or(t,e):void 0}}function or(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function sr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ur(){return ur="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=cr(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},ur.apply(this,arguments)}function cr(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=hr(t)););return t}function lr(t,e){return lr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},lr(t,e)}function fr(t,e){if(e&&("object"===nr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function hr(t){return hr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},hr(t)}var dr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&lr(t,e)}(o,t);var e,r,n,i,a=(n=o,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=hr(n);if(i){var r=hr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return fr(this,t)});function o(t,e,r,n,i){var s;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(s=a.call(this,t)).resources=new Map,s.visible=!1,s.properties=t.properties?t.properties:[],s.altText=t.altText,s.trackingMap=n||new Map,s.videoClicks=e||new Jt,s.broker=i;var u,c=ir(r);try{for(c.s();!(u=c.n()).done;){var l=u.value;s.resources.set(l.getResourceType(),l)}}catch(t){c.e(t)}finally{c.f()}if(t.companionExtensions){var f,h=ir(t.companionExtensions.getChildren());try{for(h.s();!(f=h.n()).done;){var d=f.value;s.extensions.addChild(d)}}catch(t){h.e(t)}finally{h.f()}}return s}return e=o,(r=[{key:"getAltText",value:function(){return this.altText}},{key:"getClickThroughUrl",value:function(){return this.videoClicks.getClickThroughUrl()}},{key:"getClickTrackingUrls",value:function(){return this.videoClicks.getClickTrackingUrls()}},{key:"getProperties",value:function(){return Object.assign([],this.properties)}},{key:"getProperty",value:function(t){var e,r=ir(this.properties);try{for(r.s();!(e=r.n()).done;){var n=e.value;if(n.getName()===t)return n}}catch(t){r.e(t)}finally{r.f()}return null}},{key:"getResource",value:function(t){return this.resources.has(t)?this.resources.get(t):null}},{key:"getResources",value:function(){return this.resources}},{key:"getTrackingMap",value:function(){return this.trackingMap}},{key:"isValid",value:function(){return ne(this.properties)&&this.resources.size>0||this.trackingMap.size>0}},{key:"isVisible",value:function(){return this.visible}},{key:"onClickThrough",value:function(){if(this.isVisible()){var t=re(this.videoClicks.getClickTrackingUrls(),"CompanionClickTracking");t&&this.broker.fireTrackingReportForCreative(t,this)}else C.w("Companion is not visible")}},{key:"onTrackingEvent",value:function(t){}},{key:"prefetchResources",value:function(t){ie(this.resources,t)}},{key:"setVisible",value:function(t){if(this.visible!==t&&(this.visible=t,t)){var e=this.trackingMap.get("creativeView");e&&this.broker.fireTrackingReportForCreative(e,this)}}},{key:"toString",value:function(){var t,e="\n--- Companion ---\n",r=ir(this.properties);try{for(r.s();!(t=r.n()).done;)e+="\n"+V(t.value)}catch(t){r.e(t)}finally{r.f()}e+=V("\nAlt Text: "+this.altText),e+=V(this.videoClicks);var n,i,a,s=ir(this.resources);try{for(s.s();!(n=s.n()).done;){var u=(i=n.value,a=2,function(t){if(Array.isArray(t))return t}(i)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(t);!(o=(n=r.next()).done)&&(a.push(n.value),!e||a.length!==e);o=!0);}catch(t){s=!0,i=t}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}(i,a)||ar(i,a)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());e+=V(u[0]+":"+u[1])}}catch(t){s.e(t)}finally{s.f()}return e+ur(hr(o.prototype),"toString",this).call(this)}}])&&sr(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(Xt);function pr(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=yr(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function yr(t,e){if(t){if("string"==typeof t)return vr(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?vr(t,e):void 0}}function vr(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function gr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var br=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.trackingMap=e||new Map,this.nonLinearCreatives=r||[]}var e,r;return e=t,(r=[{key:"allNonLinearsAreInactive",value:function(){var t,e=pr(this.nonLinearCreatives);try{for(e.s();!(t=e.n()).done;)if(t.value.isVisible())return!1}catch(t){e.e(t)}finally{e.f()}return!0}},{key:"containsCreative",value:function(t){return-1!==this.nonLinearCreatives.indexOf(t)}},{key:"getNonLinearCreatives",value:function(){return Object.assign([],this.nonLinearCreatives)}},{key:"getNonLinearCreativesByType",value:function(t){var e,r=[],n=pr(this.nonLinearCreatives);try{for(n.s();!(e=n.n()).done;){var i=e.value;i.getResource(t)&&r.push(i)}}catch(t){n.e(t)}finally{n.f()}return r}},{key:"getTrackingMap",value:function(){return this.trackingMap}},{key:"getTrackingReport",value:function(t){if(!this.allNonLinearsAreInactive())return this.trackingMap.get(t)}},{key:"postParse",value:function(){var t,e=pr(this.nonLinearCreatives);try{for(e.s();!(t=e.n()).done;)t.value.setTrackingReports(this.trackingMap)}catch(t){e.e(t)}finally{e.f()}}},{key:"prefetchResources",value:function(t){var e,r=pr(this.nonLinearCreatives);try{for(r.s();!(e=r.n()).done;)e.value.prefetchResources(t)}catch(t){r.e(t)}finally{r.f()}}},{key:"toString",value:function(){if(this.nonLinearCreatives.length>0){var t="\n--- NonLinear Ads:";if(this.trackingMap.size>0){t+="\n  ** Tracking events - ";var e,r=pr(this.trackingMap);try{for(r.s();!(e=r.n()).done;){var n=(o=e.value,s=2,function(t){if(Array.isArray(t))return t}(o)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(t);!(o=(n=r.next()).done)&&(a.push(n.value),!e||a.length!==e);o=!0);}catch(t){s=!0,i=t}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}(o,s)||yr(o,s)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());t+=V("\n "+n[0]+":"+n[1])}}catch(t){r.e(t)}finally{r.f()}}var i,a=pr(this.nonLinearCreatives);try{for(a.s();!(i=a.n()).done;)t+=V(i.value)}catch(t){a.e(t)}finally{a.f()}return t}var o,s;return""}}])&&gr(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function mr(t){return mr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mr(t)}function kr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Tr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ar(t,e){return Ar=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ar(t,e)}function wr(t,e){if(e&&("object"===mr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Er(t){return Er=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Er(t)}var Sr=Object.freeze({VIEWABLE:0,NOT_VIEWABLE:1,VIEW_UNDETERMINED:2}),Pr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ar(t,e)}(o,t);var e,r,n,i,a=(n=o,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Er(n);if(i){var r=Er(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return wr(this,t)});function o(){return kr(this,o),a.apply(this,arguments)}return e=o,(r=[{key:"onViewableEvent",value:function(t){throw new Error("Function must be overridden")}},{key:"onErrorEvent",value:function(t){throw new Error("Function must be overridden")}},{key:"onImpressionEvent",value:function(){throw new Error("Function must be overridden")}}])&&Tr(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(R);function Ir(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Or=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.payload=e,this.source=r||null}var e,r;return e=t,(r=[{key:"getPayload",value:function(){return this.payload}},{key:"getSource",value:function(){return this.source}}])&&Ir(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Cr(t){return Cr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Cr(t)}function Dr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Rr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Nr(t,e){return Nr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Nr(t,e)}function Lr(t,e){if(e&&("object"===Cr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _r(t){return _r=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},_r(t)}var Br=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Nr(t,e)}(o,t);var e,r,n,i,a=(n=o,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=_r(n);if(i){var r=_r(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Lr(this,t)});function o(){return Dr(this,o),a.apply(this,arguments)}return e=o,(r=[{key:"onVerificationEvent",value:function(t,e){throw new Error("Function must be overridden")}}])&&Rr(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(R);function jr(t){return jr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},jr(t)}function Ur(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=Mr(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function Mr(t,e){if(t){if("string"==typeof t)return xr(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?xr(t,e):void 0}}function xr(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Fr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Vr(t,e){return Vr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Vr(t,e)}function Hr(t,e){if(e&&("object"===jr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Yr(t){return Yr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Yr(t)}var qr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Vr(t,e)}(o,t);var e,r,n,i,a=(n=o,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Yr(n);if(i){var r=Yr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Hr(this,t)});function o(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(e=a.call(this)).vendor=t.verificationVendor,e.resources=t.verificationResources,e.verificationEvents=t.verificationEvents,e.parameters=t.verificationParameters,e.listeners=[],e.broker=null,e}return e=o,(r=[{key:"getAdVerificationEvents",value:function(){return this.verificationEvents}},{key:"getParameters",value:function(){return this.parameters}},{key:"getResources",value:function(){return Object.assign([],this.resources)}},{key:"getVendor",value:function(){return this.vendor}},{key:"isValid",value:function(){return!!(this.vendor&&this.resources&&this.resources.length>0)}},{key:"onVerificationEvent",value:function(t,e){if(0!==this.listeners.length){var r=Number.isInteger(e);r||C.w("onVerificationEvent: reason should be an integer");var n=this.verificationEvents.get(t);if(n){if(r&&e>0){var i,a=Ur(this.listeners);try{for(a.s();!(i=a.n()).done;)(0,i.value)(new Or(e))}catch(t){a.e(t)}finally{a.f()}}this.broker.fireTrackingReport(n)}}else C.w("No event listeners - can't signal VerificationEvent")}},{key:"postParse",value:function(t,e){this.broker=t,e?this.listeners.push(e):C.e("postParse: callback was null")}},{key:"toString",value:function(){var t,e,r="";if(this.verificationEvents.size>0){r+="\n - Verification events:";var n,i=Ur(this.verificationEvents);try{for(i.s();!(n=i.n()).done;){var a=(t=n.value,e=2,function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(t);!(o=(n=r.next()).done)&&(a.push(n.value),!e||a.length!==e);o=!0);}catch(t){s=!0,i=t}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}(t,e)||Mr(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());r+="\n "+a[0]+"="+a[1]}}catch(t){i.e(t)}finally{i.f()}}var o="\n--- Ad Verification:\n - Vendor:";o+=this.vendor,o+="\n - Resources:";var s,u=Ur(this.resources);try{for(u.s();!(s=u.n()).done;)o+="\n"+V(s.value)}catch(t){u.e(t)}finally{u.f()}return o+=r,(o+="\n - VerificationParameters:")+this.parameters}}])&&Fr(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(Br);function Wr(t){return Wr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Wr(t)}function Gr(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function zr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Xr(t,e){return Xr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Xr(t,e)}function Kr(t,e){if(e&&("object"===Wr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Qr(t){return Qr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Qr(t)}var $r=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Xr(t,e)}(o,t);var e,r,n,i,a=(n=o,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Qr(n);if(i){var r=Qr(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Kr(this,t)});function o(t,e,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(n=a.call(this)).properties=t||[],n.altText=e,n.resource=r,n}return e=o,(r=[{key:"getAltText",value:function(){return this.altText}},{key:"getProperties",value:function(){return Object.assign([],this.properties)}},{key:"getProperty",value:function(t){var e,r=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return Gr(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Gr(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(this.properties);try{for(r.s();!(e=r.n()).done;){var n=e.value;if(n.getName()===t)return n}}catch(t){r.e(t)}finally{r.f()}return null}},{key:"getResource",value:function(){return this.resource}},{key:"isValid",value:function(){return!(!ne(this.properties)||H(this.altText)&&!this.resource)}}])&&zr(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(R);function Jr(t){return Jr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Jr(t)}function Zr(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=tn(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function tn(t,e){if(t){if("string"==typeof t)return en(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?en(t,e):void 0}}function en(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function rn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function nn(t,e){return nn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},nn(t,e)}function an(t,e){if(e&&("object"===Jr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function on(t){return on=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},on(t)}var sn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&nn(t,e)}(o,t);var e,r,n,i,a=(n=o,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=on(n);if(i){var r=on(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return an(this,t)});function o(t,e,r,n,i){var s;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(s=a.call(this)).resources=new Map,s.visible=!1,s.properties=t||[],s.videoClicks=r||new Jt,s.clickFallbackImages=n||[],s.broker=i;var u,c=Zr(e);try{for(c.s();!(u=c.n()).done;){var l=u.value;s.resources.set(l.getResourceType(),l)}}catch(t){c.e(t)}finally{c.f()}return s}return e=o,(r=[{key:"getClickFallbackImages",value:function(){return Object.assign([],this.clickFallbackImages)}},{key:"getClickThroughUrl",value:function(){return this.videoClicks.getClickThroughUrl()}},{key:"getClickTrackingUrls",value:function(){return this.videoClicks.getClickTrackingUrls()}},{key:"isVisible",value:function(){return this.visible}},{key:"getViewTrackingUrls",value:function(){return this.videoClicks.getCustomClicks()}},{key:"getProperties",value:function(){return Object.assign([],this.properties)}},{key:"getProperty",value:function(t){var e,r=Zr(this.properties);try{for(r.s();!(e=r.n()).done;){var n=e.value;if(n.getName()===t)return n}}catch(t){r.e(t)}finally{r.f()}}},{key:"getResource",value:function(t){return this.resources.get(t)}},{key:"getResources",value:function(){return this.resources}},{key:"isValid",value:function(){var t,e=null,r=null,n=null,i=null,a=null,o=Zr(this.properties);try{for(o.s();!(t=o.n()).done;){var s=t.value;H(s.getValue())||("program"===s.getName()&&(e=s),"width"===s.getName()&&(r=s),"height"===s.getName()&&(n=s),"xPosition"===s.getName()&&(i=s),"yPosition"===s.getName()&&(a=s))}}catch(t){o.e(t)}finally{o.f()}return null!==r&&null!==n&&null!==e&&null!==i&&null!==a&&this.resources.size>0}},{key:"onClickThrough",value:function(){if(this.isVisible()){var t=this.videoClicks.getClickTrackingUrls();if(t.length>0){var e=re(t,"IconClickTracking");e&&this.broker.fireTrackingReportForIcon(e,this)}}}},{key:"onTrackingEvent",value:function(t){}},{key:"setVisible",value:function(t){if(this.visible!==t&&(this.visible=t,this.visible&&this.videoClicks.getCustomClicks().length>0)){var e=new K("IconViewTracking",this.videoClicks.getCustomClicks());e&&this.broker.fireTrackingReportForIcon(e,this)}}},{key:"toString",value:function(){var t="";t+=this.videoClicks.toString(),this.properties.length>0&&(t+="\nIcon Properties: ");var e,r=Zr(this.properties);try{for(r.s();!(e=r.n()).done;)t+="\n"+V(e.value)}catch(t){r.e(t)}finally{r.f()}this.resources.length>0&&(t+="\nIcon Resource(s): ");var n,i,a,o=Zr(this.resources);try{for(o.s();!(n=o.n()).done;){var s=(i=n.value,a=2,function(t){if(Array.isArray(t))return t}(i)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(t);!(o=(n=r.next()).done)&&(a.push(n.value),!e||a.length!==e);o=!0);}catch(t){s=!0,i=t}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}(i,a)||tn(i,a)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());t+=V(s[0]+":"+s[1])}}catch(t){o.e(t)}finally{o.f()}this.clickFallbackImages.length>0&&(t+="\nIcon Click Fallback Images: ");var u,c=Zr(this.clickFallbackImages);try{for(c.s();!(u=c.n()).done;)t+="\n"+V(u.value)}catch(t){c.e(t)}finally{c.f()}return t}}])&&rn(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(Vt);function un(t){return un="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},un(t)}function cn(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=ln(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function ln(t,e){if(t){if("string"==typeof t)return fn(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?fn(t,e):void 0}}function fn(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function hn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function dn(){return dn="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=pn(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},dn.apply(this,arguments)}function pn(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=gn(t)););return t}function yn(t,e){return yn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},yn(t,e)}function vn(t,e){if(e&&("object"===un(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function gn(t){return gn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},gn(t)}var bn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&yn(t,e)}(o,t);var e,r,n,i,a=(n=o,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=gn(n);if(i){var r=gn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return vn(this,t)});function o(t,e,r,n){var i;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(i=a.call(this,t)).resources=new Map,i.visible=!1,i.videoClicks=e||new Jt("",null,null),i.properties=t.properties?t.properties:[],i.broker=n,i.trackingMap=new Map,r){var s,u=cn(r);try{for(u.s();!(s=u.n()).done;){var c=s.value;i.resources.set(c.getResourceType(),c)}}catch(t){u.e(t)}finally{u.f()}}return i}return e=o,(r=[{key:"getApiFramework",value:function(){var t=this.getProperty("apiFramework");return t?t.getValue():null}},{key:"getClickThroughUrl",value:function(){return this.videoClicks.getClickThroughUrl()}},{key:"getClickTrackingUrls",value:function(){return this.videoClicks.getClickTrackingUrls()}},{key:"getProperties",value:function(){return Object.assign([],this.properties)}},{key:"getProperty",value:function(t){var e,r=cn(this.properties);try{for(r.s();!(e=r.n()).done;){var n=e.value;if(n.getName()===t)return n}}catch(t){r.e(t)}finally{r.f()}return null}},{key:"getResource",value:function(t){return this.resources.get(t)}},{key:"getResources",value:function(){return this.resources}},{key:"getTrackingReports",value:function(){return this.trackingMap}},{key:"isValid",value:function(){return ne(this.properties)&&this.resources.size>0}},{key:"isVisible",value:function(){return this.visible}},{key:"onClickThrough",value:function(){if(this.visible){var t=this.videoClicks.getClickTrackingUrls();if(t.length>0){var e=re(t,"NonLinearClickTracking");e&&this.broker.fireTrackingReportForCreative(e,this)}}else C.w("Nonlinear creative is not visible")}},{key:"onTrackingEvent",value:function(t){if(this.visible)if(K.isValidVisibleEvent(t))C.w("Use method setVisible() to signal event: "+t);else if(!K.isValidPlayerOperationEvent(t)||this.isNonLinear)if(K.isValidNonLinearEvent(t)){var e=this.trackingMap.get(t);e&&this.broker.fireTrackingReportForCreative(e,this),"acceptInvitation"===t&&this.broker.raiseTrackingCallbackForCreative(t,this)}else C.w("Invalid tracking event: "+t);else C.w("Use PlaybackEventHandler functions to signal event: "+t);else C.w("Nonlinear creative is not visible")}},{key:"prefetchResources",value:function(t){ie(this.resources,t)}},{key:"setTrackingReports",value:function(t){this.trackingMap=t}},{key:"setVisible",value:function(t){if(this.visible!==t){this.visible=t;var e;(e=t?this.trackingMap.get("creativeView"):this.trackingMap.get("close"))&&this.broker.fireTrackingReportForCreative(e,this)}}},{key:"toString",value:function(){var t="\n--- NonLinear Creative:";t+=V(this.videoClicks),this.properties.length>0&&(t+="\n - NonLinear Properties: ");var e,r=cn(this.properties);try{for(r.s();!(e=r.n()).done;)t+="\n"+V(e.value)}catch(t){r.e(t)}finally{r.f()}this.resources.size>0&&(t+="\n - NonLinear Resource(s): ");var n,i,a,s=cn(this.resources);try{for(s.s();!(n=s.n()).done;){var u=(i=n.value,a=2,function(t){if(Array.isArray(t))return t}(i)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(t);!(o=(n=r.next()).done)&&(a.push(n.value),!e||a.length!==e);o=!0);}catch(t){s=!0,i=t}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}(i,a)||ln(i,a)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());t+=V(u[0]+":"+u[1])}}catch(t){s.e(t)}finally{s.f()}return t+dn(gn(o.prototype),"toString",this).call(this)}}])&&hn(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(Xt);function mn(t){return mn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},mn(t)}function kn(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return Tn(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Tn(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function Tn(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function An(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function wn(t,e){return wn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},wn(t,e)}function En(t,e){if(e&&("object"===mn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Sn(t){return Sn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Sn(t)}var Pn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&wn(t,e)}(o,t);var e,r,n,i,a=(n=o,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Sn(n);if(i){var r=Sn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return En(this,t)});function o(t,e,r,n){var i;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(i=a.call(this)).source=t,i.properties=e||[],i.broker=r,i.adParameters=null,i.advertDuration=0,i.tracking=null,i.offset=0,i.visible=!1,i.nonLinearCreatives=[],i.isSIMID()&&(i.tracking=n),i}return e=o,(r=[{key:"getAdParameters",value:function(){return this.adParameters}},{key:"getAdvertDuration",value:function(){return this.advertDuration}},{key:"getNonLinearCreatives",value:function(){return this.nonLinearCreatives}},{key:"getProperties",value:function(){return Object.assign([],this.properties)}},{key:"getProperty",value:function(t){var e,r=kn(this.properties);try{for(r.s();!(e=r.n()).done;){var n=e.value;if(n.getName()===t)return n}}catch(t){r.e(t)}finally{r.f()}return null}},{key:"getSource",value:function(){return this.source}},{key:"getTracking",value:function(){return this.tracking}},{key:"initialise",value:function(t,e,r){this.adParameters=t,this.advertDuration=e,this.nonLinearCreatives=[];var n=this.getProperty("apiFramework");if(n){var i,a=n.getValue(),o=kn(r);try{for(o.s();!(i=o.n()).done;){var s=i.value,u=s.getProperty("apiFramework");u&&u.getValue()===a&&this.nonLinearCreatives.push(s)}}catch(t){o.e(t)}finally{o.f()}}}},{key:"isSIMID",value:function(){var t,e=kn(this.properties);try{for(e.s();!(t=e.n()).done;){var r=t.value;if("apiFramework"===r.getName()&&"SIMID"===r.getValue())return!0}}catch(t){e.e(t)}finally{e.f()}return!1}},{key:"isValid",value:function(){return!H(this.source)}},{key:"isVisible",value:function(){return this.visible}},{key:"onClickThrough",value:function(){}},{key:"onTrackingEvent",value:function(t){this.isVisible()?Ve(t)?this.isSIMID()&&this.broker.fireTrackingReport(new K("custom",[t])):C.w("Invalid custom tracker URL"):C.w("Warning: InteractiveCreative is not visible")}},{key:"setTracking",value:function(t){this.tracking=t}},{key:"setVisible",value:function(t){this.visible!==t&&(this.visible=t,this.visible&&this.isSIMID()&&this.tracking&&this.broker.fireTrackingReport(this.tracking))}},{key:"toString",value:function(){var t="InteractiveCreative source: "+this.source;if(this.properties.length>0){t+="\nProperties:";var e,r=kn(this.properties);try{for(r.s();!(e=r.n()).done;)t+=V(e.value)}catch(t){r.e(t)}finally{r.f()}}return this.tracking&&(t+="\nTracking event:",t+=V("\n "+this.tracking)),t}}])&&An(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(Vt);function In(t){return In="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},In(t)}function On(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(t);!(o=(n=r.next()).done)&&(a.push(n.value),!e||a.length!==e);o=!0);}catch(t){s=!0,i=t}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}(t,e)||Dn(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Cn(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=Dn(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function Dn(t,e){if(t){if("string"==typeof t)return Rn(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Rn(t,e):void 0}}function Rn(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Nn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ln(t,e){return Ln=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ln(t,e)}function _n(t,e){if(e&&("object"===In(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Bn(t){return Bn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Bn(t)}var jn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ln(t,e)}(s,t);var e,r,n,i,a,o=(i=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Bn(i);if(a){var r=Bn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return _n(this,t)});function s(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(e=o.call(this)).startMillis=0,e.identifier="",e.active=!1;var r=t.id;if(r){var n=r.split("_YO_");2===n.length&&(e.identifier=n[0],e.mediaIdentifier=n[1])}return e.properties=t.properties?t.properties:[],e.linearCreative=t.linearCreative,e.nonLinearAds=t.nonLinearAds?t.nonLinearAds:new br,e.companionAds=t.companionAds?t.companionAds:new rr,e.impressions=t.impressions,e.errors=t.errors,e.viewableImpressions=t.viewableImpressions?t.viewableImpressions:new Map,e.adVerifications=t.adVerifications?t.adVerifications:[],e.sequence=t.sequence,e.adType=t.adType,e.nonLinear=t.nonLinear,e.filler=t.filler,e.trackingSchedule=new Map,t.topLevelWrapper&&t.topLevelWrapper.isValid()?e.wrapper=t.topLevelWrapper:e.wrapper=null,e.extensions=t.extensions,e.broker=null,e.macroSubstitutions=new Map,e}return e=s,n=[{key:"buildMapString",value:function(t){if(t.size>0){var e,r=Cn(t);try{for(r.s();!(e=r.n()).done;){var n=On(e.value,2);n[0],n[1]}}catch(t){r.e(t)}finally{r.f()}}}}],(r=[{key:"addMacroSubstitution",value:function(t,e){this.macroSubstitutions.set(t,e)}},{key:"addTrackingScheduleEntry",value:function(t,e){for(var r=e*this.linearCreative.getDuration();this.trackingSchedule.has(r);)++r;this.trackingSchedule.set(r,t)}},{key:"adjustForEarlyReturn",value:function(t){var e=t-this.startMillis;this.setDuration(e);var r,n=Cn(this.getTrackingSchedule().keys());try{for(n.s();!(r=n.n()).done;){var i=r.value;i>e&&this.removeFromTrackingSchedule(i)}}catch(t){n.e(t)}finally{n.f()}}},{key:"clearTrackingSchedule",value:function(){this.trackingSchedule.clear()}},{key:"containsCreative",value:function(t){return t instanceof ye?t===this.linearCreative:t instanceof bn?this.nonLinearAds.containsCreative(t):t instanceof dr&&this.companionAds.containsCreative(t)}},{key:"containsIcon",value:function(t){var e,r=Cn(this.linearCreative.getIndustryIcons());try{for(r.s();!(e=r.n()).done;)if(e.value===t)return!0}catch(t){r.e(t)}finally{r.f()}return!1}},{key:"getAdVerifications",value:function(){return Object.assign([],this.adVerifications)}},{key:"getAdType",value:function(){return this.adType}},{key:"getCompanionAds",value:function(){return this.companionAds}},{key:"getCompanionAdsByType",value:function(t){return this.companionAds.getCompanionsByType(t)}},{key:"getCompanionRequired",value:function(){return this.companionAds.getRequired()}},{key:"getDuration",value:function(){return this.nonLinear?0:this.linearCreative.getDuration()}},{key:"getEnd",value:function(){return this.startMillis+this.linearCreative.getDuration()}},{key:"getExtensions",value:function(){return this.extensions}},{key:"getIdentifier",value:function(){return this.identifier}},{key:"getImpressions",value:function(t){if(!this.impressions)return null;var e=new K(this.impressions.trackingEvent,this.impressions.trackingUrls);return t&&(this.impressions=null),e}},{key:"getIndustryIcons",value:function(){return this.linearCreative.getIndustryIcons()}},{key:"getInteractiveCreative",value:function(){return this.linearCreative.getInteractiveCreative()}},{key:"getLineage",value:function(){return this.wrapper}},{key:"getLinearCreative",value:function(){return this.linearCreative}},{key:"getMacroSubstitutions",value:function(){return this.macroSubstitutions}},{key:"getMediaIdentifier",value:function(){return this.mediaIdentifier}},{key:"getNonLinearAds",value:function(){return this.nonLinearAds}},{key:"getNonLinearCreativesByType",value:function(t){return this.nonLinearAds.getNonLinearCreativesByType(t)}},{key:"getProperties",value:function(){return Object.assign([],this.properties)}},{key:"getProperty",value:function(t){var e,r=Cn(this.properties);try{for(r.s();!(e=r.n()).done;){var n=e.value;if(n.getName()===t)return n}}catch(t){r.e(t)}finally{r.f()}return null}},{key:"getProportion",value:function(t){var e=0,r=t.split("-");if(2!==r.length)C.w("Badly formed progress event in VAST/VMAP: "+t),e=-1;else if(-1!==r[1].indexOf("%")){var n=parseFloat(r[1].substring(0,r[1].length-1));(e=n?n/100:-1)<0&&C.w("Badly formed percentage string in VAST/VMAP: "+r[1])}else e=parseFloat(W(r[1],-1)/this.linearCreative.getDuration());return e}},{key:"getRemainingTime",value:function(t){var e=this.startMillis+this.linearCreative.getDuration(),r=Math.min(e-t,this.linearCreative.getDuration());return Math.max(0,r)}},{key:"getSequence",value:function(){return this.sequence}},{key:"getSkipOffset",value:function(){return this.linearCreative.getSkipOffset()}},{key:"getStart",value:function(){return this.startMillis}},{key:"getTrackingReports",value:function(t){var e=[],r=this.linearCreative.getTrackingReport(t);return r&&e.push(r),(r=this.nonLinearAds.getTrackingReport(t))&&e.push(r),e}},{key:"getTrackingReportLinear",value:function(t){if(this.linearCreative)return this.linearCreative.getTrackingReport(t)}},{key:"getTrackingReportNonLinear",value:function(t){if(this.nonLinearAds)return this.nonLinearAds.getTrackingReport(t)}},{key:"getTrackingSchedule",value:function(){return this.trackingSchedule}},{key:"getViewableImpressions",value:function(){return this.viewableImpressions}},{key:"isActive",value:function(){return this.active}},{key:"isFiller",value:function(){return this.filler}},{key:"isNonLinear",value:function(){return this.nonLinear}},{key:"isValid",value:function(){return this.nonLinear?!this.linearCreative:!H(this.mediaIdentifier)&&null!==this.linearCreative}},{key:"onErrorEvent",value:function(t){this.errors&&(t&&this.addMacroSubstitution("ERRORCODE",t.toString()),this.broker.fireTrackingReport(this.errors))}},{key:"onImpressionEvent",value:function(){if(this.nonLinear){var t=this.getImpressions(!1);t&&this.broker.fireTrackingReport(t)}else C.w("Warning: Advert is not nonlinear - can't signal ImpressionEvent")}},{key:"onViewableEvent",value:function(t){var e=s.viewableEventMap.get(t),r=this.viewableImpressions.get(e);r&&this.broker.fireTrackingReport(r)}},{key:"postParse",value:function(t){var e=this;if(this.broker=t,!this.nonLinear){this.addTrackingScheduleEntry("loaded",0),this.addTrackingScheduleEntry("start",0),this.addTrackingScheduleEntry("firstQuartile",.25),this.addTrackingScheduleEntry("midpoint",.5),this.addTrackingScheduleEntry("thirdQuartile",.75),this.addTrackingScheduleEntry("complete",1);var r,n=Cn(this.linearCreative.getTrackingMap());try{for(n.s();!(r=n.n()).done;){var i=On(r.value,2),a=i[0],o=i[1];if(-1!==a.indexOf("progress")){var s=this.getProportion(a,o);s>=0&&this.addTrackingScheduleEntry(a,s)}}}catch(t){n.e(t)}finally{n.f()}this.trackingSchedule=new Map(Array.from(this.trackingSchedule).sort((function(t,e){return t[0]-e[0]})))}var u,c=Cn(this.adVerifications);try{for(c.s();!(u=c.n()).done;)u.value.postParse(this.broker,(function(t){e.addMacroSubstitution("REASON",t.getPayload())}))}catch(t){c.e(t)}finally{c.f()}this.nonLinearAds.postParse(),this.linearCreative&&this.linearCreative.initialiseInteractiveCreative(this.nonLinearAds.getNonLinearCreatives()),this.prefetchResources(t.getSessionProperties()),this.active=!0}},{key:"prefetchResources",value:function(t){t.getPrefetchResources()&&(this.nonLinearAds.prefetchResources(t.getResourceTimeout()),this.companionAds.prefetchResources(t.getResourceTimeout()))}},{key:"removeFromTrackingSchedule",value:function(t){this.trackingSchedule.delete(t)}},{key:"removeMacroSubstitution",value:function(t){this.macroSubstitutions.delete(t)}},{key:"removeTrackingSchedule",value:function(){this.trackingSchedule.clear()}},{key:"setDuration",value:function(t){this.linearCreative&&this.linearCreative.setDuration(t)}},{key:"setInactive",value:function(){this.active=!1}},{key:"setStart",value:function(t){this.startMillis=t}},{key:"toString",value:function(){if(this.isFiller())return"\n--- Advert ---\n - Filler duration: "+this.getDuration();var t="\n* Impression(s):";if(this.impressions){var e,r=Cn(this.impressions.getTrackingUrls());try{for(r.s();!(e=r.n()).done;)t+=e.value}catch(t){r.e(t)}finally{r.f()}}else t+="NONE";var n="\n* Viewable Impression(s):";n+=s.buildMapString(this.viewableImpressions);var i="\n * Ad Verification(s):";i+=V(this.adVerifications);var a="\n Error(s):";if(this.errors){var o,u=Cn(this.errors.getTrackingUrls());try{for(u.s();!(o=u.n()).done;)a+=V("\n - "+o.value)}catch(t){u.e(t)}finally{u.f()}}else a+="NONE";var c="\n--- Advert ---\n ID:";c+=this.mediaIdentifier,c+="(",c+=this.identifier,c+=")",c+=" duration:",c+=this.getDuration(),c+=" sequence:",c+=this.sequence,c+=" adtype:",c+=this.adType;var l,f=Cn(this.properties);try{for(f.s();!(l=f.n()).done;)c+="\n"+V(l.value)}catch(t){f.e(t)}finally{f.f()}return this.extensions&&(c+="\n * Extensions:",c+="\n"+V(this.getExtensions())),this.wrapper&&(c+="\n * Lineage -\n",c+=V(this.wrapper)),c+=V(t),c+=V(n),c+=V(i),c+=V(a),this.nonLinear||(c+=V(this.linearCreative)),(c+=V(this.nonLinearAds))+V(this.companionAds)}}])&&Nn(e.prototype,r),n&&Nn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),s}(Pr);function Un(t){return Un="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Un(t)}function Mn(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return xn(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?xn(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function xn(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Fn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Vn(t,e){return Vn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Vn(t,e)}function Hn(t,e){if(e&&("object"===Un(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Yn(t){return Yn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Yn(t)}jn.viewableEventMap=new Map,jn.viewableEventMap.set(Sr.VIEWABLE,"Viewable"),jn.viewableEventMap.set(Sr.NOT_VIEWABLE,"NotViewable"),jn.viewableEventMap.set(Sr.VIEW_UNDETERMINED,"ViewUndetermined");var qn=Object.freeze({LINEAR:0,NONLINEAR:1,DISPLAY:2});function Wn(t,e,r){var n=t?t.toLowerCase():"";return"preroll"===n||"midroll"===n||"postroll"===n?n:0===e?"preroll":r===qn.LINEAR?"midroll":"unknown"}var Gn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Vn(t,e)}(s,t);var e,r,n,i,a,o=(i=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Yn(i);if(a){var r=Yn(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Hn(this,t)});function s(t,e,r,n,i,a,u){var c;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(c=o.call(this)).startMillis=t,c.duration=e,c.trackingMap=n||new Map,c.breakType=s.getBreakTypeFromString(i),c.position=Wn(r,t,c.breakType),c.identifier=a,c.extensions=u,c.broker=null,c.adverts=[],c.breakType!==qn.LINEAR&&-1===c.startMillis&&(c.startMillis=0),c}return e=s,n=[{key:"getBreakTypeFromString",value:function(t){return x(t,"nonlinear")?qn.NONLINEAR:x(t,"display")?qn.DISPLAY:qn.LINEAR}}],(r=[{key:"adjustForEarlyReturn",value:function(t){var e=this.getAdvertFromPlayhead(t);if(e){var r=e.getStart()===t;return r||e.adjustForEarlyReturn(t),this.removeAdvertsFrom(e,r),this.setDuration(t-this.startMillis),!0}return!1}},{key:"getAdvertForCreative",value:function(t){var e,r=Mn(this.adverts);try{for(r.s();!(e=r.n()).done;){var n=e.value;if(n.containsCreative(t))return n}}catch(t){r.e(t)}finally{r.f()}return null}},{key:"getAdvertFromPlayhead",value:function(t){var e,r=Mn(this.adverts);try{for(r.s();!(e=r.n()).done;){var n=e.value;if(n.getStart()<=t&&t<n.getEnd())return n}}catch(t){r.e(t)}finally{r.f()}return null}},{key:"getAdvertFromIdentifier",value:function(t){var e,r=Mn(this.adverts);try{for(r.s();!(e=r.n()).done;){var n=e.value;if(n.getMediaIdentifier()===t)return n}}catch(t){r.e(t)}finally{r.f()}return null}},{key:"getAdverts",value:function(){return Object.assign([],this.adverts)}},{key:"getBreakTypeAsString",value:function(){switch(this.breakType){case qn.NONLINEAR:return"nonlinear";case qn.DISPLAY:return"display";default:return"linear"}}},{key:"getType",value:function(){return this.breakType}},{key:"getDuration",value:function(){return this.duration}},{key:"getExtensions",value:function(){return this.extensions}},{key:"getIdentifier",value:function(){return this.identifier}},{key:"getPosition",value:function(){return this.position}},{key:"getRemainingTime",value:function(t){var e=0;if(this.adverts.length>0){var r=this.adverts[0].getStart()+this.getDuration();e=Math.min(r-t,this.getDuration())}return Math.max(0,e)}},{key:"getStart",value:function(){return this.startMillis}},{key:"getTrackingMap",value:function(){return this.trackingMap}},{key:"getTrackingReport",value:function(t,e){var r=this.trackingMap.get(t);return r&&e&&this.trackingMap.delete(t),r}},{key:"isActive",value:function(){if(!this.adverts)return!1;var t,e=Mn(this.adverts);try{for(e.s();!(t=e.n()).done;)if(t.value.isActive())return!0}catch(t){e.e(t)}finally{e.f()}return!1}},{key:"isNonLinear",value:function(){return this.breakType!==qn.LINEAR}},{key:"isValid",value:function(){return this.breakType===qn.LINEAR&&-1===this.startMillis?(C.e("Linear AdBreak is invalid - start position is unknown"),!1):this.adverts.length>0||this.trackingMap.size>0}},{key:"onNonLinearTrackingEvent",value:function(t){if(this.isNonLinear()){var e=this.getTrackingReport(t,!1);e&&this.broker.fireTrackingReport(e)}else C.w("Warning: AdBreak is not nonlinear - can't signal NonLinearTrackingEvent")}},{key:"postParse",value:function(t){this.broker=t;var e,r=this.startMillis,n=Mn(this.adverts);try{for(n.s();!(e=n.n()).done;){var i=e.value;i.setStart(r),r+=i.getDuration(),i.postParse(t)}}catch(t){n.e(t)}finally{n.f()}}},{key:"removeAdvertsFrom",value:function(t,e){for(var r=0;r<this.adverts.length;++r)if(this.adverts[r]===t){var n=!0===e?r:r+1;return void this.adverts.splice(n,this.adverts.length-n)}}},{key:"setAdverts",value:function(t){Array.prototype.push.apply(this.adverts,t);var e,r=this.startMillis,n=Mn(this.adverts);try{for(n.s();!(e=n.n()).done;){var i=e.value;i.setStart(r),r+=i.getDuration()}}catch(t){n.e(t)}finally{n.f()}}},{key:"setAdvertsInactivePriorTo",value:function(t){var e,r=Mn(this.adverts);try{for(r.s();!(e=r.n()).done;){var n=e.value;if(!(n.getEnd()<t))return!1;n.setInactive()}}catch(t){r.e(t)}finally{r.f()}return!0}},{key:"setDuration",value:function(t){this.duration=t}},{key:"setInactive",value:function(){if(!this.isNonLinear()){var t,e=Mn(this.adverts);try{for(e.s();!(t=e.n()).done;)t.value.setInactive()}catch(t){e.e(t)}finally{e.f()}this.trackingMap.clear()}}},{key:"toString",value:function(){return"\n--- AdBreak ---\n breakType:".concat(this.getBreakTypeAsString()," start:").concat(this.startMillis," milliseconds, duration:").concat(this.duration,", position:").concat(this.position,"\nNumber of adverts:").concat(this.adverts.length)}}])&&Fn(e.prototype,r),n&&Fn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),s}(M);function zn(t){return zn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},zn(t)}function Xn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Kn(t,e){return Kn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Kn(t,e)}function Qn(t,e){if(e&&("object"===zn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function $n(t){return $n=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},$n(t)}var Jn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Kn(t,e)}(o,t);var e,r,n,i,a=(n=o,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=$n(n);if(i){var r=$n(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Qn(this,t)});function o(t,e,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(n=a.call(this)).identifier=t,n.creativeIdentifier=e,n.adSystem=r,n.child=null,n}return e=o,(r=[{key:"getAdSystem",value:function(){return this.adSystem}},{key:"getCreativeIdentifier",value:function(){return this.creativeIdentifier}},{key:"getIdentifier",value:function(){return this.identifier}},{key:"getLineage",value:function(){return this.child}},{key:"isValid",value:function(){var t=this;do{if(!t.identifier||""===t.identifier)return!1;t=t.getLineage()}while(t);return!0}},{key:"setChild",value:function(t){this.child=t}}])&&Xn(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(R);function Zn(t){return Zn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zn(t)}function ti(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return ei(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ei(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function ei(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function ri(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ni(t,e){return ni=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},ni(t,e)}function ii(t,e){if(e&&("object"===Zn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ai(t){return ai=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ai(t)}var oi=2*y.MAX_CADENCE,si=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ni(t,e)}(o,t);var e,r,n,i,a=(n=o,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ai(n);if(i){var r=ai(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return ii(this,t)});function o(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(e=a.call(this,t)).didSeek=!1,e.duration=0,e}return e=o,(r=[{key:"getAdBreakForPlayhead",value:function(t){var e,r=ti(this.linearAdBreaks);try{for(r.s();!(e=r.n()).done;){var n=e.value;if(n.getStart()<=t&&t<n.getStart()+n.getDuration())return n}}catch(t){r.e(t)}finally{r.f()}return null}},{key:"getDuration",value:function(){return this.duration}},{key:"initialiseFromAnalyticData",value:function(t,e){this.setPlaybackUrl(e+t.getHostNode()+t.getHostSuffix()),this.setDuration(t.getStreamDuration()),this.setIdentifier(t.getSessionIdentifier()),Array.prototype.push.apply(this.linearAdBreaks,t.getLinearAdBreaks()),Array.prototype.push.apply(this.nonLinearAdBreaks,t.getNonLinearAdBreaks()),Array.prototype.push.apply(this.displayAdBreaks,t.getDisplayAdBreaks())}},{key:"onAdvertBreakStart",value:function(t){if(!this.getCurrentAdBreak()&&(this.setCurrentAdBreak(t),C.trace("adbreakStart"),this.getReportsManager().raiseAdBreakCallback("start",this.getCurrentAdBreak(),this),t&&!this.reportsManager.shouldSuppress("breakStart"))){var e=t.getTrackingReport("breakStart",!0);this.getReportsManager().fireBeacon(e,new it(this.getPlayhead()))}}},{key:"onAdvertBreakEnd",value:function(){var t=this.getCurrentAdBreak();if(t&&!this.reportsManager.shouldSuppress("breakEnd")){var e=t.getTrackingReport("breakEnd",!0);this.getReportsManager().fireBeacon(e,new it(this.getPlayhead()))}C.trace("adbreakEnd"),this.getReportsManager().raiseAdBreakCallback("end",null,this),this.setCurrentAdBreak(null)}},{key:"onAdvertEnd",value:function(){var t=this.getCurrentAdvert();t&&t.isActive()&&this.signalTimelineTrackingEvents(t.getStart()+t.getDuration()),t&&t.setInactive(),C.trace("advertEnd"),this.getReportsManager().raiseAdvertCallback("end",null,this),this.setCurrentAdvert(null)}},{key:"onAdvertStart",value:function(t){this.getCurrentAdvert()||(this.setCurrentAdvert(t),this.getReportsManager().reportsSuppressed()&&t.removeTrackingSchedule(),C.trace("advertStart"),this.getReportsManager().raiseAdvertCallback("start",t,this),t&&t.isActive()&&(this.fireImpressionReport(),this.signalTimelineTrackingEvents(y.ADVERT_START_TIMESLOT)))}},{key:"handlePostSeek",value:function(t){var e=this.getLastPlayed();C.d(E,"handlePostSeek: "+e+" -> "+t);var r=t-e;r>=0&&r<=oi?C.d(E,"handlePostSeek: ignoring interval "+r+"ms"):this.getCurrentAdBreak()?this.handlePostSeekForAdBreak(e,t):this.handlePostSeekForContent(t)}},{key:"handlePostSeekForContent",value:function(t){var e=this.adBreakForPlayhead(t);if(e){C.d(E,"handlePostSeek: CONTENT -> BREAK");var r=e.getAdvertFromPlayhead(t);r&&t-r.getStart()>oi&&r.setInactive()}else C.d(E,"handlePostSeek: within content")}},{key:"handlePostSeekForAdBreak",value:function(t,e){var r=this.adBreakForPlayhead(e);if(r)if(r!==this.getCurrentAdBreak()){C.d(E,"handlePostSeek: BREAK -> BREAK");var n=this.getCurrentAdBreak().getAdvertFromPlayhead(t);n&&n.setInactive();var i=r.getAdvertFromPlayhead(e);i&&e-i.getStart()>oi&&i.setInactive()}else this.handlePostSeekForAdvertToAdvert(e);else{C.d(E,"handlePostSeek: BREAK -> CONTENT");var a=this.getCurrentAdBreak().getAdvertFromPlayhead(t);a&&a.setInactive()}}},{key:"handlePostSeekForAdvertToAdvert",value:function(t){var e=this.getCurrentAdBreak().getAdvertFromPlayhead(t);e&&(this.getCurrentAdvert().setInactive(),e!==this.getCurrentAdvert()?(C.d(E,"handlePostSeek: ADVERT -> ADVERT"),t-e.getStart()>oi&&e.setInactive()):C.d(E,"handlePostSeek: with advert"))}},{key:"handleHeartbeat",value:function(t){C.d(E,"handleHeartbeat (playhead: "+t+")"),this.didSeek&&(this.handlePostSeek(t),this.didSeek=!1);var e=this.getLastPlayed();this.setPlayhead(t),this.getCurrentAdBreak()?this.handleHeartbeatForAdbreak(t):this.handleHeartbeatForContent(e,t)}},{key:"handleHeartbeatForContent",value:function(t,e){var r=this.missedOpportunityBreak(t,e);if(r){var n=new it(this.getPlayhead());this.getReportsManager().fireBeacon(r.getTrackingReport("breakStart",!0),n),this.getReportsManager().fireBeacon(r.getTrackingReport("breakEnd",!0),n),-1!==this.linearAdBreaks.indexOf(r)&&this.linearAdBreaks.splice(this.linearAdBreaks.indexOf(r),1)}var i=this.adBreakForPlayhead(e);i&&(C.d(E,"CONTENT -> BREAK (playhead: "+e+")"),this.onAdvertBreakStart(i),this.onAdvertStart(i.getAdvertFromPlayhead(e)))}},{key:"handleHeartbeatForAdbreak",value:function(t){var e=this.adBreakForPlayhead(t);e?e!==this.getCurrentAdBreak()?(C.d(E,"BREAK -> BREAK"),this.onAdvertEnd(),this.onAdvertBreakEnd(),this.onAdvertBreakStart(e),this.onAdvertStart(e.getAdvertFromPlayhead(t))):this.handleHeartbeatForAdvertToAdvert(t):(C.d(E,"BREAK -> CONTENT"),this.onAdvertEnd(),this.onAdvertBreakEnd())}},{key:"handleHeartbeatForAdvertToAdvert",value:function(t){var e=this.getCurrentAdBreak().getAdvertFromPlayhead(t);if(e)if(e!==this.getCurrentAdvert())C.d(E,"ADVERT -> ADVERT"),this.onAdvertEnd(),this.onAdvertStart(e);else{var r=Math.max(t-this.getCurrentAdvert().getStart(),0);this.signalTimelineTrackingEvents(r)}}},{key:"adBreakForPlayhead",value:function(t){var e,r=ti(this.linearAdBreaks);try{for(r.s();!(e=r.n()).done;){var n=e.value;if(n.getStart()<=t&&t<n.getStart()+n.getDuration())return n}}catch(t){r.e(t)}finally{r.f()}return null}},{key:"missedOpportunityBreak",value:function(t,e){var r,n=ti(this.linearAdBreaks);try{for(n.s();!(r=n.n()).done;){var i=r.value;if(0===i.getDuration()){var a=i.getStart();if(t<=a&&e>=a)return i}}}catch(t){n.e(t)}finally{n.f()}return null}},{key:"removeAdBreak",value:function(t){for(var e=0;e<this.linearAdBreaks.length;++e)if(this.linearAdBreaks[e]===t)return void this.linearAdBreaks.splice(e,1)}},{key:"setAdBreaksInactivePriorTo",value:function(t){var e,r=ti(this.linearAdBreaks);try{for(r.s();!(e=r.n()).done&&e.value.setAdvertsInactivePriorTo(t););}catch(t){r.e(t)}finally{r.f()}}}])&&ri(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),o}(xe);function ui(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var ci=function(){function t(e,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.sessionIdentifier=e.get(b.IDENTIFIER),this.location=e.get(b.LOCATION),this.scheme=e.get(b.SCHEME),this.hostNode=e.get(b.HOSTNODE),this.port=e.get(b.PORT),this.queryString=e.get(b.QS),this.analyticUrl=e.get(b.ANALYTICURL),this.pauseUrl=e.get(b.PAUSEURL),this.availabilityStartTime=e.get(b.AVAILABILITYSTART)||null,this.raw=n||"",this.interSegmentTimeout=r}var e,r;return e=t,(r=[{key:"getAnalyticUrl",value:function(){return this.analyticUrl}},{key:"getIntersegmentTimeout",value:function(){return this.interSegmentTimeout}},{key:"getLocation",value:function(){return this.location}},{key:"getHostNode",value:function(){return this.hostNode}},{key:"getScheme",value:function(){return this.scheme}},{key:"getPauseUrl",value:function(){return this.pauseUrl}},{key:"getPort",value:function(){return this.port}},{key:"getQueryString",value:function(){return this.queryString}},{key:"getRaw",value:function(){return this.raw}},{key:"getSessionIdentifier",value:function(){return this.sessionIdentifier}},{key:"getAvailabilityStartTime",value:function(){return this.availabilityStartTime}}])&&ui(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}(),li=r(99),fi=r.n(li);function hi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var di=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.data=new Map,this.s="",this.error=null,this.onError=this.onError.bind(this),this.onText=this.onText.bind(this),this.onOpenTag=this.onOpenTag.bind(this),this.onCloseTag=this.onCloseTag.bind(this),this.onCdata=this.onCdata.bind(this)}var e,r,n;return e=t,n=[{key:"parse",value:function(e){return e&&0!==e.length?(new t).parse(e):(C.e("Yospace DASH manifest is empty"),null)}}],(r=[{key:"parse",value:function(t){var e=fi().parser(!0);return e.onerror=this.onError,e.ontext=this.onText,e.onopentag=this.onOpenTag,e.onclosetag=this.onCloseTag,e.oncdata=this.onCdata,e.write(t),this.error?null:new ci(this.data,1600,t)}},{key:"onCdata",value:function(t){this.s+=t}},{key:"onError",value:function(){this.error=!0}},{key:"onCloseTag",value:function(t){if("LOCATION"===t.toUpperCase()){var e=this.s.trim();this.data.set(b.LOCATION,e);var r=e.split(/\?/);try{var n=new URL(r[0]);this.data.set(b.SCHEME,n.protocol.substring(0,n.protocol.length-1)),this.data.set(b.HOSTNODE,n.hostname),this.data.set(b.PORT,n.port),this.data.set(b.QS,2===r.length?r[1]:null);var i=r[0].match("/live/(\\d+)/.+?;jsessionid=([^?\\s]+)");if(i)this.data.set(b.IDENTIFIER,i[2]);else if(-1!==e.indexOf("yo.js")){var a=e.match("yo.js=([^&]+)");a&&this.data.set(b.IDENTIFIER,a[1])}void 0===this.data.get(b.IDENTIFIER)&&(this.error=!0)}catch(t){C.e("Failed to parse Location element: "+t),this.error=!0}}}},{key:"onOpenTag",value:function(t){this.s="","MPD"===t.name.toUpperCase()&&(this.data.set(b.ANALYTICURL,t.attributes.analytics),this.data.set(b.PAUSEURL,t.attributes.livePause),this.data.set(b.AVAILABILITYSTART,new Date(t.attributes.availabilityStartTime)))}},{key:"onText",value:function(t){this.s=t}}])&&hi(e.prototype,r),n&&hi(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function pi(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function yi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var vi=/;jsessionid=([^?]+)/,gi=/yo\.js=([^?]+)/,bi="FIRSTLEVELPLAYLIST",mi=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.data=new Map}var e,r,n;return e=t,n=[{key:"checkParameters",value:function(t,e){return H(e)?(C.e("Yospace HLS manifest is empty"),!1):-1===e.indexOf("#EXT-X-STREAM-INF:")?(C.e("No stream info found in HLS manifest"),!1):!!Ve(t)||(C.e("Playback Url is empty or invalid in HLS manifest"),!1)}},{key:"isHlsManifest",value:function(t){return t.length>=7&&-1!==t.toUpperCase().indexOf("#EXTM3U")}},{key:"parse",value:function(e,r){var n=new t;return t.checkParameters(e,r)&&(n.parseManifestLines(r),n.checkAnalyticUrl(),n.checkPauseUrl(),n.buildPlaybackUrl())?new ci(n.data,y.INTERSEGMENT_TIMEOUT,r):null}}],(r=[{key:"buildPlaybackUrl",value:function(){var t=this.data.get(b.LOCATION);t&&!Ve(t)&&(C.w("Master URL invalid in HSL manifest: "+t),this.data.delete(b.LOCATION));var e=!1,r=this.data.get(b.LOCATION);r||(r=this.data.get(bi));var n=Ve(r),i=r.match(gi),a=r.match(vi);if(n&&(i?(e=!0,this.data.set(b.IDENTIFIER,i[1])):a&&this.data.set(b.IDENTIFIER,a[1])),!n||void 0===this.data.get(b.IDENTIFIER))return C.e("Unable to build Location from components"),!1;var o=n.port;return this.data.set(b.PORT,""===o?"":o),this.data.set(b.SCHEME,n.protocol.substring(0,n.protocol.length-1)),this.data.set(b.HOSTNODE,n.hostname),this.data.set(b.QS,n.search?n.search.replace("?",""):""),this.updateLocationPath(n,e),!0}},{key:"updateLocationPath",value:function(t,e){if(void 0===this.data.get(b.LOCATION)){var r=t.pathname,n=r.substring(0,r.lastIndexOf("/"))+".m3u8",i=this.data.get(b.SCHEME);i+="://",i+=this.data.get(b.HOSTNODE),i+=""!==this.data.get(b.PORT)?":"+this.data.get(b.PORT):"",i+=n,e||(i+=";jsessionid="+this.data.get(b.IDENTIFIER)),H(this.data.get(b.QS))||(i+="?"+this.data.get(b.QS)),this.data.set(b.LOCATION,i)}}},{key:"checkAnalyticUrl",value:function(){var t=this.data.get(b.ANALYTICURL);H(t)?C.e("Unable to parse analytic URL in HLS manifest"):Ve(t)||C.e("Analytic URL invalid in HLS manifest: "+t)}},{key:"checkPauseUrl",value:function(){var t=this.data.get(b.PAUSEURL);H(t)||Ve(t)||C.e("Pause URL invalid in HSL manifest: "+t)}},{key:"parseManifestLines",value:function(t){var e,r=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return pi(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?pi(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(t.split(/\r?\n/));try{for(r.s();!(e=r.n()).done;){var n=e.value;if(n.startsWith("#")){var i=n.indexOf(":");if(-1!==i){var a=n.substring(i+1),o=n.substring(0,i);o.includes("#EXT-X-YOSPACE-ANALYTICS-URL")?this.data.set(b.ANALYTICURL,a.replace(/"/g,"")):o.includes("#EXT-X-YOSPACE-PAUSE")?this.data.set(b.PAUSEURL,a.replace(/"/g,"")):o.includes("#EXT-X-YOSPACE-SDK-MASTER-URL")&&this.data.set(b.LOCATION,a.replace(/"/g,""))}}else void 0===this.data.get(bi)&&this.data.set(bi,n)}}catch(t){r.e(t)}finally{r.f()}}}])&&yi(e.prototype,r),n&&yi(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function ki(t){return ki="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ki(t)}function Ti(){Ti=function(){return t};var t={},e=Object.prototype,r=e.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},i=n.iterator||"@@iterator",a=n.asyncIterator||"@@asyncIterator",o=n.toStringTag||"@@toStringTag";function s(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{s({},"")}catch(t){s=function(t,e,r){return t[e]=r}}function u(t,e,r,n){var i=e&&e.prototype instanceof f?e:f,a=Object.create(i.prototype),o=new w(n||[]);return a._invoke=function(t,e,r){var n="suspendedStart";return function(i,a){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===i)throw a;return{value:void 0,done:!0}}for(r.method=i,r.arg=a;;){var o=r.delegate;if(o){var s=k(o,r);if(s){if(s===l)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var u=c(t,e,r);if("normal"===u.type){if(n=r.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(n="completed",r.method="throw",r.arg=u.arg)}}}(t,r,o),a}function c(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=u;var l={};function f(){}function h(){}function d(){}var p={};s(p,i,(function(){return this}));var y=Object.getPrototypeOf,v=y&&y(y(E([])));v&&v!==e&&r.call(v,i)&&(p=v);var g=d.prototype=f.prototype=Object.create(p);function b(t){["next","throw","return"].forEach((function(e){s(t,e,(function(t){return this._invoke(e,t)}))}))}function m(t,e){function n(i,a,o,s){var u=c(t[i],t,a);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==ki(f)&&r.call(f,"__await")?e.resolve(f.__await).then((function(t){n("next",t,o,s)}),(function(t){n("throw",t,o,s)})):e.resolve(f).then((function(t){l.value=t,o(l)}),(function(t){return n("throw",t,o,s)}))}s(u.arg)}var i;this._invoke=function(t,r){function a(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(a,a):a()}}function k(t,e){var r=t.iterator[e.method];if(void 0===r){if(e.delegate=null,"throw"===e.method){if(t.iterator.return&&(e.method="return",e.arg=void 0,k(t,e),"throw"===e.method))return l;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var n=c(r,t.iterator,e.arg);if("throw"===n.type)return e.method="throw",e.arg=n.arg,e.delegate=null,l;var i=n.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,l):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,l)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function A(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function w(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function E(t){if(t){var e=t[i];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,a=function e(){for(;++n<t.length;)if(r.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return a.next=a}}return{next:S}}function S(){return{value:void 0,done:!0}}return h.prototype=d,s(g,"constructor",d),s(d,"constructor",h),h.displayName=s(d,o,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===h||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,s(t,o,"GeneratorFunction")),t.prototype=Object.create(g),t},t.awrap=function(t){return{__await:t}},b(m.prototype),s(m.prototype,a,(function(){return this})),t.AsyncIterator=m,t.async=function(e,r,n,i,a){void 0===a&&(a=Promise);var o=new m(u(e,r,n,i),a);return t.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},b(g),s(g,o,"Generator"),s(g,i,(function(){return this})),s(g,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function r(){for(;e.length;){var n=e.pop();if(n in t)return r.value=n,r.done=!1,r}return r.done=!0,r}},t.values=E,w.prototype={constructor:w,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(A),!t)for(var e in this)"t"===e.charAt(0)&&r.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(r,n){return o.type="throw",o.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=r.call(a,"catchLoc"),u=r.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=t,o.arg=e,a?(this.method="next",this.next=a.finallyLoc,l):this.complete(o)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),l},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),A(r),l}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var i=n.arg;A(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:E(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),l}},t}function Ai(t,e,r,n,i,a,o){try{var s=t[a](o),u=s.value}catch(t){return void r(t)}s.done?e(u):Promise.resolve(u).then(n,i)}function wi(t){return function(){var e=this,r=arguments;return new Promise((function(n,i){var a=t.apply(e,r);function o(t){Ai(a,n,i,o,s,"next",t)}function s(t){Ai(a,n,i,o,s,"throw",t)}o(void 0)}))}}function Ei(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Si=function(){function t(e,r,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.url=e,this.timeout=r,this.handler=n,this.frequency=i||y.DEFAULT_POLLING_DELAY,this.requestInProgress=!1,this.intervalID=null,this.lastPollTime=0}var e,r,n,i;return e=t,r=[{key:"handleRequest",value:(i=wi(Ti().mark((function t(){var e,r,n;return Ti().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e={},t.next=3,We.get(this.url,e,this.timeout);case 3:return(r=t.sent).error?C.w("Poll failed: "+r.error):r.ok?(C.trace("sdk poll"),r.headers.has("Retry-After")&&(n=r.headers.get("Retry-After"),Number.isNaN(n)||(n=1e3*Number.parseFloat(n))>0&&n!==this.frequency&&(this.frequency=n,this._start(!1)))):400===r.status?this.stop():C.w("Unexpected poll response "+r.status+", intervalID: "+this.frequency+" ms"),t.abrupt("return",r);case 6:case"end":return t.stop()}}),t,this)}))),function(){return i.apply(this,arguments)})},{key:"getFrequency",value:function(){return this.frequency}},{key:"isRunning",value:function(){return null!==this.intervalID}},{key:"poll",value:(n=wi(Ti().mark((function t(e){var r;return Ti().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.shouldPoll()&&this.intervalID){t.next=2;break}return t.abrupt("return");case 2:return this.requestInProgress=!0,this.lastPollTime=e&&this.lastPollTime?this.lastPollTime+this.frequency:Date.now(),t.next=6,this.handleRequest();case 6:r=t.sent,this.handler&&this.handler(r,this.frequency),this.requestInProgress=!1;case 9:case"end":return t.stop()}}),t,this)}))),function(t){return n.apply(this,arguments)})},{key:"shouldPoll",value:function(){if(this.requestInProgress)return C.d(A,"Last poll still in flight. Ignoring."),!1;var t=Date.now()-this.lastPollTime;return!(t<this.frequency/2&&(C.d(A,"Last poll too recent ("+t/1e3+"s). Ignoring."),1))}},{key:"start",value:function(){this._start(!0)}},{key:"_start",value:function(t){var e=this;this.stop();var r=function(){if(t)return 0;for(var r=e.lastPollTime+e.frequency-Date.now();r<0;)r+=e.frequency;return r}();this.intervalID=setTimeout((function(){e.intervalID=setInterval((function(){e.poll()}),e.frequency),e.poll()}),r)}},{key:"stop",value:function(){clearInterval(this.intervalID),this.intervalID=null}},{key:"shutdown",value:function(){this.stop(),this.handler=function(){},C.d(T,"Poller shutdown")}}],r&&Ei(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Pi(t,e){if(t){if("string"==typeof t)return Ii(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ii(t,e):void 0}}function Ii(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Oi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Ci=function(){function t(e,r,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e,this.value=r||"",this.attributes=new Map,n&&i&&this.addAttribute(n,i)}var e,r;return e=t,(r=[{key:"addAttribute",value:function(t,e){this.attributes.set(t,e)}},{key:"getName",value:function(){return this.name}},{key:"getValue",value:function(){return this.value}},{key:"getAttributes",value:function(){return this.attributes}},{key:"setValue",value:function(t){this.value=t}},{key:"toString",value:function(){var t,e,r="";if(r+="Property Name: ",r+=this.name,H(this.value)||(r+=", Value: ",r+=this.value),this.attributes.size>0){r+=", Attributes:{";var n,i=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=Pi(t))){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(this.attributes);try{for(i.s();!(n=i.n()).done;){var a=(t=n.value,e=2,function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(t);!(o=(n=r.next()).done)&&(a.push(n.value),!e||a.length!==e);o=!0);}catch(t){s=!0,i=t}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}(t,e)||Pi(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}());r+=a[0]+":"+a[1]+" "}}catch(t){i.e(t)}finally{i.f()}r+="}"}return r}}])&&Oi(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Di(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=Ri(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function Ri(t,e){if(t){if("string"==typeof t)return Ni(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ni(t,e):void 0}}function Ni(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Li(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var _i=function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.name=e,this.attributes=r||new Map,this.text="",this.children=[]}var e,r,n;return e=t,n=[{key:"attributeToString",value:function(t,e){return" "+t+'="'+e+'"'}}],(r=[{key:"getAttributes",value:function(){return this.attributes}},{key:"getAttribute",value:function(t){return this.attributes.get(t)}},{key:"getChildren",value:function(){return this.children}},{key:"getInnerText",value:function(){return this.text}},{key:"getName",value:function(){return this.name}},{key:"addChild",value:function(t){this.children.push(t)}},{key:"setInnerText",value:function(t){this.text=t}},{key:"toString",value:function(){var e="<";e+=this.name;var r,n,i,a,o=Di(this.attributes);try{for(o.s();!(r=o.n()).done;){var s=(i=r.value,a=2,function(t){if(Array.isArray(t))return t}(i)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(t);!(o=(n=r.next()).done)&&(a.push(n.value),!e||a.length!==e);o=!0);}catch(t){s=!0,i=t}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}(i,a)||Ri(i,a)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),u=s[0],c=s[1];e+=t.attributeToString(u,c)}}catch(t){o.e(t)}finally{o.f()}if(0===this.children.length&&H(this.text))e+="/>";else{e+=">",H(this.text)||(e+=this.text);var l,f=Di(this.children);try{for(f.s();!(l=f.n()).done;)e+=V("\n"+l.value)}catch(t){f.e(t)}finally{f.f()}H(this.text)||0!==this.children.length?e+=(n="\n</"+this.name+">")?""+n.toString().replace("\n    ","\n"):"null":(e+="</",e+=this.name,e+=">")}return e}}])&&Li(e.prototype,r),n&&Li(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Bi(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return ji(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?ji(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function ji(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Ui(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Mi=function(){function t(e,r){if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),e){this.linearAdBreaks=e.linearAdBreaks?e.linearAdBreaks:[],this.nonLinearAdBreaks=e.nonLinearAdBreaks?e.nonLinearAdBreaks:[],this.displayAdBreaks=e.displayAdBreaks?e.displayAdBreaks:[];var n=e.getStreamData();this.processStreamData(n)}this.setHash(r)}var e,r;return e=t,(r=[{key:"getDisplayAdBreaks",value:function(){return this.displayAdBreaks}},{key:"getEarlyReturn",value:function(){return this.earlyReturn}},{key:"getLinearAdBreaks",value:function(){return this.linearAdBreaks}},{key:"getHostNode",value:function(){return this.hostNode}},{key:"getHostSuffix",value:function(){return this.hostSuffix}},{key:"getNonLinearAdBreaks",value:function(){return this.nonLinearAdBreaks}},{key:"getPdtInitial",value:function(){return this.pdtInitial}},{key:"getPdtStart",value:function(){return this.pdtStart}},{key:"getPdtEnd",value:function(){return this.pdtEnd}},{key:"getSessionIdentifier",value:function(){return this.sessionIdentifier}},{key:"getStreamDuration",value:function(){return this.streamDuration}},{key:"hasAdBreaks",value:function(){return this.linearAdBreaks.length>0||this.nonLinearAdBreaks.length>0||this.displayAdBreaks.length>0}},{key:"isEqualTo",value:function(t){return this.hashCode===t.hashCode}},{key:"processStreamData",value:function(t){this.sessionIdentifier=t.getSessionIdentifier(),this.streamDuration=t.getDuration(),this.hostNode=t.getHostNode(),this.hostSuffix=t.getHostSuffix(),this.pdtInitial=t.getPdtInitial(),this.pdtStart=t.getPdtStart(),this.pdtEnd=t.getPdtEnd(),this.earlyReturn=t.getEarlyReturn()}},{key:"setHash",value:function(t){if(t){var e,r=0;for(e=0;e<t.length;e++)r=(r<<5)-r+t.charCodeAt(e),r&=r;this.hashCode=r}}},{key:"toString",value:function(){var t,e="Linear AdBreaks:",r=Bi(this.linearAdBreaks);try{for(r.s();!(t=r.n()).done;)e+="\n"+t.value}catch(t){r.e(t)}finally{r.f()}e+="\n\nNonLinear AdBreaks:";var n,i=Bi(this.nonLinearAdBreaks);try{for(i.s();!(n=i.n()).done;)e+="\n"+n.value}catch(t){i.e(t)}finally{i.f()}e+="\n\nDisplay AdBreaks:";var a,o=Bi(this.displayAdBreaks);try{for(o.s();!(a=o.n()).done;)e+="\n"+a.value}catch(t){o.e(t)}finally{o.f()}return e+="\n\nHostNode:",e+="\n"+this.hostNode,e+="\n\nHostSuffix:",e+="\n"+this.hostSuffix,e+="\n\nSessionIdentifier:",e+="\n"+this.sessionIdentifier,e+="\n\nStreamDuration:",e+="\n"+this.streamDuration,e+="\n\npdtInitial:",e+="\n"+this.pdtInitial,e+="\n\npdtStart:",e+="\n"+this.pdtStart,e+="\n\npdtEnd:",e+="\n"+this.pdtEnd,(e+="mmearlyReturn:")+"\n"+this.earlyReturn}}])&&Ui(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function xi(t){var e=new Map;if(t)for(var r in t)e.set(r,t[r]);return e}function Fi(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Vi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Hi(t,e,r){return e&&Vi(t.prototype,e),r&&Vi(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Yi(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return qi(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?qi(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function qi(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}var Wi="AdServingId",Gi="Description",zi="vmap:AdBreak",Xi="vmap:Tracking",Ki="Category",Qi="AdSystem",$i="Advertiser",Ji="Survey",Zi="Pricing",ta="UniversalAdId",ea="Extensions",ra="Creative",na="Linear",ia="Icon",aa="IconClickFallbackImage",oa="AdParameters",sa="InteractiveCreativeFile",ua="NonLinearAds",ca="NonLinear",la="CompanionAds",fa="Companion",ha="StaticResource",da="HTMLResource",pa="Tracking",ya="Verification",va="JavaScriptResource",ga="ExecutableResource",ba="CreativeExtensions",ma=function(){function t(){Fi(this,t),this.clear()}return Hi(t,[{key:"clear",value:function(){this.adverts=[],this.timelineTrackingMap=new Map,this.trackingEvent=null,this.start=0,this.duration=0,this.position=null,this.breakType=null,this.identifier=null,this.earlyReturn=null}}]),t}(),ka=function(){function t(){Fi(this,t),this.clear()}return Hi(t,[{key:"clear",value:function(){this.id=null,this.sequence=null,this.adType=null,this.properties=[],this.linearCreative=null,this.companionAds=null,this.impressions=null,this.errors=null,this.viewableImpressions=new Map,this.adVerifications=[],this.filler=!1,this.nonLinear=!1,this.topLevelWrapper=null,this.extensions=null,this.currentCreativeType=0,this.nonLinearAds=null,this.adSystemVersion=null,this.advertiserId=null,this.categoryAuthority=null,this.pricingModel=null,this.pricingCurrency=null,this.surveyType=null,this.verificationVendor=null,this.verificationEvents=new Map,this.verificationResources=[],this.verificationApiFramework=null,this.verificationBrowserOptional=null,this.verificationParameters=null,this.verificationResourceType=null,this.extensionStack=[]}}]),t}(),Ta=function(){function t(){Fi(this,t),this.clear()}return Hi(t,[{key:"clear",value:function(){this.required=null,this.companions=[]}}]),t}(),Aa=function(){function t(){Fi(this,t),this.clearAll()}return Hi(t,[{key:"clear",value:function(){this.clickThroughUrl="",this.clickThroughTrackings=[],this.clickThroughCustoms=[],this.nonLinearResources=[],this.duration=null,this.trackingMap=new Map,this.interactiveTracking=null,this.icons=[],this.currentAssetUri=null,this.skipOffset=null,this.adParameters=null,this.staticResourceCreativeType=null,this.trackingEvent=null,this.htmlResourceEncoded=!1,this.altText=null,this.companionExtensionStack=[],this.companionExtensions=null,this.icSource=null,this.properties=[]}},{key:"clearAll",value:function(){this.advertId=null,this.id=null,this.sequence=null,this.universalAdIds=[],this.universalAdIdRegistry=null,this.extensions=null,this.extensionStack=[],this.clickThroughTrackings=[],this.clickThroughUrl="",this.adParameters=null,this.trackingEvent=null,this.duration=null,this.trackingMap=new Map,this.interactiveTracking=null,this.icons=[],this.currentAssetUri=null,this.skipOffset=null,this.clickThroughCustoms=[],this.nonLinearResources=[],this.staticResourceCreativeType=null,this.htmlResourceEncoded=null,this.altText=null,this.companionExtensions=null,this.companionExtensionStack=[],this.properties=[],this.icSource=null}}]),t}(),wa=function(){function t(){Fi(this,t),this.clear()}return Hi(t,[{key:"clear",value:function(){this.resources=[],this.properties=[],this.clickThroughUrl=null,this.staticResourceCreativeType=null,this.clickTrackings=[],this.clickFallbackImages=[],this.viewTrackings=[],this.htmlResourceEncoded=!1}}]),t}(),Ea=function(){function t(){Fi(this,t),this.clear()}return Hi(t,[{key:"clear",value:function(){this.properties=[],this.resource=null,this.staticResourceCreativeType=null,this.altText=null}}]),t}(),Sa=function(){function t(){Fi(this,t),this.clear()}return Hi(t,[{key:"clear",value:function(){this.nonLinearCreatives=[],this.trackingMap=new Map}}]),t}(),Pa=function(){function t(){Fi(this,t),this.sessionIdentifier=null,this.duration=0,this.hostNode=null,this.hostSuffix=null,this.pdtInitial=null,this.pdtStart=null,this.pdtEnd=null,this.earlyReturn=null}return Hi(t,[{key:"getSessionIdentifier",value:function(){return this.sessionIdentifier}},{key:"getDuration",value:function(){return this.duration}},{key:"getHostNode",value:function(){return this.hostNode}},{key:"getHostSuffix",value:function(){return this.hostSuffix}},{key:"getPdtInitial",value:function(){return this.pdtInitial}},{key:"getPdtStart",value:function(){return this.pdtStart}},{key:"getPdtEnd",value:function(){return this.pdtEnd}},{key:"getEarlyReturn",value:function(){return this.earlyReturn}}]),t}(),Ia=function(){function t(e){Fi(this,t),this.broker=e,this.linearAdBreaks=[],this.nonLinearAdBreaks=[],this.displayAdBreaks=[],this.isVmap=!1,this.isValidVAST=!0,this.processingAdvertExtensions=!1,this.processingCreativeExtensions=!1,this.characters="",this.adBreakData=new ma,this.advertData=new ka,this.companionAdsData=new Ta,this.creativeData=new Aa,this.iconClickFallbackImageData=new Ea,this.iconData=new wa,this.iconFallbackImageData=new Ea,this.nonLinearAdsData=new Sa,this.streamData=new Pa,this.onCdata=this.onCdata.bind(this),this.onOpenTag=this.onOpenTag.bind(this),this.onCloseTag=this.onCloseTag.bind(this),this.onText=this.onText.bind(this)}return Hi(t,[{key:"addToCreativeExtensionStack",value:function(t){1===this.advertData.currentCreativeType?this.creativeData.companionExtensionStack.push(t):this.creativeData.extensionStack.push(t)}},{key:"checkValidVersion",value:function(t){var e=parseFloat(t);return!Number.isNaN(e)&&e>=4.2}},{key:"getStreamData",value:function(){return this.streamData}},{key:"handleCreativeExtensionsForOnEndDefault",value:function(t){var e=1===this.advertData.currentCreativeType?this.creativeData.companionExtensionStack:this.creativeData.extensionStack,r=e.length;2===r?(this.pop(!1,!0),this.processingCreativeExtensions=!1):r>0&&t===e[r-1].getName()&&this.pop(!1,!0)}},{key:"handleStartAd",value:function(t){this.advertData.id=t.id;var e=parseInt(t.sequence);this.advertData.sequence=Number.isNaN(e)?0:e,Number.isNaN(e)||(this.advertData.sequence=e),this.advertData.adType=t.adType,Gn.getBreakTypeFromString(this.adBreakData.breakType)!==qn.LINEAR&&(this.advertData.nonLinear=!0)}},{key:"handleStartAdWrapper",value:function(t){var e=t.id?t.id:"",r=t.creativeId?t.creativeId:"",n=t.AdSystem?t.AdSystem:"",i=new Jn(e,r,n);this.advertData.topLevelWrapper&&i.setChild(this.advertData.topLevelWrapper),this.advertData.topLevelWrapper=i}},{key:"handleStartCreative",value:function(t){this.creativeData.advertId=t.adId,this.creativeData.id=t.id;var e=parseInt(t.sequence);this.creativeData.sequence=isNaN(e)?0:e}},{key:"handleStartCreativeExtension",value:function(t,e){var r=t.type;-1===(r=r||"").indexOf("com.yospace")&&-1===r.indexOf("AdVerifications")&&(this.processingCreativeExtensions=!0,this.addToCreativeExtensionStack(new _i(e.name,xi(t))))}},{key:"handleStartExtension",value:function(t,e){var r=t.type;-1===(r=r||"").indexOf("com.yospace")&&-1===r.indexOf("AdVerifications")&&(this.processingAdvertExtensions=!0,this.advertData.extensionStack.push(new _i(e.name,xi(t))))}},{key:"handleStartExtensionElement",value:function(t,e){this.processingAdvertExtensions?this.advertData.extensionStack.push(new _i(e.name,xi(t))):this.processingCreativeExtensions&&this.addToCreativeExtensionStack(new _i(e.name,xi(t)))}},{key:"handleStartHtmlResource",value:function(t){var e=t.xmlEncoded,r=!!e&&("TRUE"===e.toUpperCase()||"1"===e);this.iconData.properties.length>0?this.iconData.htmlResourceEncoded=r:this.creativeData.htmlResourceEncoded=r}},{key:"handleStartPricing",value:function(t){var e=t.model;this.advertData.pricingModel=e?e.toUpperCase():"",this.advertData.pricingCurrency=t.currency}},{key:"handleStartStaticResource",value:function(t){this.iconClickFallbackImageData.properties.length>0?this.iconClickFallbackImageData.staticResourceCreativeType=t.creativeType:this.iconData.properties.length>0?this.iconData.staticResourceCreativeType=t.creativeType:this.creativeData.staticResourceCreativeType=t.creativeType}},{key:"handleStartTracking",value:function(t){if(this.creativeData.trackingEvent=t.event,"progress"===this.creativeData.trackingEvent){var e=t.offset;H(e)||(this.creativeData.trackingEvent=this.creativeData.trackingEvent+"-"+e)}}},{key:"handleEndAd",value:function(){var t=new jn(this.advertData);t.isValid()?this.adBreakData.adverts.push(t):C.w("Invalid advert.  Discarding ("+this.advertData.id+")"),this.advertData.clear()}},{key:"handleAdvertExtensionsForOnEndDefault",value:function(t){var e=this.advertData.extensionStack.length;2===e?(this.pop(!0,!0),this.processingAdvertExtensions=!1):e>0&&t===this.advertData.extensionStack[e-1].getName()&&this.pop(!0,!0)}},{key:"handleEndAdTitle",value:function(){var t=this.characters.trim();this.advertData.properties.push(new Ci("AdTitle",t)),"filler"===t&&(this.advertData.filler=!0)}},{key:"handleEndClickTracking",value:function(){var t=this.characters.trim();Ve(t)?this.creativeData.clickThroughTrackings.push(t):C.w("Discarding click tracking URL:"+t)}},{key:"handleEndCompanion",value:function(){var t=null;H(this.creativeData.clickThroughUrl)||(t=new Jt(this.creativeData.clickThroughUrl,this.creativeData.clickThroughTrackings,null));var e=new dr(this.creativeData,t,this.creativeData.nonLinearResources,this.creativeData.trackingMap,this.broker);e.isValid()?(e.setNonLinear(this.advertData.nonLinear),this.companionAdsData.companions.push(e)):C.w("Discarding invalid Companion"),this.creativeData.clear()}},{key:"handleEndCompanionClickTracking",value:function(){var t=this.characters.trim();Ve(t)?this.creativeData.clickThroughTrackings.push(t):C.w("Discarding empty Companion click tracking URL")}},{key:"handleEndCreative",value:function(){this.creativeData.clearAll()}},{key:"handleEndCustomClick",value:function(){var t=this.characters.trim();""!==t?this.creativeData.clickThroughCustoms.push(t):C.w("Discarding empty custom click URL")}},{key:"handleEndError",value:function(t){var e=this.characters.trim();Ve(e)?this.advertData.errors?this.advertData.errors.addTrackingUrl(e):this.advertData.errors=new K(t,[e]):C.w("Discarding empty Error")}},{key:"handleEndExecutableResource",value:function(){if(this.advertData.verificationApiFramework&&this.advertData.verificationResourceType){var t=new Ci("ExecutableResource",this.characters.trim(),"apiFramework",this.advertData.verificationApiFramework);t.addAttribute("type",this.advertData.verificationResourceType),this.advertData.verificationResources.push(t)}this.advertData.verificationApiFramework=null,this.advertData.verificationResourceType=null}},{key:"handleEndIcon",value:function(){var t=null;(!H(this.iconData.clickThroughUrl)||this.iconData.viewTrackings.length>0)&&(t=H(this.iconData.clickThroughUrl)?new Jt(null,null,this.iconData.viewTrackings):new Jt(this.iconData.clickThroughUrl,this.iconData.clickTrackings,this.iconData.viewTrackings));var e=new sn(this.iconData.properties,this.iconData.resources,t,this.iconData.clickFallbackImages,this.broker);e.isValid()?this.creativeData.icons.push(e):C.w("Discarding invalid Icon"),this.iconData.clear()}},{key:"handleEndIFrameResource",value:function(){var t=this.characters.trim();this.iconData.properties.length>0?this.iconData.resources.push(new Je($e.IFRAME,t)):this.creativeData.nonLinearResources.push(new Je($e.IFRAME,t))}},{key:"handleEndExtensionElement",value:function(t){this.processingAdvertExtensions?this.handleAdvertExtensionsForOnEndDefault(t):this.handleCreativeExtensionsForOnEndDefault(t)}},{key:"handleEndHtmlResource",value:function(){if(this.iconData.properties.length>0){var t=this.characters.trim();this.iconData.resources.push(new Je($e.HTML,t,null,this.iconData.htmlResourceEncoded))}else this.creativeData.nonLinearResources.push(new Je($e.HTML,this.characters,null,this.creativeData.htmlResourceEncoded))}},{key:"handleEndIconClickFallbackImage",value:function(){var t=new $r(this.iconClickFallbackImageData.properties,this.iconClickFallbackImageData.altText,this.iconClickFallbackImageData.resource);t.isValid()?this.iconData.clickFallbackImages.push(t):C.w("Discarding invalid IconClickFallbackImage"),this.iconClickFallbackImageData.clear()}},{key:"handleEndIconClickTracking",value:function(){var t=this.characters.trim();Ve(t)?this.iconData.clickTrackings.push(t):C.w("Discarding empty Icon click tracking URL")}},{key:"handleEndIconViewTracking",value:function(){var t=this.characters.trim();Ve(t)?this.iconData.viewTrackings.push(t):C.w("Discarding empty Icon view tracking URL")}},{key:"handleEndInteractiveTracking",value:function(){this.creativeData.interactiveTracking?this.creativeData.interactiveTracking.addTrackingUrl(this.characters.trim()):this.creativeData.interactiveTracking=new K(this.creativeData.trackingEvent,[this.characters.trim()])}},{key:"handleEndLinear",value:function(){var t=null;(!H(this.creativeData.clickThroughUrl)||this.creativeData.clickThroughCustoms.length>0)&&(t=H(this.creativeData.clickThroughUrl)?new Jt(null,null,this.creativeData.clickThroughCustoms):new Jt(this.creativeData.clickThroughUrl,this.creativeData.clickThroughTrackings,this.creativeData.clickThroughCustoms));var e=null;this.creativeData.properties.length>0&&((e=new Pn(this.creativeData.icSource,this.creativeData.properties,this.broker,this.creativeData.interactiveTracking)).isValid()||(C.w("Discarding invalid InteractiveCreative"),e=null));var r=new ye(this.creativeData,t,e,this.broker);r.isValid()?this.advertData.linearCreative=r:C.w("Discarding invalid LinearCreative"),this.creativeData.clear()}},{key:"handleEndImpression",value:function(t){var e=this.characters.trim();Ve(e)?this.advertData.impressions?this.advertData.impressions.addTrackingUrl(e):this.advertData.impressions=new K(t,[e]):C.w("Discarding empty Impression")}},{key:"handleEndInteractiveCreativeFile",value:function(){this.creativeData.icSource=this.characters.trim()}},{key:"handleEndJavaScriptResource",value:function(){if(this.advertData.verificationApiFramework&&this.advertData.verificationBrowserOptional){var t=new Ci(va,this.characters.trim(),"apiFramework",this.advertData.verificationApiFramework);t.addAttribute("browserOptional",this.advertData.verificationBrowserOptional),this.advertData.verificationResources.push(t)}this.advertData.verificationApiFramework=null,this.advertData.verificationBrowserOptional=null}},{key:"handleEndMediaFile",value:function(){0!==this.creativeData.properties.length?this.creativeData.icSource=this.characters.trim():this.creativeData.currentAssetUri=this.characters.trim()}},{key:"handleEndNonLinearClickTracking",value:function(){var t=this.characters.trim();Ve(t)?this.creativeData.clickThroughTrackings.push(t):C.w("Discarding empty Nonlinear click tracking URL")}},{key:"handleEndPricing",value:function(){var t=this.characters.trim();if(""!==t){var e=new Ci(Zi,t,"currency",this.advertData.pricingCurrency);e.addAttribute("model",this.advertData.pricingModel),H(this.advertData.pricingCurrency)||H(this.advertData.pricingModel)?C.w("Discarding invalid Pricing property"):this.advertData.properties.push(e)}else C.w("Discarding invalid Pricing property")}},{key:"handleEndUniversalAdId",value:function(){var t=this.characters.trim();""!==t?this.creativeData.universalAdIds.push(new Ci(ta,t,"idRegistry",this.creativeData.universalAdIdRegistry)):C.w("Discarding empty UniversalAdId URL")}},{key:"handleEndVerification",value:function(){var t=new qr(this.advertData);t.isValid()?this.advertData.adVerifications.push(t):C.w("Discarding invalid AdVerification"),this.advertData.verificationEvents=new Map,this.advertData.verificationResources=[],this.advertData.verificationParameters=null}},{key:"handleEndVmapTracking",value:function(){var t=this.characters.trim();if(K.isValidAdBreakEvent(this.adBreakData.trackingEvent))if(H(t))C.w("Discarding empty VMAP");else{var e=this.adBreakData.timelineTrackingMap.get(this.adBreakData.trackingEvent);e?e.addTrackingUrl(t):(e=new K(this.adBreakData.trackingEvent,[t]),this.adBreakData.timelineTrackingMap.set(this.adBreakData.trackingEvent,e))}else C.d(P,"Discarding invalid vmap:Tracking event")}},{key:"handleEndNonLinear",value:function(){var t=null;this.creativeData.clickThroughUrl&&""!==this.creativeData.clickThroughUrl&&(t=new Jt(this.creativeData.clickThroughUrl,this.creativeData.clickThroughTrackings,null));var e=new bn(this.creativeData,t,this.creativeData.nonLinearResources,this.broker);e.isValid()?(e.setNonLinear(this.advertData.nonLinear),this.nonLinearAdsData.nonLinearCreatives.push(e)):C.w("Discarding invalid NonLinear"),this.creativeData.clear()}},{key:"handleEndStaticResource",value:function(){var t=this.characters.trim();if(this.iconClickFallbackImageData.properties.length>0){var e=new Je($e.STATIC,t,this.iconClickFallbackImageData.staticResourceCreativeType);if(e.isValid())return void(this.iconClickFallbackImageData.resource=e)}else if(this.iconData.properties.length>0){var r=new Je($e.STATIC,t,this.iconData.staticResourceCreativeType);if(r.isValid())return void this.iconData.resources.push(r)}else{var n=new Je($e.STATIC,t,this.creativeData.staticResourceCreativeType);if(n.isValid())return void this.creativeData.nonLinearResources.push(n)}C.w("Discarding invalid StaticResource")}},{key:"handleEndTracking",value:function(){if(H(Ve(this.characters.trim())))C.w("Discarding empty tracking URL");else{var t=null;K.isValidVerificationEvent(this.creativeData.trackingEvent)?t=this.advertData.verificationEvents:2===this.advertData.currentCreativeType&&K.isValidLinearEvent(this.creativeData.trackingEvent)||0===this.creativeData.trackingEvent.indexOf("progress")?t=this.creativeData.trackingMap:2===this.advertData.currentCreativeType&&K.isValidInteractiveEvent(this.creativeData.trackingEvent)?this.handleEndInteractiveTracking():1===this.advertData.currentCreativeType&&K.isValidCompanionEvent(this.creativeData.trackingEvent)?t=this.creativeData.trackingMap:3===this.advertData.currentCreativeType&&K.isValidNonLinearEvent(this.creativeData.trackingEvent)&&(t=this.nonLinearAdsData.trackingMap),t&&this.parseMapForOnEndTracking(t)}}},{key:"handleEndViewableImpression",value:function(t){var e=this.characters.trim();if(H(Ve(e)))C.w("Discarding empty ViewableImpression URL");else{var r=this.advertData.viewableImpressions.get(t);r?r.addTrackingUrl(e):(r=new K(t,[e]),this.advertData.viewableImpressions.set(t,r))}}},{key:"handleTextDataForExtensions",value:function(){var t=this.characters.trim();if(""!==t){var e=[];(e=this.processingAdvertExtensions?this.advertData.extensionStack:1===this.advertData.currentCreativeType?this.creativeData.companionExtensionStack:this.creativeData.extensionStack).length>0&&e[e.length-1].setInnerText(t)}}},{key:"handleVmapAdBreak",value:function(){if(null!==this.adBreakData.earlyReturn)return this.streamData.earlyReturn=this.adBreakData.earlyReturn,void this.adBreakData.clear();Gn.getBreakTypeFromString(this.adBreakData.breakType)===qn.LINEAR&&(this.adBreakData.start=this.broker.normaliseAdBreakStart(this.adBreakData.start,this.adBreakData.position));var t=new Gn(this.adBreakData.start,this.adBreakData.duration,this.adBreakData.position,this.adBreakData.timelineTrackingMap,this.adBreakData.breakType,this.adBreakData.identifier,null);if(this.adBreakData.adverts.length>0&&t.setAdverts(this.adBreakData.adverts),t.postParse(this.broker),t.isValid())switch(Gn.getBreakTypeFromString(this.adBreakData.breakType)){case qn.LINEAR:this.linearAdBreaks.push(t);break;case qn.NONLINEAR:this.nonLinearAdBreaks.push(t);break;case qn.DISPLAY:this.displayAdBreaks.push(t)}else C.w("Discarding empty ad break");this.adBreakData.clear()}},{key:"handleYospaceAdBreak",value:function(t){var e=t.duration;e&&(this.adBreakData.duration=W(e));var r=t.position;r&&(this.adBreakData.position=r);var n=t.earlyReturn;if(n){var i=W(n,-1);this.adBreakData.earlyReturn=-1!==i?i+this.adBreakData.start:-1}}},{key:"handleYospaceStream",value:function(t){var e=t.urlDomain;e&&(this.streamData.hostNode=e);var r=t.urlSuffix;if(r&&(this.streamData.hostSuffix=r),t.duration){var n=W(t.duration);n&&(this.streamData.duration=n)}if(this.streamData.hostSuffix){var i=this.streamData.hostSuffix.match("yo.p.si=([^&]+)");i&&(this.streamData.sessionIdentifier=i[1])}this.streamData.pdtInitial=q(t.pdtinitial,null),this.streamData.pdtStart=q(t.pdtstart,null),this.streamData.pdtEnd=q(t.pdtend,null),(null===this.streamData.pdtStart||null===this.streamData.pdtEnd||this.streamData.pdtStart>this.streamData.pdtEnd)&&(this.streamData.pdtStart=null,this.streamData.pdtEnd=null,this.streamData.pdtInitial=null)}},{key:"onCdata",value:function(t){this.characters=t,(this.processingAdvertExtensions||this.processingCreativeExtensions)&&this.handleTextDataForExtensions()}},{key:"onOpenTag",value:function(t){var e=t.attributes;if(this.processingAdvertExtensions||this.processingCreativeExtensions)this.handleStartExtensionElement(e,t);else{if("vmap:VMAP"===t.name&&(this.isVmap=!0),"yospace:Stream"===t.name&&this.handleYospaceStream(e),t.name===zi){var r=e.timeOffset;r&&(this.adBreakData.start=W(r,-1));var n=e.breakType;n&&(this.adBreakData.breakType=n);var i=e.breakId;i&&(this.adBreakData.identifier=i)}if("yospace:AdBreak"===t.name&&this.handleYospaceAdBreak(e),t.name===Xi&&(this.adBreakData.trackingEvent=e.event),"VAST"===t.name){var a=e.version;this.checkValidVersion(a)||(C.e("Invalid or missing VAST version; is AV tag defined?"),this.isValidVAST=!1)}"Ad"===t.name&&this.handleStartAd(e),"AdWrapper"===t.name&&this.handleStartAdWrapper(e),t.name===Ki&&(this.advertData.categoryAuthority=e.authority),t.name===Qi&&(this.advertData.adSystemVersion=e.version),t.name===$i&&(this.advertData.advertiserId=e.id),t.name===Ji&&(this.advertData.surveyType=e.type),t.name===Zi&&this.handleStartPricing(e),t.name===ta&&(this.creativeData.universalAdIdRegistry=e.idRegistry),t.name===ea&&this.advertData.extensionStack.push(new _i(t.name,xi(e))),t.name===ra&&this.handleStartCreative(e),t.name===na&&(this.advertData.currentCreativeType=2,this.creativeData.skipOffset=e.skipoffset),t.name===ia&&this.populateIconPropertyList(e),t.name===aa&&this.populateIconClickFallbackImagePropertyList(e),t.name===oa&&(this.creativeData.adParameters=new Ci(oa,null,"xmlEncoded",e.xmlEncoded)),t.name===sa&&this.populateInteractiveCreativePropertyList(e),t.name===ua&&(this.advertData.currentCreativeType=3),t.name===ca&&this.populateNonLinearPropertyList(e),t.name===la&&(this.advertData.currentCreativeType=1,this.companionAdsData.required=e.required),t.name===fa&&this.populateCompanionPropertyList(e),t.name===ha&&this.handleStartStaticResource(e),t.name===da&&this.handleStartHtmlResource(e),t.name===pa&&this.handleStartTracking(e),t.name===ya&&(this.advertData.verificationVendor=e.vendor),t.name===va&&(this.advertData.verificationApiFramework=e.apiFramework,this.advertData.verificationBrowserOptional=e.browserOptional),t.name===ga&&(this.advertData.verificationApiFramework=e.apiFramework,this.advertData.verificationResourceType=e.type),"Extension"===t.name&&this.handleStartExtension(e,t),t.name===ba&&this.addToCreativeExtensionStack(new _i(t.name,xi(e))),"CreativeExtension"===t.name&&this.handleStartCreativeExtension(e,t),t.isSelfClosing&&this.onCloseTag(t)}}},{key:"onCloseTag",value:function(t){if(this.processingAdvertExtensions||this.processingCreativeExtensions)return this.handleEndExtensionElement(t),void(this.characters="");t===zi&&this.handleVmapAdBreak(),t===Xi&&this.handleEndVmapTracking(),"Ad"===t&&this.handleEndAd(),t===Qi&&this.advertData.properties.push(new Ci("AdSystem",this.characters.trim(),"version",this.advertData.adSystemVersion)),"AdTitle"===t&&this.handleEndAdTitle(),"Impression"===t&&this.handleEndImpression(t),t===Wi&&this.advertData.properties.push(new Ci(Wi,this.characters.trim())),t===Ki&&this.advertData.properties.push(new Ci(Ki,this.characters.trim(),"authority",this.advertData.categoryAuthority)),t===Gi&&this.advertData.properties.push(new Ci(Gi,this.characters.trim())),t===$i&&this.advertData.properties.push(new Ci($i,this.characters.trim(),"id",this.advertData.advertiserId)),t===Ji&&this.advertData.properties.push(new Ci(Ji,this.characters.trim(),"type",this.advertData.surveyType)),"Error"===t&&this.handleEndError(t),t===Zi&&this.handleEndPricing(),t===ta&&this.handleEndUniversalAdId(),t===ea&&this.pop(!0,!1),t===ba&&this.pop(!1,!1),t===ya&&this.handleEndVerification(),"VerificationParameters"===t&&(this.advertData.verificationParameters=this.characters.trim()),"MediaFile"===t&&this.handleEndMediaFile(),t===sa&&this.handleEndInteractiveCreativeFile(),"ClickThrough"!==t&&"NonLinearClickThrough"!==t&&"CompanionClickThrough"!==t||(this.creativeData.clickThroughUrl=this.characters.trim()),"IconClickThrough"===t&&(this.iconData.clickThroughUrl=this.characters.trim()),"ClickTracking"===t&&this.handleEndClickTracking(),"NonLinearClickTracking"===t&&this.handleEndNonLinearClickTracking(),"CompanionClickTracking"===t&&this.handleEndCompanionClickTracking(),"IconClickTracking"===t&&this.handleEndIconClickTracking(),t===aa&&this.handleEndIconClickFallbackImage(),"AltText"===t&&(this.iconClickFallbackImageData.properties.length>0?this.iconClickFallbackImageData.altText=this.characters.trim():this.creativeData.altText=this.characters.trim()),"CustomClick"===t&&this.handleEndCustomClick(),"IconViewTracking"===t&&this.handleEndIconViewTracking(),t===ra&&this.handleEndCreative(),t===na&&this.handleEndLinear(),t===ua&&(this.advertData.nonLinearAds=new br(this.nonLinearAdsData.trackingMap,this.nonLinearAdsData.nonLinearCreatives),this.nonLinearAdsData.clear()),t===ca&&this.handleEndNonLinear(),t===la&&(this.advertData.companionAds=new rr(this.companionAdsData.required,this.companionAdsData.companions),this.companionAdsData.clear()),t===fa&&this.handleEndCompanion(),t===ia&&this.handleEndIcon(),t===oa&&this.creativeData.adParameters.setValue(this.characters.trim()),"Duration"===t&&(this.creativeData.duration=this.characters.trim()),"Viewable"!==t&&"NotViewable"!==t&&"ViewUndetermined"!==t||this.handleEndViewableImpression(t),t===ha&&this.handleEndStaticResource(),t===da&&this.handleEndHtmlResource(),"IFrameResource"===t&&this.handleEndIFrameResource(),t===pa&&this.handleEndTracking(),t===va&&this.handleEndJavaScriptResource(),t===ga&&this.handleEndExecutableResource()}},{key:"onText",value:function(t){this.characters=t,(this.processingAdvertExtensions||this.processingCreativeExtensions)&&this.handleTextDataForExtensions()}},{key:"parse",value:function(t){var e=this;return new Promise((function(r,n){try{var i,a=fi().parser(!0);a.onerror=function(t){C.e("Failed to parse document: "+t),r(null)},a.ontext=e.onText,a.onopentag=e.onOpenTag,a.onclosetag=e.onCloseTag,a.oncdata=e.onCdata,a.write(t).close(),e.isVmap?e.isValidVAST||(C.e("Failed to parse document.  VAST not valid"),r(null)):(C.e("Failed to parse document.  VMAP not found"),r(null)),function(t){if(C.debugflags&P){C.d(P,"\n--------------- VMAP PARSING SUMMARY ---------------"),C.d(P," * Number of ad breaks: "+t.linearAdBreaks.length),C.d(P," * Number of nonlinear ad breaks: "+t.nonLinearAdBreaks.length),C.d(P," * Number of display ad breaks: "+t.displayAdBreaks.length),C.d(P," * Stream duration: "+t.streamData.duration+"ms\n");var e,r=Yi(t.linearAdBreaks);try{for(r.s();!(e=r.n()).done;){var n=e.value;C.d(P,n.toString());var i,a=Yi(n.getAdverts());try{for(a.s();!(i=a.n()).done;){var o=i.value;C.d(P,o.toString())}}catch(t){a.e(t)}finally{a.f()}}}catch(t){r.e(t)}finally{r.f()}var s,u=Yi(t.nonLinearAdBreaks);try{for(u.s();!(s=u.n()).done;){var c=s.value;C.d(P,c.toString());var l,f=Yi(c.getAdverts());try{for(f.s();!(l=f.n()).done;){var h=l.value;C.d(P,h.toString())}}catch(t){f.e(t)}finally{f.f()}}}catch(t){u.e(t)}finally{u.f()}var d,p=Yi(t.displayAdBreaks);try{for(p.s();!(d=p.n()).done;){var y=d.value;C.d(P,y.toString());var v,g=Yi(y.getAdverts());try{for(g.s();!(v=g.n()).done;){var b=v.value;C.d(P,b.toString())}}catch(t){g.e(t)}finally{g.f()}}}catch(t){p.e(t)}finally{p.f()}t.streamData.getEarlyReturn()&&C.d(P,"Early return: "+t.streamData.getEarlyReturn()),C.d(P,"--------------- END PARSING SUMMARY ----------------\n")}}(e),i=new Mi(e,t.toString()),r(i)}catch(t){n(t)}}))}},{key:"parseMapForOnEndTracking",value:function(t){var e=this.characters.trim(),r=t.get(this.creativeData.trackingEvent);r?r.addTrackingUrl(e):(r=-1!==this.creativeData.trackingEvent.indexOf("progress")?new K("progress",[e]):new K(this.creativeData.trackingEvent,[e]),t.set(this.creativeData.trackingEvent,r))}},{key:"pop",value:function(t,e){var r=[],n=(r=t?this.advertData.extensionStack:1===this.advertData.currentCreativeType?this.creativeData.companionExtensionStack:this.creativeData.extensionStack).pop();e?r[r.length-1].addChild(n):t?this.advertData.extensions=n:1===this.advertData.currentCreativeType?this.creativeData.companionExtensions=n:this.creativeData.extensions=n}},{key:"populateCompanionProperty",value:function(t,e){this.populateCreativeProperty(t,e)}},{key:"populateCompanionPropertyList",value:function(t){this.populateCompanionProperty(t,"id"),this.populateCompanionProperty(t,"width"),this.populateCompanionProperty(t,"height"),this.populateCompanionProperty(t,"assetWidth"),this.populateCompanionProperty(t,"assetHeight"),this.populateCompanionProperty(t,"expandedWidth"),this.populateCompanionProperty(t,"expandedHeight"),this.populateCompanionProperty(t,"apiFramework"),this.populateCompanionProperty(t,"adSlotId"),this.populateCompanionProperty(t,"pxratio"),this.populateCompanionProperty(t,"renderingMode")}},{key:"populateCreativeProperty",value:function(t,e){var r=t[e];H(r)||this.creativeData.properties.push(new Ci(e,r))}},{key:"populateIconProperty",value:function(t,e){var r=t[e];H(r)||this.iconData.properties.push(new Ci(e,r))}},{key:"populateIconPropertyList",value:function(t){this.populateIconProperty(t,"width"),this.populateIconProperty(t,"height"),this.populateIconProperty(t,"program"),this.populateIconProperty(t,"xPosition"),this.populateIconProperty(t,"yPosition"),this.populateIconProperty(t,"offset"),this.populateIconProperty(t,"duration"),this.populateIconProperty(t,"apiFramework"),this.populateIconProperty(t,"pxratio")}},{key:"populateIconClickFallbackImageProperty",value:function(t,e){var r=t[e];H(r)||this.iconClickFallbackImageData.properties.push(new Ci(e,r))}},{key:"populateIconClickFallbackImagePropertyList",value:function(t){this.populateIconClickFallbackImageProperty(t,"width"),this.populateIconClickFallbackImageProperty(t,"height")}},{key:"populateInteractiveCreativeProperty",value:function(t,e){this.populateCreativeProperty(t,e)}},{key:"populateInteractiveCreativePropertyList",value:function(t){this.populateInteractiveCreativeProperty(t,"apiFramework"),this.populateInteractiveCreativeProperty(t,"type"),H(t.variableDuration)?this.creativeData.properties.push(new Ci("variableDuration","false")):this.populateInteractiveCreativeProperty(t,"variableDuration")}},{key:"populateNonLinearProperty",value:function(t,e){this.populateCreativeProperty(t,e)}},{key:"populateNonLinearPropertyList",value:function(t){this.populateNonLinearProperty(t,"id"),this.populateNonLinearProperty(t,"width"),this.populateNonLinearProperty(t,"height"),this.populateNonLinearProperty(t,"expandedWidth"),this.populateNonLinearProperty(t,"expandedHeight"),this.populateNonLinearProperty(t,"scalable"),this.populateNonLinearProperty(t,"maintainAspectRatio"),this.populateNonLinearProperty(t,"apiFramework"),this.populateNonLinearProperty(t,"minSuggestedDuration")}}],[{key:"parse",value:function(e,r){return new t(r).parse(e)}}]),t}();function Oa(t){return Oa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Oa(t)}function Ca(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Da(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ra(){return Ra="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=Na(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},Ra.apply(this,arguments)}function Na(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ba(t)););return t}function La(t,e){return La=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},La(t,e)}function _a(t,e){if(e&&("object"===Oa(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ba(t){return Ba=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ba(t)}var ja=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&La(t,e)}(s,t);var e,r,n,i,a,o=(i=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ba(i);if(a){var r=Ba(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return _a(this,t)});function s(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(e=o.call(this,t)).streamStart=Me,e.manifestData=new Map,e.windowStart=Me,e.windowEnd=Me,e.windowSize=Me,e.pausePoller=null,e.pauseUrl="",e.initialPlayhead=Me,e.isFallbackLive=!1,e.fallbackPollRequested=!1,e.targetDuration=y.DEFAULT_POLLING_DELAY,e}return e=s,n=[{key:"create",value:function(t,e,r){var n=new s(e);if(!r)return n.initialiseFromSession(t);n.initialiseFromSession(t).then((function(){C.d(T,"Session initialised")})).catch((function(){C.d(T,"Session failed to initialise")})).finally((function(){r(new Or(n))}))}}],(r=[{key:"initialiseFromSession",value:function(t){var e=this;return new Promise((function(r,n){if(C.trace("sdk init"),!Ve(t))return e.completeWithStatus(Re.FAILED,je),void n(e);We.get(t,{method:"GET"},e.sessionProperties.getRequestTimeout(),e.sessionProperties.getCustomHttpHeaders()).then((function(i){i.ok?i.text().then((function(t){var a=i.headers.get("content-type");if(a&&a.toLowerCase().includes("application/json"))e.handleFallbackUrl(t)?r(e):n(e);else{var o=i.url,s=e.parseManifestResponse(t,o);e.setPlaybackUrl(o),e.initialiseFromPayload(s),e.getSessionState()!==Re.INITIALISED&&e.getSessionState()!==Re.NO_ANALYTICS&&n(e),e.getSessionState()===Re.INITIALISED&&e.initialisePoller(),r(e)}})):(i.timeout?(C.e("Primary Url request failed: "+t+", reason: timeout"),e.completeWithStatus(Re.FAILED,Be)):(C.e("Primary Url request failed: "+t+", status: "+i.status+", error: "+i.statusText),e.completeWithStatus(Re.FAILED,i.status)),n(e))})).catch((function(r){C.e("Primary Url request failed: "+t+", status: , reason: "+r),e.completeWithStatus(Re.FAILED,_e),n(e)}))}))}},{key:"adjustForEarlyReturn",value:function(t){var e=this.getAdBreakForPlayhead(t);e&&e.adjustForEarlyReturn(t)&&(this.getReportsManager().raiseAdBreakEarlyReturn(e,this),e.isValid()||this.linearAdBreaks.splice(this.linearAdBreaks.indexOf(e)))}},{key:"getDuration",value:function(){return this.windowEnd}},{key:"getPauseUrl",value:function(){return this.pauseUrl}},{key:"getStreamStart",value:function(){return this.streamStart}},{key:"getManifestData",value:function(t){return t?this.manifestData.get(t):this.manifestData}},{key:"getWindowStart",value:function(){return this.windowStart}},{key:"getWindowEnd",value:function(){return this.windowEnd}},{key:"getWindowSize",value:function(){return this.windowSize}},{key:"removeExpiredAdBreaks",value:function(){for(var t=this.streamStart===Me?this.getPlayhead():this.windowStart,e=this.getAdBreakForPlayhead(this.getPlayhead()),r=this.linearAdBreaks.length-1;r>=0;r--){var n=this.linearAdBreaks[r];if(n.getStart()+n.getDuration()<=t){if(C.d(T,"Removing ad break.  Start: "+n.getStart()+"; duration: "+n.getDuration()),n===e){C.d(T,"Removing the current adbreak");var i=e.getAdvertFromPlayhead(this.getPlayhead());i&&i.setInactive(),this.onAdvertEnd(),this.onAdvertBreakEnd()}this.linearAdBreaks.splice(r,1)}}}},{key:"shutdown",value:function(){Ra(Ba(s.prototype),"shutdown",this).call(this),this.analyticPoller&&(this.analyticPoller.shutdown(),this.analyticPoller=null),this.pausePoller&&(this.pausePoller.shutdown(),this.pausePoller=null),C.d(T,"resources released")}},{key:"getPlaybackMode",value:function(){return De.DVRLIVE}},{key:"initialisePoller",value:function(){var t=this;this.getAnalyticsUrl()&&this.pauseUrl&&this.getSessionState()===Re.INITIALISED&&(this.analyticPoller=new Si(this.getAnalyticsUrl(),this.getSessionProperties().getRequestTimeout(),(function(e,r){400===e.status?t.onSessionError(Le.TIMEOUT):e.error||(t.targetDuration=r,e.text().then((function(e){t.parseAnalyticPayload(e)})))})),this.pausePoller=new Si(this.pauseUrl,this.getSessionProperties().getRequestTimeout(),null))}},{key:"hasAnalyticUpdateChanged",value:function(t){return!this.getLastAnalyticUpdate()||!this.getLastAnalyticUpdate().isEqualTo(t)||(C.d(P,"Content unchanged.  Analytic update not delivered"),!1)}},{key:"adjustForPdtInitial",value:function(t){if(this.streamStart===Me){var e=t.getPdtInitial();null!==e&&(this.streamStart=e,this.isFallbackLive&&(C.d(P,"Received pdtInitial; returning to DVRLive"),this.isFallbackLive=!1),this.manifestData.get("availabilityStartTime")||this.manifestData.set("availabilityStartTime",new Date(e)))}}},{key:"handlePdtStartEnd",value:function(t){var e=!1,r=t.getPdtStart(),n=t.getPdtEnd();if(null!==r&&null!==n){var i=r,a=n;this.streamStart===Me&&(this.streamStart=i);var o=i-this.streamStart,s=a-this.streamStart;o===this.windowStart&&s===this.windowEnd||(e=!0,this.windowStart=o,this.windowEnd=s,this.windowSize=this.windowEnd-this.windowStart)}else C.w("PDT start/end value(s) invalid or missing");return e}},{key:"updateAdBreaks",value:function(t){var e=t.getLinearAdBreaks(),r=t.getNonLinearAdBreaks(),n=t.getDisplayAdBreaks(),i=e.length,a=r.length,o=n.length;Array.prototype.push.apply(this.linearAdBreaks,e),Array.prototype.push.apply(this.nonLinearAdBreaks,r),this.streamStart===Me?C.d(P,"Received "+i+" linear, "+a+" nonlinear "+o+" display ad breaks"):C.d(P,"Received: "+i+" linear, "+a+" nonlinear  "+o+" display ad breaks. New window start: "+this.windowStart+", end: "+this.windowEnd+" (total: "+this.windowSize+")"),this.removeExpiredAdBreaks()}},{key:"parseAnalyticPayload",value:function(t){var e=this;return Ia.parse(t,this).then((function(t){if(!t)return null;if(!e.hasAnalyticUpdateChanged(t))return t;var r=t.getEarlyReturn();if(r&&-1!==r&&e.adjustForEarlyReturn(r),e.adjustForPdtInitial(t),e.isFallbackLive&&!t.hasAdBreaks())C.d(P,"FallbackLive: No ad breaks in payload.  Discarding");else{var n=!1;e.isFallbackLive||(n=e.handlePdtStartEnd(t)),e.updateAdBreaks(t),(e.streamStart!==Me&&n||t.hasAdBreaks())&&(C.trace("sdk analytics "+t.getLinearAdBreaks().length+" "+t.getNonLinearAdBreaks().length+" "+t.getDisplayAdBreaks().length+" "+e.getDuration()),e.setLastAnalyticUpdate(t),e.getReportsManager().raiseAnalyticUpdateCallback(e))}return t})).catch((function(t){C.d(A,"Analytic Poll completed with unreadable data: "+t)}))}},{key:"setAdBreaksInactivePriorTo",value:function(t){var e,r=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return Ca(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ca(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(this.linearAdBreaks);try{for(r.s();!(e=r.n()).done&&e.value.setAdvertsInactivePriorTo(t););}catch(t){r.e(t)}finally{r.f()}}},{key:"setStreamStart",value:function(t){this.streamStart=t}},{key:"parseManifestResponse",value:function(t,e){var r=t;return mi.isHlsManifest(r)?(C.d(P,"Processing HLS master manifest: "+e),mi.parse(e,r)):(C.d(P,"Processing DASH manifest: "+e),di.parse(r))}},{key:"initialiseFromPayload",value:function(t){t?H(t.getAnalyticUrl())?(C.e("Analytics URL not found in manifest payload"),C.w("Playlist/manifest processing unsuccessful"),this.completeWithStatus(Re.NO_ANALYTICS,0)):Ve(t.getAnalyticUrl())?Ve(t.getLocation())?(this.setPlaybackUrl(t.getLocation()),H(t.getPauseUrl())?(C.e("Pause URL not found in manifest"),this.completeWithStatus(Re.NO_ANALYTICS,-11)):Ve(t.getPauseUrl())?(this.setIdentifier(t.getSessionIdentifier()),this.setAnalyticsUrl(t.getAnalyticUrl()),this.pauseUrl=t.getPauseUrl(),this.manifestData.set("availabilityStartTime",t.getAvailabilityStartTime()),this.completeWithStatus(Re.INITIALISED,0),C.d(T,"Successful. Url: "+this.getPlaybackUrl())):(C.e("Malformed pause URL in manifest"),this.completeWithStatus(Re.NO_ANALYTICS,-11))):(C.e("Player URL is invalid: "+t.getLocation()),C.w("Playlist/manifest processing unsuccessful"),this.completeWithStatus(Re.NO_ANALYTICS,0)):(C.e("Malformed analytics URL in manifest"),C.w("Playlist/manifest processing unuccessful"),this.completeWithStatus(Re.NO_ANALYTICS,je)):(C.e("Unable to process master manifest"),this.completeWithStatus(Re.NO_ANALYTICS,Ue))}},{key:"onPlaybackStart",value:function(t){this.isNotPlaying()?this.getSessionState()!==Re.INITIALISED?C.w("Reporting START when session is not initialised"):this.analyticPoller&&(this.initialPlayhead=t,Ra(Ba(s.prototype),"onPlaybackStart",this).call(this,t),this.analyticPoller.start()):C.w("Reporting START when start has already been reported")}},{key:"onPlaybackPause",value:function(){this.isNotPlaying()||this.pausePoller&&this.getSessionState()===Re.INITIALISED&&this.pausePoller.start(),Ra(Ba(s.prototype),"onPlaybackPause",this).call(this)}},{key:"onPlaybackResume",value:function(){this.isNotPlaying()&&this.pausePoller&&this.pausePoller.stop(),Ra(Ba(s.prototype),"onPlaybackResume",this).call(this)}},{key:"onPlayerEvent",value:function(t,e){t!==wt.SEEK&&t!==wt.ADVERT_SKIP&&t!==wt.ADVERT_REWIND||(this.didSeek=!0),Ra(Ba(s.prototype),"onPlayerEvent",this).call(this,t,e)}},{key:"onPlayheadUpdate",value:function(t){this.streamStart!==Me||this.isFallbackLive||this.analyticPoller&&this.analyticPoller.isRunning()&&(t>=this.initialPlayhead+this.targetDuration?(C.w("Did not receive pdtStart/End within "+this.targetDuration+"ms; going into FallbackLive"),this.isFallbackLive=!0):t>=this.initialPlayhead+this.targetDuration/2&&(this.fallbackPollRequested||(C.w("Did not receive pdtStart/End after "+t+"ms; polling again"),this.fallbackPollRequested=!0,this.analyticPoller.poll()))),this.handleHeartbeat(t),Ra(Ba(s.prototype),"onPlayheadUpdate",this).call(this,t)}},{key:"canPause",value:function(){return this.streamStart!==Me&&Ra(Ba(s.prototype),"canPause",this).call(this)}},{key:"canSkip",value:function(){return this.streamStart===Me?-1:this.policyHandler?Q(this.policyHandler,this.policyHandler.canSkip,this.getPlayhead(),this.linearAdBreaks,this.getDuration()):0}},{key:"willSeekTo",value:function(t){return this.streamStart===Me?this.getPlayhead():Ra(Ba(s.prototype),"willSeekTo",this).call(this,t)}}])&&Da(e.prototype,r),n&&Da(e,n),Object.defineProperty(e,"prototype",{writable:!1}),s}(si);function Ua(t){return Ua="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ua(t)}function Ma(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=xa(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}function xa(t,e){if(t){if("string"==typeof t)return Fa(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Fa(t,e):void 0}}function Fa(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function Va(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ha(){return Ha="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=Ya(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},Ha.apply(this,arguments)}function Ya(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ga(t)););return t}function qa(t,e){return qa=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},qa(t,e)}function Wa(t,e){if(e&&("object"===Ua(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ga(t){return Ga=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ga(t)}var za=Object.freeze({PLAYED_OUT:0,NOT_PLAYED_OUT:1,NEW_ADVERT_STARTING:2}),Xa=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&qa(t,e)}(s,t);var e,r,n,i,a,o=(i=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=Ga(i);if(a){var r=Ga(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return Wa(this,t)});function s(t,e,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(n=o.call(this,t)).advertEndWatchdog=null,n.interSegmentTimeout=y.INTERSEGMENT_TIMEOUT,n.lastTimedMetadata=null,n.pendingTimedMetadata=null,n.historicalTimedMetadata=[],n.inAdBreak=!1,n.targetDuration=y.DEFAULT_POLLING_DELAY,n.setAnalyticsUrl(e),n.setPlaybackUrl(r),n}return e=s,n=[{key:"create",value:function(t,e,r){var n=new s(e);if(!r)return n.initialiseFromSession(t);n.initialiseFromSession(t).then((function(){C.d(T,"Session initialised")})).catch((function(){C.d(T,"Session failed to initialise")})).finally((function(){r(new Or(n))}))}}],(r=[{key:"cancelScheduleWatchdog",value:function(){null!==this.advertEndWatchdog&&(clearTimeout(this.advertEndWatchdog),this.advertEndWatchdog=null,C.d(T,"Cancelled watchdog timer"))}},{key:"canPause",value:function(){return!!this.policyHandler&&Q(this.policyHandler,this.policyHandler.canPause,this.getPlayhead(),this.linearAdBreaks)}},{key:"canSkip",value:function(){return this.policyHandler?Q(this.policyHandler,this.policyHandler.canSkip,this.policyHandler.canSkip,this.getPlayhead(),this.linearAdBreaks,0):-1}},{key:"willSeekTo",value:function(t){return this.policyHandler?Q(this.policyHandler,this.policyHandler.willSeekTo,this.policyHandler.willSeekTo,t,this.linearAdBreaks,this.getPlayhead()):this.getPlayhead()}},{key:"getAdBreakForAdvert",value:function(t){if(t&&this.linearAdBreaks.length>0){var e,r=t.getMediaIdentifier(),n=Ma(this.linearAdBreaks);try{for(n.s();!(e=n.n()).done;){var i=e.value;if(i.getAdvertFromIdentifier(r))return i}}catch(t){n.e(t)}finally{n.f()}}return null}},{key:"getFirstAdvertRemovingAllPrevious",value:function(t){if(0===this.linearAdBreaks.length)return null;for(var e=null,r=-1,n=0;n<this.linearAdBreaks.length;++n){var i,a=Ma(this.linearAdBreaks[n].getAdverts());try{for(a.s();!(i=a.n()).done;){var o=i.value;if(o.getMediaIdentifier()===t&&o.isActive()){e=o,r=n;break}o.setInactive()}}catch(t){a.e(t)}finally{a.f()}if(null!==e)break}return r>0&&this.linearAdBreaks.splice(0,r),e}},{key:"getMetadataTimeout",value:function(t){return t&&t.getTypeWithinSegment()===vt.END?this.interSegmentTimeout:Math.max(this.targetDuration+1e3>>1,y.MIN_INTRASEGMENT_TIMEOUT)}},{key:"getPlaybackMode",value:function(){return De.LIVE}},{key:"handleMetaDataInSequence",value:function(t,e){var r=this.getCurrentAdvert();if(e.isFirstInSequence())this.onAdvertStart(t,e.getPlayhead());else if(e.isLastInSequence())!r||r.isFiller()&&!this.hasFillerExpired(this.getCurrentAdvert(),e)||this.onAdvertEnd(za.PLAYED_OUT);else if(r)if(e.isLastInSegment()&&r.isFiller()&&this.hasFillerExpired(this.getCurrentAdvert(),e))C.d(E,"Filler expired.  Ending advert and ad break"),this.onAdvertEnd(za.PLAYED_OUT);else{var n=Math.max(e.getPlayhead()-r.getStart(),0);this.signalTimelineTrackingEvents(n)}else this.onAdvertBreakStart(t)}},{key:"handleMetaDataOutOfSequence",value:function(t,e){var r=this.getCurrentAdvert();r?r.getMediaIdentifier()!==t.getMediaIdentifier()&&(this.onAdvertEnd(za.NOT_PLAYED_OUT),e.isFirstInSequence()?this.onAdvertStart(t,e.getPlayhead()):(e.isLastInSequence()||t.isFiller()&&e.isLastInSegment()&&this.hasFillerExpired(t,e))&&(t.setInactive(),this.getCurrentAdBreak().isActive()||this.onAdvertBreakEnd())):e.isFirstInSequence()?this.onAdvertStart(t,e.getPlayhead()):this.scheduleAdvertBreakEnd(this.interSegmentTimeout)}},{key:"hasFillerExpired",value:function(t,e){return C.d(E,"(FILLER CHECK) Ad duration: "+t.getDuration()+", current: "+e.getPlayhead()-t.getStart()+this.interSegmentTimeout),e.getPlayhead()-t.getStart()+this.interSegmentTimeout>=t.getDuration()}},{key:"initialiseFromSession",value:function(t){var e=this;return new Promise((function(r,n){if(C.trace("sdk init"),!Ve(t))return e.completeWithStatus(Re.FAILED,je),void n(e);We.get(t,{method:"GET"},e.sessionProperties.getRequestTimeout(),e.sessionProperties.getCustomHttpHeaders()).then((function(i){i.ok?i.text().then((function(a){var o=i.headers.get("content-type");if(o&&o.toLowerCase().includes("application/json"))e.handleFallbackUrl(a)?r(e):n(e);else{var s=i.url?i.url:t;e.parseManifestResponse(a,s),e.getSessionState()===Re.INITIALISED&&e.initialisePoller(),r(e)}})):(i.timeout?(C.e("Primary Url request failed: "+t+", reason: timeout"),e.completeWithStatus(Re.FAILED,Be)):(C.e("Primary Url request failed: "+t+", status: "+i.status+", error: "+i.statusText),e.completeWithStatus(Re.FAILED,i.status)),n(e))})).catch((function(r){C.e("Primary Url request failed: "+t+", status: , reason: "+r),e.completeWithStatus(Re.FAILED,_e),n(e)}))}))}},{key:"initialisePoller",value:function(){var t=this;this.getAnalyticsUrl()&&this.getSessionState()===Re.INITIALISED&&(this.analyticPoller=new Si(this.getAnalyticsUrl(),this.getSessionProperties().getRequestTimeout(),(function(e,r){400===e.status?t.onSessionError(Le.TIMEOUT):e.error||e.timeout||(t.targetDuration=r,e.text().then((function(e){t.parseAnalyticPayload(e)})))})))}},{key:"isMetadataInSequence",value:function(t,e){return this.pendingTimedMetadata?(C.d(E,"Pending metadata"),!1):e.isInSequence(t)}},{key:"onAdvertBreakEnd",value:function(){if(this.inAdBreak){var t=this.getCurrentAdBreak();if(t){var e=t.getTrackingReport("breakEnd",!0);this.getReportsManager().fireBeacon(e,new it(this.getPlayhead()))}this.inAdBreak=!1,C.trace("adbreakEnd"),this.getReportsManager().raiseAdBreakCallback("end",null,this),this.linearAdBreaks.length>0&&(this.linearAdBreaks.splice(0,1),C.d(T,"Removed AdBreak.  Remaining: "+this.linearAdBreaks.length)),this.lastTimedMetadata=null,this.pendingTimedMetadata=null,this.historicalTimedMetadata=[],this.setCurrentAdvert(null),this.setCurrentAdBreak(null)}}},{key:"onAdvertBreakStart",value:function(t){if(!this.inAdBreak){this.inAdBreak=!0;var e=this.getAdBreakForAdvert(t);if(this.setCurrentAdBreak(e),C.d(T,"AdBreak count: "+this.linearAdBreaks.length),C.trace("adbreakStart"),this.getReportsManager().raiseAdBreakCallback("start",e,this),e){var r=e.getTrackingReport("breakStart",!this.reportsManager.reportsSuppressed());this.getReportsManager().fireBeacon(r,new it(this.getPlayhead()))}}}},{key:"onAdvertEnd",value:function(t){this.getCurrentAdvert()&&(t!==za.NEW_ADVERT_STARTING?this.cancelScheduleWatchdog():C.d(E,"onAdvertEnd(): new ad starting, not firing adbreak watchdog timer"),t===za.PLAYED_OUT?this.signalTimelineTrackingEvents(this.getCurrentAdvert().getDuration()):this.getCurrentAdvert().clearTrackingSchedule(),this.getCurrentAdvert().setInactive(),C.trace("advertEnd"),this.getReportsManager().raiseAdvertCallback("end",null,this),this.setCurrentAdvert(null),this.getCurrentAdBreak().isActive()?t!==za.NEW_ADVERT_STARTING&&this.scheduleAdvertBreakEnd(this.interSegmentTimeout):this.onAdvertBreakEnd())}},{key:"onAdvertStart",value:function(t,e){t.setStart(e),this.onAdvertEnd(za.NEW_ADVERT_STARTING),this.onAdvertBreakStart(t),this.setCurrentAdBreak(this.getAdBreakForAdvert(t)),this.getCurrentAdBreak()?(this.setCurrentAdvert(t),t.isFiller()&&C.d(E,"Filler advert, duration: "+t.getDuration()),this.reportsManager.reportsSuppressed()&&this.getCurrentAdvert().clearTrackingSchedule(),C.trace("advertStart"),this.getReportsManager().raiseAdvertCallback("start",t,this),this.fireImpressionReport(),this.signalTimelineTrackingEvents(y.ADVERT_START_TIMESLOT)):C.e("*** AdBreak is null ***")}},{key:"parseAnalyticPayload",value:function(t){var e=this;return Ia.parse(t,this).then((function(t){if(!t)return null;if(e.getLastAnalyticUpdate()&&t.isEqualTo(e.getLastAnalyticUpdate()))return C.d(P,"Content unchanged.  Analytic update not delivered"),t;if(e.setLastAnalyticUpdate(t),!t.hasAdBreaks())return C.d(P,"No ad breaks in payload"),t;C.trace("sdk analytics: "+t.getLinearAdBreaks().length+" "+t.getNonLinearAdBreaks().length+" "+t.getDisplayAdBreaks().length);var r,n=!1,i=Ma(t.getLinearAdBreaks());try{for(i.s();!(r=i.n()).done;){var a=r.value;if(0===a.getAdverts().length){var o=new it(e.getPlayhead());e.getReportsManager().fireBeacon(a.getTrackingReport("breakStart",!0),o),e.getReportsManager().fireBeacon(a.getTrackingReport("breakEnd",!0),o)}else e.linearAdBreaks.push(a),n=!0}}catch(t){i.e(t)}finally{i.f()}var s,u=Ma(t.getNonLinearAdBreaks());try{for(u.s();!(s=u.n()).done;){var c=s.value;e.nonLinearAdBreaks.push(c),n=!0}}catch(t){u.e(t)}finally{u.f()}var l,f=Ma(t.getDisplayAdBreaks());try{for(f.s();!(l=f.n()).done;){var h=l.value;e.displayAdBreaks.push(h),n=!0}}catch(t){f.e(t)}finally{f.f()}return n&&e.getReportsManager().raiseAnalyticUpdateCallback(e),e.pendingTimedMetadata&&(C.d(E,"Process pending metadata: "+e.pendingTimedMetadata),e.onTimedMetadata(e.pendingTimedMetadata),e.pendingTimedMetadata=null),e.processHistoricalData(),t})).catch((function(t){C.d(A,"Analytic Poll completed with unreadable data: "+t)}))}},{key:"onPlaybackContinue",value:function(){this.isPlaybackBuffering()&&(this.getCurrentAdvert()?this.scheduleAdvertEnd():this.getCurrentAdBreak()&&this.scheduleAdvertBreakEnd(this.interSegmentTimeout)),Ha(Ga(s.prototype),"onPlaybackContinue",this).call(this)}},{key:"onPlaybackPause",value:function(){Ha(Ga(s.prototype),"onPlaybackPause",this).call(this),this.cancelScheduleWatchdog()}},{key:"onPlaybackResume",value:function(){this.isNotPlaying()&&!this.isPlaybackBuffering()&&(this.getCurrentAdvert()?this.scheduleAdvertEnd(null):this.getCurrentAdBreak()&&this.scheduleAdvertBreakEnd(this.interSegmentTimeout)),Ha(Ga(s.prototype),"onPlaybackResume",this).call(this)}},{key:"onPlaybackStall",value:function(){Ha(Ga(s.prototype),"onPlaybackStall",this).call(this),this.cancelScheduleWatchdog()}},{key:"onPlaybackStart",value:function(t){this.isNotPlaying()?this.getSessionState()!==Re.INITIALISED?C.w("Reporting START when session has not been initialised"):(Ha(Ga(s.prototype),"onPlaybackStart",this).call(this,t),this.analyticPoller.start()):C.w("Reporting START when start has already been reported")}},{key:"onTimedMetadata",value:function(t){if(C.d(E,"Received metadata: "+t+", timestamp: "+t.getTimestamp()),this.isPlaybackBuffering())C.w("Playback buffering - should not be receiving timed metadata");else if(this.isNotPlaying())C.w("Playback not playing - should not be receiving timed metadata");else if(this.scheduleAdvertEnd(t),t.isDuplicate(this.lastTimedMetadata))C.d(E,"Duplicate metadata: "+t);else{var e=t.getMediaId(),r=this.getFirstAdvertRemovingAllPrevious(e);if(!r)return t.isFirstInSequence()?(C.d(E,"FIRST pending metadata for advert "+e),this.pendingTimedMetadata=t,this.lastTimedMetadata=null,this.analyticPoller&&this.analyticPoller.poll()):t.isLastInSequence()&&this.getSessionProperties().getFireHistoricalBeacons()&&this.pendingTimedMetadata&&(C.d(E,"LAST pending metadata for advert: "+e+" .  Moving to historical list"),this.historicalTimedMetadata.push(this.pendingTimedMetadata),this.pendingTimedMetadata=null),void this.onAdvertBreakStart(null);if(this.isMetadataInSequence(this.lastTimedMetadata,t))return this.lastTimedMetadata=t,void this.handleMetaDataInSequence(r,t);C.d(E,"Metadata out of sequence"),this.pendingTimedMetadata=null,this.lastTimedMetadata=t,this.handleMetaDataOutOfSequence(r,t)}}},{key:"onSessionError",value:function(t){this.setState(Re.SHUTDOWN),this.analyticPoller&&this.analyticPoller.stop(),this.getReportsManager().raiseSessionErrorCallback(t,this)}},{key:"parseManifestResponse",value:function(t,e){var r=t,n=null;mi.isHlsManifest(r)?(C.d(P,"Processing HLS master playlist: "+e),n=mi.parse(e,r)):(C.d(P,"Processing DASH manifest: "+e),n=di.parse(r)),n?H(n.getAnalyticUrl())?(this.setPlaybackUrl(e),C.e("Analytics URL not found in manifest payload"),C.w("Playlist/manifest processing unsuccesful"),this.completeWithStatus(Re.NO_ANALYTICS,0)):Ve(n.getAnalyticUrl())?(this.setPlaylistProperties(n),this.interSegmentTimeout=n.getIntersegmentTimeout(),this.completeWithStatus(Re.INITIALISED,0),C.d(T,"Successful.  URL: "+this.getPlaybackUrl())):(this.setPlaybackUrl(e),C.e("Malformed analytics URL in manifest payload"),C.w("Playlist/manifest processing unsuccessful"),this.completeWithStatus(Re.NO_ANALYTICS,je)):(this.setPlaybackUrl(null),C.w("Playlist/manifest processing unsuccesful"),this.completeWithStatus(Re.NO_ANALYTICS,Ue))}},{key:"processHistoricalData",value:function(){var t,e,r=this.getCurrentAdBreak();if(r){var n,i=Ma(this.historicalTimedMetadata);try{for(i.s();!(n=i.n()).done;){var a=n.value.getMediaId(),o=r.getAdvertFromIdentifier(a);if(o){C.d(w,"Firing beacon for historical advert: "+a);var s,u=new it(this.getPlayhead(),o.getStart(),o.getLinearCreative().getAssetUri(),o.getMacroSubstitutions()),c=[],l=Ma(o.getTrackingSchedule());try{for(l.s();!(s=l.n()).done;){var f=(t=s.value,e=2,function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,i,a=[],o=!0,s=!1;try{for(r=r.call(t);!(o=(n=r.next()).done)&&(a.push(n.value),!e||a.length!==e);o=!0);}catch(t){s=!0,i=t}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}(t,e)||xa(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),h=f[0],d=f[1];c.push(h);var p=o.getTrackingReportLinear(d);p&&(C.d(w,"Firing beacon(s) for event: "+h),this.getReportsManager().fireBeacon(p,u))}}catch(t){l.e(t)}finally{l.f()}this.removeKeysFromTrackingSchedule(c)}}}catch(t){i.e(t)}finally{i.f()}}this.historicalTimedMetadata=[]}},{key:"scheduleAdvertBreakEnd",value:function(t){this.cancelScheduleWatchdog(),this.advertEndWatchdog=setTimeout(this.metadataWatchdogEndBreak.bind(this),t),C.d(E,"Scheduled adbreak end watchdog timer: "+t+"ms")}},{key:"scheduleAdvertEnd",value:function(t){this.cancelScheduleWatchdog();var e=this.getMetadataTimeout(t);this.advertEndWatchdog=setTimeout(this.metadataWatchdog.bind(this),e),C.d(E,"Scheduled advert end watchdog timer: "+e+"ms")}},{key:"setTargetDuration",value:function(t){this.targetDuration=t}},{key:"shutdown",value:function(){Ha(Ga(s.prototype),"shutdown",this).call(this),this.cancelScheduleWatchdog(),this.analyticPoller&&(this.analyticPoller.shutdown(),this.analyticPoller=null,C.d(T,"Analytic poller cancelled"))}},{key:"setPlaylistProperties",value:function(t){this.setIdentifier(t.getSessionIdentifier()),this.setAnalyticsUrl(t.getAnalyticUrl()),this.setPlaybackUrl(t.getLocation())}},{key:"metadataWatchdog",value:function(){C.w("Watchdog timer expired before metadata was received"),this.pendingTimedMetadata?this.onAdvertBreakEnd():this.onAdvertEnd(za.NOT_PLAYED_OUT)}},{key:"metadataWatchdogEndBreak",value:function(){C.w("Watchdog timer expired before metadata was received"),this.onAdvertBreakEnd()}}])&&Va(e.prototype,r),n&&Va(e,n),Object.defineProperty(e,"prototype",{writable:!1}),s}(xe);function Ka(t){return Ka="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ka(t)}function Qa(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function $a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ja(){return Ja="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=Za(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}},Ja.apply(this,arguments)}function Za(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ro(t)););return t}function to(t,e){return to=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},to(t,e)}function eo(t,e){if(e&&("object"===Ka(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ro(t){return ro=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ro(t)}var no=/(.+?:\/\/)/,io=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&to(t,e)}(s,t);var e,r,n,i,a,o=(i=s,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=ro(i);if(a){var r=ro(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return eo(this,t)});function s(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),o.call(this,t)}return e=s,n=[{key:"create",value:function(t,e,r){var n=new s(e);if(!r)return n.initialiseSession(t);n.initialiseSession(t).then((function(){C.d(T,"Session initialised")})).catch((function(){C.d(T,"Session failed to initialise")})).finally((function(){r(new Or(n))}))}}],(r=[{key:"canSkip",value:function(){return this.policyHandler?Q(this.policyHandler,this.policyHandler.canSkip,this.getPlayhead(),this.linearAdBreaks,this.duration):0}},{key:"getContentPositionForPlayhead",value:function(t){if(0===this.duration||0===t)return 0;if(0===this.linearAdBreaks.length)return t;var e,r=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return Qa(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Qa(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,i=function(){};return{s:i,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return o=t.done,t},e:function(t){s=!0,a=t},f:function(){try{o||null==r.return||r.return()}finally{if(s)throw a}}}}(this.linearAdBreaks);try{for(r.s();!(e=r.n()).done;){var n=e.value;if(n.getStart()<=t&&t<n.getStart()+n.getDuration()){t=n.getStart()+n.getDuration();break}}}catch(t){r.e(t)}finally{r.f()}for(var i=0,a=t;i<this.linearAdBreaks.length&&this.linearAdBreaks[i].getStart()<t;)a-=this.linearAdBreaks[i++].getDuration();return a}},{key:"getPlaybackMode",value:function(){return De.VOD}},{key:"getPlayheadForContentPosition",value:function(t){if(0===this.linearAdBreaks.length)return t;for(var e=0;e<this.linearAdBreaks.length&&this.linearAdBreaks[e].getStart()<=t;)t+=this.linearAdBreaks[e++].getDuration();return t}},{key:"initialiseSession",value:function(t){var e=this;return new Promise((function(r,n){if(C.trace("sdk init"),!Ve(t))return e.completeWithStatus(Re.FAILED,je),void n(e);We.get(t,{method:"GET"},e.sessionProperties.getRequestTimeout(),e.sessionProperties.getCustomHttpHeaders()).then((function(i){i.ok?i.text().then((function(a){var o=i.headers.get("content-type");o&&o.toLowerCase().includes("application/json")?e.handleFallbackUrl(a)?r(e):n(e):Ia.parse(a,e).then((function(n){!n||0===n.getStreamDuration()||H(n.getHostNode()||H(n.getHostSuffix()))?(e.setPlaybackUrl(t),e.logVmapParseWarning(n),n?(e.completeWithStatus(Re.NO_ANALYTICS,0),r(e)):(e.completeWithStatus(Re.NO_ANALYTICS,Ue),r(e))):(e.initialiseFromAnalyticData(n,e.findScheme(t)),C.d(P,n.toString()),e.completeWithStatus(Re.INITIALISED,0),r(e))}))})):(C.e("VMAP request failed.  URL: "+t+", status: "+i.status+", error: "+i.statusText),e.completeWithStatus(Re.FAILED,i.status),n(e))})).catch((function(r){C.e("VMAP request failed.  URL: "+t+", error: "+r),e.completeWithStatus(Re.FAILED,_e),n(e)}))}))}},{key:"logVmapParseWarning",value:function(t){var e="Unable to parse VMAP data.\n - Stream duration: ".concat(t?t.getStreamDuration():"null","\n - Host node: ").concat(t?t.getHostNode():"null","\n - Host suffix: ").concat(t?t.getHostSuffix():null);C.d(T,e)}},{key:"findScheme",value:function(t){return no.exec(t)?no.exec(t)[1]:(C.w("Unable to match scheme in primary URL.  Assuming http://"),"http://")}},{key:"onPlayerEvent",value:function(t,e){t!==wt.SEEK&&t!==wt.ADVERT_SKIP&&t!==wt.REWIND||(this.didSeek=!0),Ja(ro(s.prototype),"onPlayerEvent",this).call(this,t,e)}},{key:"onPlayheadUpdate",value:function(t){this.handleHeartbeat(t),Ja(ro(s.prototype),"onPlayheadUpdate",this).call(this,t)}},{key:"setAdBreaksInactivePriorTo",value:function(t){Ja(ro(s.prototype),"setAdBreaksInactivePriorTo",this).call(this,t)}},{key:"setDuration",value:function(t){this.duration=t}}])&&$a(e.prototype,r),n&&$a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),s}(si)})(),YospaceAdManagement=n})();